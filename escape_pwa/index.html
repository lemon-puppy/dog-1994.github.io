<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">

  <title>battle royale no espaço</title>

  <!--http://www.html5rocks.com/en/mobile/mobifying/-->
  <meta name="viewport"
    content="width=device-width,user-scalable=yes,initial-scale=1, minimum-scale=1,maximum-scale=5" />

  <!--https://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">

  <!-- force webkit on 360 -->
  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <!-- force edge on IE -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="msapplication-tap-highlight" content="no">

  <!-- force full screen on some browser -->
  <meta name="full-screen" content="yes" />
  <meta name="x5-fullscreen" content="true" />
  <meta name="360-fullscreen" content="true" />

  <!-- force screen orientation on some browser -->
  <meta name="screen-orientation" content="portrait" />
  <meta name="x5-orientation" content="portrait">

  <!--fix fireball/issues/3568 -->
  <!--<meta name="browsermode" content="application">-->
  <meta name="x5-page-mode" content="app">

  <!--<link rel="apple-touch-icon" href=".png" />-->
  <!--<link rel="apple-touch-icon-precomposed" href=".png" />-->

  <link rel="stylesheet" type="text/css" href="style-mobile.25fc5.css" />
  <link rel="icon" href="favicon.8de18.ico" />
  <link rel="manifest" href="manifest.json" />
</head>

<body>
  <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="0"></canvas>
  <div id="splash">
    <div class="progress-bar stripes">
      <span style="width: 0%"></span>
    </div>
  </div>

  <script src="src/settings.23479.js" charset="utf-8"></script>

  <script src="main.41c45.js" charset="utf-8"></script>
  <script>
    // if ('serviceWorker' in window.navigator) {
    //   let refreshing = false;
    //   navigator.serviceWorker.addEventListener('controllerchange', () => {
    //     if (refreshing) {
    //       return;
    //     }
    //     refreshing = true;
    //     window.location.reload();
    //   })
    //   navigator.serviceWorker.register("service-worker.js").then(reg => {
    //     if (reg.waiting) {
    //       reg.waiting.postMessage({ type: 'SKIP_WAITING' })
    //     }
    //   });
    // }
    const version = 1;
    const checkAppUpdate = function () {
      caches.open('sugar-cache').then(function (cache) {
        // 检索版本号资源
        cache.match('/version').then(function (response) {
          if (response) {
            response.text().then(function (data) {
              var cachedVersion = parseInt(data, 1); // 将缓存的版本号转换为整数
              if (version > 1 && cachedVersion < version) {
                // 缓存的版本号较旧，需要更新
                window.showToast("There is a new version");
                window.location.reload();

                // 将最新版本添加到缓存
                var versionResponse = new Response(version.toString());
                cache.put('/version', versionResponse);
              }
            });
          } else {
            // 版本号资源不存在于缓存中，需要添加到缓存
            var versionResponse = new Response(version.toString());
            cache.put('/version', versionResponse);
          }
        });
      });
    }
    // 检测浏览器是否支持SW
    if ('serviceWorker' in window.navigator) {
      const registerServiceWorker = async () => {
        if ("serviceWorker" in navigator) {
          try {
            const registration = await navigator.serviceWorker.register("./sw.js", {
              scope: "./",
            });
            if (registration.installing) {
              console.log("正在安装 Service worker");
            } else if (registration.waiting) {
              console.log("已安装 Service worker installed");
            } else if (registration.active) {
              console.log("激活 Service worker");
              checkAppUpdate();
            }
          } catch (error) {
            console.error(`注册失败：${error}`);
          }
        }
      };
      registerServiceWorker();
    }
  </script>
  <script type="text/javascript">
    (function () {
      // open web debugger console
      if (typeof VConsole !== 'undefined') {
        window.vConsole = new VConsole();
      }

      var debug = window._CCSettings.debug;
      var splash = document.getElementById('splash');
      splash.style.display = 'block';

      function loadScript(moduleName, cb) {
        function scriptLoaded() {
          document.body.removeChild(domScript);
          domScript.removeEventListener('load', scriptLoaded, false);
          cb && cb();
        };
        var domScript = document.createElement('script');
        domScript.async = true;
        domScript.src = moduleName;
        domScript.addEventListener('load', scriptLoaded, false);
        document.body.appendChild(domScript);
      }

      loadScript(debug ? 'cocos2d-js.js' : 'cocos2d-js-min.746a3.js', function () {
        if (CC_PHYSICS_BUILTIN || CC_PHYSICS_CANNON) {
          loadScript(debug ? 'physics.js' : 'physics-min.js', window.boot);
        }
        else {
          window.boot();
        }
      });
    })();
  </script>
</body>

</html>