window.__require=function t(e,o,n){function i(a,s){if(!o[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var u="function"==typeof __require&&__require;if(!s&&u)return u(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var l=o[a]={exports:{}};e[a][0].call(l.exports,function(t){return i(e[a][1][t]||t)},l,l.exports,t,e,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({atkRole:[function(t,e,o){"use strict";cc._RF.push(e,"36c4avsrTtOQ5Q8bazBvbyW","atkRole");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../game/beastMgr"),s=cc._decorator,c=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roleSke=null,e.userSkinList=[],e}return i(e,t),e.prototype.start=function(){},e.prototype.setData=function(t){void 0===t&&(t=0),this.roleSke.skeletonData=this.userSkinList[t],this.playAni("daiji"),0==t&&(this.node.zIndex=999,a.default.inst.beastModule?this.roleSke.setSkin("jin"):this.roleSke.setSkin("putong"))},e.prototype.playAni=function(t,e){void 0===e&&(e=!0),this.roleSke.setAnimation(0,t,e)},r([u(sp.Skeleton)],e.prototype,"roleSke",void 0),r([u(sp.SkeletonData)],e.prototype,"userSkinList",void 0),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../../game/beastMgr":void 0}],atkSpear:[function(t,e,o){"use strict";cc._RF.push(e,"09055adAetPtblALEypn7Ov","atkSpear");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./strikeBeast"),s=cc._decorator,c=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spear=null,e.skin=[],e.gameScene=null,e}return i(e,t),e.prototype.onCollisionEnter=function(t,e){this.gameScene.getComponent(a.default).monsterBeAtk(),cc.Tween.stopAllByTarget(e.node),e.node.angle=30,e.node.active=!1,app.nodePoolMgr.putNode(e.node)},e.prototype.setSkin=function(t,e){this.spear.spriteFrame=this.skin[t],this.gameScene=e},r([u(cc.Sprite)],e.prototype,"spear",void 0),r([u(cc.SpriteFrame)],e.prototype,"skin",void 0),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./strikeBeast":"strikeBeast"}],autoPlay:[function(t,e,o){"use strict";cc._RF.push(e,"f079anuL6pJSIgpZpK7bwUx","autoPlay");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function a(t){try{c(n.next(t))}catch(e){r(e)}}function s(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,s)}c((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var o,n,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../core/components/LayerBase"),u=t("../../game/beastMgr"),l=t("../../proto/mystibeast_pb"),d=cc._decorator,p=d.ccclass,h=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.strike_12_record=null,e.itemStrike=null,e.roundList=null,e.betNumList=null,e.roundDIY=null,e.gems=null,e.betNumDIY=null,e.DIYNode=null,e.DIYTip=null,e.keyBoard=null,e.inputNumStr=null,e.btn_sureTip=null,e.iconList=[],e.btnSureSpr=null,e.btnSureSprArr=[],e.inputStr="",e.select_round=0,e.roundIndex=0,e.roundNumSelectList=[12,24,48],e.select_betNum=0,e.betIndex=0,e.betNumSelectList=[1,10,100],e.curType=0,e.roundLimit=100,e.sureCb=null,e.isAutoPlay=!1,e}return i(e,t),e.prototype.start=function(){this.addKeyBoardListener()},e.prototype.addBtnClickListener=function(){for(var t=0;t<this.roundList.childrenCount;t++)this.roundList.children[t].on("click",this.onRoundBtnClick.bind(this));for(t=0;t<this.betNumList.childrenCount;t++)this.betNumList.children[t].on("click",this.onBetNumBtnClick.bind(this))},e.prototype.addKeyBoardListener=function(){for(var t=0;t<this.keyBoard.children[0].childrenCount;t++)this.keyBoard.children[0].children[t].on("click",this.keyBoardClicked.bind(this))},e.prototype.loadRecord=function(){return a(this,void 0,void 0,function(){var t,e=this;return s(this,function(){return t=new l.StrikeBeastRoundRecordReq,u.default.inst.strikeBeastClient.strikeBeastRoundRecord(t,u.default.inst.metadata).then(function(t){if(0==t.getResult()){var o=t.getStrikebeastroundrecordresp().toObject();cc.log(o),e.loadStrike_12_records(o.roundListList)}else cc.log("errorCode",t.getCode(),"errorMsg",t.getMsg()),u.default.inst.handleCode(t.getCode())}),[2]})})},e.prototype.loadStrike_12_records=function(t){var e=this.strike_12_record.children[1];if(0!=(t=MyFun.sortByObjectValue(t,"roundId")).length)for(var o=0,n=t.length;o<n;o++){var i=t[o],r=cc.instantiate(this.itemStrike);r.active=!0,r.parent=e,r.getChildByName("round").getComponent(app.i18nLabel).init("strikeBeast_record3",[i.id.toString()]),r.getChildByName("avg").getComponent(cc.Label).string=MyFun.getRealNum(i.attackPower).toFixed(0);var a=3==i.status?0:1;r.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.iconList[a]}},e.prototype.keyBoardClicked=function(t){var e=t.target.name;if("."!=e){if("del"==e&&this.inputStr.length>0){var o=this.inputStr.length-1;this.inputStr=this.inputStr.slice(0,o),this.checkInput()}if("del"!==e){if(this.inputStr=this.inputStr+e,"."==e)return void(this.inputNumStr.string=this.inputStr);this.checkInput()}}},e.prototype.checkInput=function(){var t=Number(this.inputStr);0==this.curType?t>100&&(t=100,u.default.inst.showWarning("strikeBeast_auto10","100")):t>1e6?(t=1e6,u.default.inst.showWarning("strikeBeast_auto16","1000000")):t>u.default.inst.mydaggers&&(t=parseInt(u.default.inst.mydaggers.toString())),this.inputStr=t.toString(),this.inputNumStr.string=t.toString()},e.prototype._clearSelect=function(t){t.forEach(function(t){cc.isValid(t.children[1])&&(t.children[1].active=!1)})},e.prototype.onRoundBtnClick=function(t){var e=t.target.name;this.roundIndex==e&&4!=e?(t.target.children[1].active=!1,this.roundIndex=0,this.select_round=0):(this.roundIndex=e,this._clearSelect(this.roundList.children),t.target.children[1].active=!0,4==e?this.showDIYNode(0):this.select_round=this.roundNumSelectList[this.roundIndex-1])},e.prototype.onBetNumBtnClick=function(t){var e=t.target.name;this.betIndex==e&&4!=e?(t.target.children[1].active=!1,this.betIndex=0,this.select_betNum=0):(this.betIndex=e,this._clearSelect(this.betNumList.children),t.target.children[1].active=!0,4==e?this.showDIYNode(1):this.select_betNum=this.betNumSelectList[this.betIndex-1])},e.prototype.showDIYNode=function(t){void 0===t&&(t=0),this.DIYNode.active=!0,this.curType=t,0==t?this.DIYTip.node.getComponent(app.i18nLabel).init("strikeBeast_auto8",[]):this.DIYTip.node.getComponent(app.i18nLabel).init("strikeBeast_auto9",[])},e.prototype.closeDiyNode=function(){this.inputStr="",this.inputNumStr.string="",this.DIYNode.active=!1},e.prototype.btnSureInputClick=function(){if(""==this.inputStr||0==Number(this.inputStr))return u.default.inst.showWarning("strikeBeast_auto11"),0==this.curType?this.select_round=0:this.select_betNum=0,void this.closeDiyNode();var t=Number(this.inputNumStr.string);0==this.curType?(t>100&&(t=100,u.default.inst.showWarning("strikeBeast_auto10","100")),this.roundDIY.string=t.toString(),this.select_round=t):(t>1e6?(t=1e6,u.default.inst.showWarning("strikeBeast_auto16","1000000")):t>u.default.inst.mydaggers&&(t=parseInt(u.default.inst.mydaggers.toString())),this.betNumDIY.string=t.toString(),this.gems.active=!0,this.select_betNum=t),this.closeDiyNode()},e.prototype.setData=function(t,e){cc.log(t),this.sureCb=e,this.isAutoPlay=t;var o=t?"strikeBeast_auto5":"strikeBeast_auto4";this.btn_sureTip.node.getComponent(app.i18nLabel).init(o,[]),this.btnSureSpr.spriteFrame=t?this.btnSureSprArr[1]:this.btnSureSprArr[0],t?this.loadCurAutoSetData():(this.addBtnClickListener(),this.loadRecord())},e.prototype.loadCurAutoSetData=function(){var t=this,e=new l.StrikeBeastAutoAttackInfoReq;u.default.inst.strikeBeastClient.strikeBeastAutoAttackInfo(e,u.default.inst.metadata).then(function(e){if(0==e.getCode()){var o=e.getStrikebeastautoattackinforesp().toObject();if(t.loadStrike_12_records(o.roundListList),t.select_round=o.autoAttackInfo.targetNum,[12,24,48].includes(t.select_round)){var n=[12,24,48].indexOf(t.select_round);t.roundList.children[n].children[1].active=!0}else t.roundList.children[3].children[1].active=!0,t.roundDIY.string=t.select_round.toString();t.select_betNum=MyFun.getRealNum(o.autoAttackInfo.daggersNum),[1,10,100].includes(t.select_betNum)?(n=[1,10,100].indexOf(t.select_betNum),t.betNumList.children[n].children[1].active=!0):(t.betNumList.children[3].children[1].active=!0,t.betNumDIY.string=t.select_betNum.toString(),t.gems.active=!0)}else u.default.inst.handleCode(e.getCode())}).catch(function(t){cc.warn(t.message)})},e.prototype.btnSureAutoSetClick=function(){var e=this;if(cc.log(this.select_round,this.select_betNum),!this.isAutoPlay){if(0==this.select_round)return void u.default.inst.showWarning("strikeBeast_auto12");if(0==this.select_betNum)return void u.default.inst.showWarning("strikeBeast_auto13");if(this.select_betNum>u.default.inst.mydaggers)return void u.default.inst.showWarning("beast_netmsg05")}var o=this.isAutoPlay?"strikeBeast_auto7":"strikeBeast_auto6";u.default.inst.showConfirm(o,function(){var o;e.isAutoPlay?(o=new l.StrikeBeastAutoAttackEndReq,u.default.inst.strikeBeastClient.strikeBeastAutoAttackEnd(o,u.default.inst.metadata).then(function(o){0==o.getCode()?(cc.log("\u786e\u5b9a"),e.isAutoPlay=!1,e.sureCb&&e.sureCb(e.isAutoPlay),t.prototype.onClose.call(e)):(u.default.inst.handleCode(o.getCode()),2022==o.getCode()&&(e.isAutoPlay=!1,e.sureCb&&e.sureCb(e.isAutoPlay),t.prototype.onClose.call(e)))}).catch(function(t){cc.log(t),u.default.inst.handleCode(t.code)})):((o=new l.StrikeBeastAutoAttackStartReq).setTargetNum(e.select_round),o.setDaggersNum(e.select_betNum),u.default.inst.strikeBeastClient.strikeBeastAutoAttackStart(o,u.default.inst.metadata).then(function(o){0==o.getCode()?(cc.log("\u786e\u5b9a"),e.isAutoPlay=!0,e.sureCb&&e.sureCb(e.isAutoPlay),t.prototype.onClose.call(e)):u.default.inst.handleCode(o.getCode())}).catch(function(t){cc.log(t),u.default.inst.handleCode(t.code)}))})},e.prototype.btnCloseClicked=function(){this.sureCb&&this.sureCb(this.isAutoPlay),t.prototype.onClose.call(this)},r([h(cc.Node)],e.prototype,"strike_12_record",void 0),r([h(cc.Node)],e.prototype,"itemStrike",void 0),r([h(cc.Node)],e.prototype,"roundList",void 0),r([h(cc.Node)],e.prototype,"betNumList",void 0),r([h(cc.Label)],e.prototype,"roundDIY",void 0),r([h(cc.Node)],e.prototype,"gems",void 0),r([h(cc.Label)],e.prototype,"betNumDIY",void 0),r([h(cc.Node)],e.prototype,"DIYNode",void 0),r([h(cc.Label)],e.prototype,"DIYTip",void 0),r([h(cc.Node)],e.prototype,"keyBoard",void 0),r([h(cc.Label)],e.prototype,"inputNumStr",void 0),r([h(cc.Label)],e.prototype,"btn_sureTip",void 0),r([h(cc.SpriteFrame)],e.prototype,"iconList",void 0),r([h(cc.Sprite)],e.prototype,"btnSureSpr",void 0),r([h(cc.SpriteFrame)],e.prototype,"btnSureSprArr",void 0),r([p],e)}(c.default);o.default=f,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0}],prizePool:[function(t,e,o){"use strict";cc._RF.push(e,"7c909b6ppxDvbDExa81u7zS","prizePool");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../core/components/PopupBase"),s=cc._decorator,c=s.ccclass,u=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.totalGems=null,e.curRoundGems=null,e.lastRoundGems=null,e}return i(e,t),e.prototype.setData=function(t,e,o){this.totalGems.string=t,this.curRoundGems.string=MyFun.formatDecimalPlaces(e),this.lastRoundGems.string=MyFun.formatDecimalPlaces(o)},e.prototype.btnCloseClicked=function(){this.hide()},e.prototype.onAfterHide=function(){this.node.destroy()},r([u(cc.Label)],e.prototype,"totalGems",void 0),r([u(cc.Label)],e.prototype,"curRoundGems",void 0),r([u(cc.Label)],e.prototype,"lastRoundGems",void 0),r([c],e)}(a.default);o.default=l,cc._RF.pop()},{"../../core/components/PopupBase":void 0}],record:[function(t,e,o){"use strict";cc._RF.push(e,"b3a15fgcM5MDKRwkh7p0973","record");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function a(t){try{c(n.next(t))}catch(e){r(e)}}function s(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,s)}c((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var o,n,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../core/components/LayerBase"),u=t("../../game/beastMgr"),l=t("../../proto/mystibeast_pb"),d=cc._decorator,p=d.ccclass,h=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scrollView=null,e.strike_12_record=null,e.itemStrike=null,e.list=null,e.item=null,e.iconList=[],e}return i(e,t),e.prototype.start=function(){this.loadRecord()},e.prototype.loadRecord=function(){return a(this,void 0,void 0,function(){var t,e=this;return s(this,function(){return t=new l.StrikeBeastRoundRecordReq,u.default.inst.strikeBeastClient.strikeBeastRoundRecord(t,u.default.inst.metadata).then(function(t){if(0==t.getResult()){var o=t.getStrikebeastroundrecordresp().toObject();cc.log(o),e.loadStrike_12_records(o.roundListList),e.loadPlayerRecord(o.userListList)}else cc.log("errorCode",t.getCode(),"errorMsg",t.getMsg()),u.default.inst.handleCode(t.getCode())}),[2]})})},e.prototype.loadStrike_12_records=function(t){var e=this.strike_12_record.children[1];if(0!=(t=MyFun.sortByObjectValue(t,"roundId")).length)for(var o=0,n=t.length;o<n;o++){var i=t[o],r=cc.instantiate(this.itemStrike);r.active=!0,r.parent=e,r.getChildByName("round").getComponent(app.i18nLabel).init("strikeBeast_record3",[i.id.toString()]),r.getChildByName("avg").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(i.attackPower),1);var a=3==i.status?0:1;r.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.iconList[a]}},e.prototype.loadPlayerRecord=function(t){this.loadByFrames(t)},e.prototype.loadByFrames=function(t){var e=this,o=t.length,n=0,i=function(){for(var r=Math.min(o-n,30),a=0;a<r;a++)e.addItem(n,t),n++;n<o?e.scheduleOnce(function(){return i()}):e.scheduleOnce(function(){e.improveDC()})};i()},e.prototype.addItem=function(t,e){if(!(t>=e.length)){var o=cc.instantiate(this.item);o.active=!0;var n=e[t],i=o.getChildByName("result");3==n.roundStatus?(i.color=MyFun.hexToRGBA("#EDB284"),i.getComponent(app.i18nLabel).init("strikeBeast_record5",[])):4==n.roundStatus?(i.color=MyFun.hexToRGBA("#F5173E"),i.getComponent(app.i18nLabel).init("strikeBeast_record6",[])):1==n.roundStatus&&i.getComponent(app.i18nLabel).init("strikeBeast_record7",[]),o.getChildByName("round").getComponent(app.i18nLabel).init("strikeBeast_record3",[n.roundId.toString()]),o.getChildByName("time").getComponent(cc.Label).string=MyFun.formattedDateTime(1e3*n.roundTime),o.getChildByName("v1").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(n.useDaggersNum)),o.getChildByName("v2").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(n.damageDaggersNum)),o.getChildByName("v3").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(n.beastBlood)),o.getChildByName("v4").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(n.carryGems)),o.getChildByName("v5").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(n.attackPower)),o.getChildByName("v6").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(n.allocateGems)),o.parent=this.list}},e.prototype.improveDC=function(){if(0!=this.list.childrenCount){var t=this.scrollView.parent.convertToWorldSpaceAR(cc.v2(this.scrollView.x-this.scrollView.anchorX*this.scrollView.width,this.scrollView.y-this.scrollView.anchorY*this.scrollView.height)),e=cc.rect(t.x,t.y,this.scrollView.width,this.scrollView.height);this.list.children.forEach(function(t){t.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})}),this.strike_12_record.children[1].getBoundingBoxToWorld().intersects(e)?0===this.strike_12_record.opacity&&(this.strike_12_record.opacity=255):0!==this.strike_12_record.opacity&&(this.strike_12_record.opacity=0)}},e.prototype.btnCloseClicked=function(){t.prototype.onClose.call(this)},r([h(cc.Node)],e.prototype,"scrollView",void 0),r([h(cc.Node)],e.prototype,"strike_12_record",void 0),r([h(cc.Node)],e.prototype,"itemStrike",void 0),r([h(cc.Node)],e.prototype,"list",void 0),r([h(cc.Node)],e.prototype,"item",void 0),r([h(cc.SpriteFrame)],e.prototype,"iconList",void 0),r([p],e)}(c.default);o.default=f,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0}],result:[function(t,e,o){"use strict";cc._RF.push(e,"b49c6ERaH1GDbD9u7GkcIQ6","result");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../game/beast_config"),s=t("../../game/beastMgr"),c=cc._decorator,u=c.ccclass,l=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.suc=null,e.fail=null,e.normal=null,e.goldSpear=[],e.endCb=null,e}return i(e,t),e.prototype.start=function(){s.default.inst.beastModule&&this.goldSpear.forEach(function(t){t.active=!0})},e.prototype.waitToDestroy=function(t){var e=this;this.scheduleOnce(function(){e.endCb&&e.endCb(),e.node.destroy()},t)},e.prototype.setEndCall=function(t){this.endCb=t},e.prototype.showSuc=function(t,e,o){app.AudioMgr.play(a.Bundles.Common,"Settlement"),this.waitToDestroy(3),this.suc.getChildByName("tip").getComponent(app.i18nLabel).init("strikeBeast_result1",[MyFun.formatDecimalPlaces(t,0)]),this.suc.getChildByName("lost").getComponent(cc.Label).string=e.toFixed(0),this.suc.getChildByName("get").getComponent(cc.Label).string=o.toFixed(2),this.suc.active=!0},e.prototype.showFail=function(t){app.AudioMgr.play(a.Bundles.Common,"Settlement"),this.waitToDestroy(3),this.fail.getChildByName("tip").getComponent(app.i18nLabel).init("strikeBeast_result1",[MyFun.formatDecimalPlaces(t)]),this.fail.active=!0},e.prototype.showNormal=function(t,e){app.AudioMgr.play(a.Bundles.Common,"Settlement"),this.waitToDestroy(3),this.normal.getChildByName("atk").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(t),this.normal.getChildByName("total").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(e),this.normal.active=!0},r([l(cc.Node)],e.prototype,"suc",void 0),r([l(cc.Node)],e.prototype,"fail",void 0),r([l(cc.Node)],e.prototype,"normal",void 0),r([l(cc.Node)],e.prototype,"goldSpear",void 0),r([u],e)}(cc.Component);o.default=d,cc._RF.pop()},{"../../game/beastMgr":void 0,"../../game/beast_config":void 0}],strikeBeast:[function(t,e,o){"use strict";cc._RF.push(e,"12b75D3UbdEd45vq6ZIJ2fF","strikeBeast");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,o,a):i(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function a(t){try{c(n.next(t))}catch(e){r(e)}}function s(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(a,s)}c((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var o,n,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../core/components/gameBase"),u=t("../../game/beast_config"),l=t("../../game/beastMgr"),d=t("../../proto/mystibeast_pb"),p=t("./atkRole"),h=t("./atkSpear"),f=t("./autoPlay"),g=t("./prizePool"),y=t("./record"),m=t("./result"),b=cc._decorator,v=b.ccclass,_=b.property,k=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dagger=null,e.dagger2=null,e.prizePoolLab=null,e.curRoundGetLab=null,e.curRoundCostLab=null,e.aniArea=null,e.road=null,e.atkRolePre=null,e.monster=null,e.monsterSke=null,e.spearPre=null,e.atkSet=null,e.atkMain=null,e.atkSpearInput=null,e.content=null,e.countDown=null,e.timeLab=null,e.monsterHP=null,e.avgTipNode=null,e.avgLab=null,e.goldSpear=[],e.menulist=null,e.menu=null,e.btnAuto=null,e.scrollView=null,e.viewContent=null,e.ruleNode=null,e.roleMap=new Map,e.prizeGems=0,e.curRoundId=0,e.myUseDagger=0,e.myDagger=0,e.openGems=0,e.openState=!1,e.nowtime=0,e.isModuleValid=!1,e.isAutoPlay=!1,e.beast_Blood_init=0,e.beast_Blood_cur=0,e.round_carryGems=0,e.round_atk_daggers=0,e.round_atk_power=0,e.round_atk_normal=0,e.round_atk_gold=0,e.deadline=0,e.atkFunc=null,e.prizePoolSchedule=null,e.timeCountFun=null,e.lastCarryGems=0,e.curState=0,e.playerNode=null,e.isShow=!1,e}return i(e,t),e.prototype.onLoad=function(){var t=this;this.viewContent.height=cc.winSize.height+this.ruleNode.height,this.scheduleOnce(function(){t.viewContent.height=cc.winSize.height+t.ruleNode.height,t.ruleNode.opacity=255},1),cc.director.getCollisionManager().enabled=!0,this.atkSpearInput.node.on("text-changed",this.editBoxDidChange,this)},e.prototype.onEnable=function(){app.AudioMgr.playMusic(u.Bundles.Game_BeastStrike,"CounterattackBgm")},e.prototype.start=function(){t.prototype.start.call(this),this.joinGame()},e.prototype._onEventHide=function(){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return t.prototype._onEventHide.call(this),this.unscheduleAllCallbacks(),[4,l.default.inst.leaveGame()];case 1:return e.sent(),[2]}})})},e.prototype._onEventShow=function(){t.prototype._onEventShow.call(this),this.unscheduleAllCallbacks(),this.joinGame()},e.prototype.joinGame=function(){var t=this,e=new d.JoinGameReq;e.setDeviceId(l.default.inst.deviceId),e.setIp(l.default.inst.ip);var o=l.default.inst.strikeBeastClient.joinGame(e,l.default.inst.metadata);o.on("data",function(e){switch(e.getAnyCase()){case d.MessagePush.AnyCase.KICKUSERPUSH:var o=e.getKickuserpush();t._handleKickUserPush(o);break;case d.MessagePush.AnyCase.STRIKEBEASTATTACKPUSH:var n=e.getStrikebeastattackpush();t._handleAtkPush(n);break;case d.MessagePush.AnyCase.STRIKEBEASTSTATECHANGEPUSH:var i=e.getStrikebeaststatechangepush();t._handleStatePush(i);break;default:cc.log("Unknown message type")}}),o.on("end",function(){cc.log("Server ended the call")}),o.on("error",function(t){cc.error("Error:",t)}),o.on("status",function(e){return a(t,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return cc.log("Status:",e),null===l.default.inst?[3,3]:(l.default.inst.stopRoll=!0,14!=e.code?[3,1]:(l.default.inst.handleCode(e.code),[3,3]));case 1:return 16!=e.code?[3,3]:(l.default.inst.isKickOut=!0,l.default.inst.handleCode(e.code),[4,this.wait(1.2)]);case 2:t.sent(),l.default.inst.sendMsgToUniApp("logout"),t.label=3;case 3:return[2]}})})}),this._generateAttacker(),this._getRoomInfo()},e.prototype._getRoomInfo=function(){var t=this,e=new d.StrikeBeastRoundInfoReq;l.default.inst.strikeBeastClient.strikeBeastRoundInfo(e,l.default.inst.metadata).then(function(e){if(0==e.getResult()){var o=e.getStrikebeastroundinforesp().toObject();cc.log("roomInfo",o),t.nowtime=o.nowTime,l.default.inst.userId=o.userId,t._handleModuleConnected(o.bcomingModuleValid,o.autoId),t.generatePlayer(l.default.inst.userId),t.openGems=MyFun.getRealNum(o.openGems),t.openState=o.openState,t.openState||(l.default.inst.stopRoll=!0,t._setMonsterAni("daiji")),t.prizeGems=MyFun.getRealNum(o.prizePool),t.myUseDagger=MyFun.getRealNum(o.useDaggersNum),t.myDagger=MyFun.getRealNum(o.myDaggersNum),l.default.inst.mydaggers=t.myDagger,t.prizePoolLab.string=t.prizeGems.toFixed(3),t._refreshUI(),t._handleCurRoundInfo(o.roundInfo),t._handleLastRoundInfo(o.lastRoundInfo)}else cc.log("errorCode",e.getCode(),"errorMsg",e.getMsg()),l.default.inst.handleCode(e.getCode())}).catch(function(t){cc.log(t)})},e.prototype._handleModuleConnected=function(t,e){this.isModuleValid=t,l.default.inst.beastModule=t,this.goldSpear.forEach(function(e){e.active=t}),this.isAutoPlay=e>0},e.prototype._handleCurRoundInfo=function(t){return a(this,void 0,void 0,function(){return s(this,function(){return null==t?[2]:(this.prizePoolAni(),this.curRoundId=t.id,this.beast_Blood_init=MyFun.getRealNum(t.initBlood),this.beast_Blood_cur=MyFun.getRealNum(t.beastBlood),this.round_carryGems=MyFun.getRealNum(t.carryGems),this.round_atk_daggers=MyFun.getRealNum(t.attackDaggers),this.round_atk_normal=MyFun.getRealNum(t.attackNormalDaggers),this.round_atk_gold=MyFun.getRealNum(t.attackGoldDaggers),this.round_atk_power=MyFun.getRealNum(t.attackPower),this.deadline=t.deadline,this.curState=t.status,1==t.status?(l.default.inst.stopRoll=!1,this._setAttackerAni("zoulu"),this.initMonster(),this._countPlayerGetGems(),this._showLiveTime(),this._showBlood(),this.setAtkTask(),this.countDown.children[0].getComponent(app.i18nLabel).init("strikeBeast_main3",[])):2==t.status?(this.unschedule(this.atkFunc),this._setAttackerAni("daiji"),l.default.inst.stopRoll=!0,this.countDown.active=!1):3==t.status?(l.default.inst.stopRoll=!0,this.monster.active=!0,this.monster.opacity=255,this.monsterHP.node.active=!1,this._setMonsterAni("siwang2xunhuan",!0),this.countDown.children[0].getComponent(app.i18nLabel).init("strikeBeast_main8",[]),this._showLiveTime()):4==t.status&&(this.monster.opacity=0,this._getBeastAttackRoundResult()),[2])})})},e.prototype.setAtkTask=function(){var t=this;this.schedule(this.atkFunc=function(){return a(t,void 0,void 0,function(){var t,e,o;return s(this,function(n){switch(n.label){case 0:t=MyFun.getRandomInteger(1,5),e=0,n.label=1;case 1:return e<t?[4,this.wait(.1*e)]:[3,4];case 2:n.sent(),o=Math.random()>.5,this.randomAttack(o),n.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},1)},e.prototype.prizePoolAni=function(){var t=this;this.unschedule(this.prizePoolSchedule);var e=function(){var e=Number(t.prizePoolLab.string),o=e+MyFun.getRandomFloat(.01,.1);o<=0||MyFun._jumpNumberAsync(e,o,1,t.prizePoolLab,3)};e(),this.schedule(this.prizePoolSchedule=function(){e()},2)},e.prototype.initMonster=function(){this.monster.active=!0,this.monster.opacity=255,this.monsterHP.node.active=!0,this._setMonsterAni("zou1")},e.prototype._showLiveTime=function(){var t=this.deadline-this.nowtime;this.countDown.active=!0,this.showTime(t)},e.prototype.showTime=function(t){var e=this;this.unschedule(this.timeCountFun);var o=MyFun.formatTimeToHMS(t);t<=0?this.timeLab.getComponent(cc.Label).string="":(this.timeLab.getComponent(cc.Label).string=o,t--,this.schedule(this.timeCountFun=function(){t>=0?(o=MyFun.formatTimeToHMS(t),e.timeLab.getComponent(cc.Label).string=o,t--):(e.timeLab.getComponent(cc.Label).string="00:00",e.unschedule(e.timeCountFun),e.scheduleOnce(function(){cc.log("time end, curState",e.curState),3==e.curState&&e._getRoomInfo()},1))},1))},e.prototype._showBlood=function(){this.monsterHP.node.active=!0;var t=Number((this.beast_Blood_cur/this.beast_Blood_init).toFixed(2));this.monsterHP.progress=t,t<=.5?(this.avgTipNode.active=!0,this.avgLab.string=this.round_atk_power.toFixed(2)):this.avgTipNode.active=!1},e.prototype._setMonsterHP=function(t){cc.log("hp",t),t<0&&(t=0),cc.tween(this.monsterHP).to(.1,{progress:t}).start()},e.prototype._handleLastRoundInfo=function(t){null!=t&&(this.lastCarryGems=MyFun.getRealNum(t.carryGems))},e.prototype._generateAttacker=function(){if(!(this.roleMap.size>0))for(var t=0;t<15;t++)this.generateRole(t)},e.prototype._setAttackerAni=function(t){this.roleMap.forEach(function(e){e.getComponent(p.default).playAni(t)})},e.prototype._countPlayerGetGems=function(){var t=this._checkRewardLevel(),e=this.myUseDagger/this.round_atk_daggers,o=this.round_carryGems*t*e;isNaN(o)&&(o=0),this.curRoundGetLab.string=MyFun.formatDecimalPlaces(o)},e.prototype._checkRewardLevel=function(){var t=Number((this.myUseDagger/this.round_atk_power*100).toFixed(0));return t>=85&&t<=115?.5:t>=75&&t<85||t>115&&t<=125?.3:t>=65&&t<75||t>125&&t<=135?.2:0},e.prototype._handleKickUserPush=function(t){return a(this,void 0,void 0,function(){var e;return s(this,function(o){switch(o.label){case 0:return e=t.toObject(),cc.log("\u8e22\u4eba\u63a8\u9001",e,l.default.inst.userId),e.userId!=l.default.inst.userId?[3,2]:(l.default.inst.showWarning("beast_netmsg01"),l.default.inst.isKickOut=!0,[4,this.wait(1.2)]);case 1:o.sent(),l.default.inst.sendMsgToUniApp("logout"),o.label=2;case 2:return[2]}})})},e.prototype._handleAtkPush=function(t){return a(this,void 0,void 0,function(){var e,o;return s(this,function(){return e=t.toObject(),cc.log("\u653b\u51fb\u63a8\u9001",e),this.round_atk_daggers=MyFun.getRealNum(e.attackDaggers),this.round_atk_power=MyFun.getRealNum(e.attackPower),e.userId==l.default.inst.userId&&(this._showAttackAni(this.playerNode,e.isGoldDagger),this.isAutoPlay&&(this.myDagger=MyFun.getRealNum(e.useDaggersNum),this._refreshUI())),o=Number((MyFun.getRealNum(e.beastLeftBlood)/this.beast_Blood_init).toFixed(2)),this._setMonsterHP(o),o<=.5&&(this.avgTipNode.active=!0,this.avgLab.string=this.round_atk_power.toFixed(2)),this._countPlayerGetGems(),[2]})})},e.prototype.randomAttack=function(t){var e=MyFun.getRandomInteger(0,15),o=this.roleMap.get(e);this._showAttackAni(o,t)},e.prototype._handleStatePush=function(t){return a(this,void 0,void 0,function(){var e;return s(this,function(o){switch(o.label){case 0:return e=t.toObject(),cc.log("\u72b6\u6001\u63a8\u9001",e),this.curState=e.state,2!=e.state?[3,1]:(this.unschedule(this.atkFunc),l.default.inst.stopRoll=!0,this._setAttackerAni("daiji"),this.countDown.active=!1,[3,5]);case 1:return 3!=e.state?[3,4]:[4,this.wait(1)];case 2:return o.sent(),this.monsterHP.node.active=!1,app.AudioMgr.play(u.Bundles.Game_BeastStrike,"TheMonsterFalls"),this._setMonsterAni("siwang1daodi",!1),[4,this.wait(1)];case 3:return o.sent(),this._setMonsterAni("siwang2xunhuan",!0),this.countDown.active=!0,this.countDown.children[0].getComponent(app.i18nLabel).init("strikeBeast_main8",[]),this._getBeastAttackRoundResult(),[3,5];case 4:4==e.state&&(this.unschedule(this.atkFunc),this.monster.opacity=0,this._getBeastAttackRoundResult()),o.label=5;case 5:return[2]}})})},e.prototype._refreshUI=function(){this.dagger.string=MyFun.formatDecimalPlaces(this.myDagger),this.dagger2.string=MyFun.formatDecimalPlaces(this.myDagger),this.curRoundCostLab.string=MyFun.formatDecimalPlaces(this.myUseDagger)},e.prototype._beastAttack=function(t){var e=this,o=new d.StrikeBeastAttackReq;o.setRoundId(this.curRoundId),o.setDaggersNum(t),l.default.inst.strikeBeastClient.strikeBeastAttackOp(o,l.default.inst.metadata).then(function(t){if(0==t.getResult()){var o=t.getStrikebeastattackresp().toObject();cc.log("atkRes",o),e.myUseDagger=MyFun.getRealNum(o.goldDaggersNum+o.normalDaggersNum),e.myDagger=MyFun.getRealNum(o.myDaggersNum),l.default.inst.mydaggers=e.myDagger,e._refreshUI()}else cc.log("errorCode",t.getCode(),"errorMsg",t.getMsg()),l.default.inst.handleCode(t.getCode())})},e.prototype._getBeastAttackRoundResult=function(){var t=this;this.avgTipNode.active=!1;var e=new d.StrikeBeastRoundResultReq;e.setRoundId(this.curRoundId),l.default.inst.strikeBeastClient.strikeBeastRoundResult(e,l.default.inst.metadata).then(function(e){if(0==e.getResult()){var o=e.getStrikebeastroundresultresp().toObject();cc.log("roundResult",o),t.myDagger=MyFun.getRealNum(o.myDaggersNum),l.default.inst.mydaggers=t.myDagger,l.default.inst.myGems=MyFun.getRealNum(o.myGemsNum),t._handleResult(o.roundInfo,o.myRecord),cc.director.emit("refresh_spearRecord"),4==o.roundInfo.status&&t.scheduleOnce(function(){t._getRoomInfo()},1.5)}else cc.log("errorCode",e.getCode(),"errorMsg",e.getMsg()),l.default.inst.handleCode(e.getCode())})},e.prototype._handleResult=function(t,e){this.atkSpearInput.blur(),null!=e?3==t.status?e.useDaggersNum>0?this.showSuc(MyFun.getRealNum(e.putDaggersNum),MyFun.getRealNum(e.useDaggersNum),MyFun.getRealNum(e.allocateGemsNum)):this.showNormal(MyFun.getRealNum(t.attackDaggers),MyFun.getRealNum(t.carryGems)):4==t.status&&(e.useDaggersNum>0?this.showFail(MyFun.getRealNum(e.useDaggersNum)):this.showNormal(MyFun.getRealNum(t.attackDaggers),MyFun.getRealNum(t.carryGems))):this.showNormal(MyFun.getRealNum(t.attackDaggers),MyFun.getRealNum(t.carryGems))},e.prototype.showSuc=function(t,e,o){return a(this,void 0,void 0,function(){var n,i;return s(this,function(r){switch(r.label){case 0:return[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Game_BeastStrike,u.BeastStrike_Pop.Result))];case 1:return n=r.sent(),(i=cc.instantiate(n)).parent=this.content,i.getComponent(m.default).setEndCall(function(){}),i.getComponent(m.default).showSuc(t,e,o),[2]}})})},e.prototype.showFail=function(t){return a(this,void 0,void 0,function(){var e,o,n=this;return s(this,function(i){switch(i.label){case 0:return[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Game_BeastStrike,u.BeastStrike_Pop.Result))];case 1:return e=i.sent(),(o=cc.instantiate(e)).parent=this.content,o.getComponent(m.default).setEndCall(function(){n.curState}),o.getComponent(m.default).showFail(t),[2]}})})},e.prototype.showNormal=function(t,e){return a(this,void 0,void 0,function(){var o,n,i=this;return s(this,function(r){switch(r.label){case 0:return[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Game_BeastStrike,u.BeastStrike_Pop.Result))];case 1:return o=r.sent(),(n=cc.instantiate(o)).parent=this.content,n.getComponent(m.default).setEndCall(function(){i.curState}),n.getComponent(m.default).showNormal(t,e),[2]}})})},e.prototype._setMonsterAni=function(t,e){void 0===e&&(e=!0),t==this.monsterSke.animation||this.curState>1&&("zou2"==t||"zou1"==t)||this.monsterSke.setAnimation(0,t,e)},e.prototype._setPlayerSkin=function(){var t=l.default.inst.beastModule?"jin":"putong";this.playerNode.children[0].getComponent(sp.Skeleton).setSkin(t)},e.prototype.btnAttackClick=function(){var t=this;this.isAutoPlay?l.default.inst.showConfirm("strikeBeast_auto7",function(){var e=new d.StrikeBeastAutoAttackEndReq;l.default.inst.strikeBeastClient.strikeBeastAutoAttackEnd(e,l.default.inst.metadata).then(function(e){0==e.getCode()?t.isAutoPlay=!1:(2022==e.getCode()&&(t.isAutoPlay=!1),l.default.inst.handleCode(e.getCode()))}).catch(function(t){cc.log(t)})}):this._showAtkSet()},e.prototype.btnAtkNowClick=function(){return a(this,void 0,void 0,function(){var t;return s(this,function(){return(t=Number(this.atkSpearInput.string))<=0?(l.default.inst.showWarning("strikeBeast_tip1"),[2]):Number.isInteger(t)?(this._hideAtkSet(),this._beastAttack(t),[2]):(l.default.inst.showWarning("strikeBeast_tip3"),[2])})})},e.prototype._showAttackAni=function(t,e){void 0===e&&(e=!1);var o=app.nodePoolMgr.getNode(this.spearPre,this.aniArea),n=MyFun.getNodePos(t,this.aniArea);o.setPosition(n.x+30,n.y+80);var i=e?1:0;o.getComponent(h.default).setSkin(i,this.node),this._spearAni(o)},e.prototype._spearAni=function(t){var e=[cc.v2(t.x+(this.monster.x-t.x)/3,t.y+(this.monster.x-t.x)/4),cc.v2(this.monster.x-(this.monster.x-t.x)/4,t.y+(this.monster.x-t.x)/2),cc.v2(this.monster.x+MyFun.getRandomInteger(20,120),this.monster.y-80)],o=.1*MyFun.calculateDis(t.position,this.monster.position)/60;cc.tween(t).parallel(cc.bezierTo(o,e),cc.tween().to(o,{angle:-45})).start()},e.prototype.monsterBeAtk=function(){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this._setMonsterAni("zou2"),[4,this.wait(.3)];case 1:return t.sent(),this._setMonsterAni("zou1"),[2]}})})},e.prototype._showAtkSet=function(){this.atkMain.y=-cc.winSize.height/2-this.atkMain.height/2,this.atkSet.active=!0,cc.tween(this.atkMain).by(.2,{y:this.atkMain.height}).start()},e.prototype.btnAtkSetClose=function(){this._hideAtkSet()},e.prototype._hideAtkSet=function(){var t=this,e=-cc.winSize.height/2-this.atkMain.height/2;cc.tween(this.atkMain).by(.2,{y:e}).call(function(){t.atkSpearInput.string="0",t.atkSet.active=!1}).start()},e.prototype.wait=function(t){var e=this;return new Promise(function(o){e.scheduleOnce(function(){o()},t)})},e.prototype.generatePlayer=function(t){t==l.default.inst.userId&&null==this.playerNode&&this.generateRole(t)},e.prototype.generateRole=function(t){var e=app.nodePoolMgr.getNode(this.atkRolePre,this.road);this.roleMap.set(t,e);var o=Math.random()*(this.road.width-e.width)+this.road.x;e.x=o,e.y=0;var n=t==l.default.inst.userId?0:1;e.getComponent(p.default).setData(n),0==n&&(e.x=0,e.y=-10,this.playerNode=e,this._setPlayerSkin())},e.prototype.collectRole=function(t){var e=this.roleMap.get(t);e&&(app.nodePoolMgr.putNode(e),this.roleMap.delete(t))},e.prototype.editBoxDidChange=function(t){var e=t.string,o=Number(e);o>Number(this.dagger.string)?t.string=parseInt(this.dagger.string).toString():t.string=o.toString(),t._impl._updateStyleSheet()},e.prototype.editBoxDidEnded=function(t){""!=t.string&&Number(t.string)>Number(this.dagger.string)&&(t.string=parseInt(this.dagger.string).toString())},e.prototype.btnSetMaxSpearClick=function(){this.atkSpearInput.string=parseInt(this.dagger.string).toString()},e.prototype.btnSpearClicked=function(){return a(this,void 0,void 0,function(){var t,e;return s(this,function(o){switch(o.label){case 0:return[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Common,u.Common_Pop.MySpear))];case 1:return t=o.sent(),(e=cc.instantiate(t)).parent=this.content,e.getComponent("mySpear").setData(this.myDagger,this.backClickFun.bind(this)),this.enterOtherLayer(),[2]}})})},e.prototype.btnPrizePoolClicked=function(){return a(this,void 0,void 0,function(){var t,e;return s(this,function(o){switch(o.label){case 0:return[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Game_BeastStrike,u.BeastStrike_Pop.PrizePool))];case 1:return t=o.sent(),(e=cc.instantiate(t)).parent=this.content,e.getComponent(g.default).setData(this.prizePoolLab.string,this.round_carryGems,this.lastCarryGems),[2]}})})},e.prototype.btnRecordClicked=function(){return a(this,void 0,void 0,function(){var t,e,o=this;return s(this,function(n){switch(n.label){case 0:return[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Game_BeastStrike,u.BeastStrike_Pop.Record))];case 1:return t=n.sent(),(e=cc.instantiate(t)).parent=this.content,e.getComponent(y.default).setBackCall(function(){o.backClickFun()}),this.enterOtherLayer(),[2]}})})},e.prototype.btnAutoClicked=function(){return a(this,void 0,void 0,function(){var t,e,o=this;return s(this,function(n){switch(n.label){case 0:return this.isModuleValid?[4,MyFun.loadPrefab(u.getPrefabInfo(u.Bundles.Game_BeastStrike,u.BeastStrike_Pop.Autoplay))]:(l.default.inst.showConfirm("confirm_tip1",function(){return a(o,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,l.default.inst.leaveGame()];case 1:return t.sent(),l.default.inst.sendMsgToUniApp("product_beast"),[2]}})})}),[2]);case 1:return t=n.sent(),(e=cc.instantiate(t)).parent=this.content,e.getComponent(f.default).setData(this.isAutoPlay,function(t){o.isAutoPlay=t,o.backClickFun()}),e.getComponent(f.default).setBackCall(function(){o.backClickFun()}),this.enterOtherLayer(),[2]}})})},e.prototype.enterOtherLayer=function(){this.scrollView.node.opacity=0},e.prototype.btnCloseClicked=function(){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return l.default.inst.curLayer!=l.Layer.MAIN?[3,2]:[4,l.default.inst.leaveGame()];case 1:return t.sent(),l.default.inst.backToApp(),[3,3];case 2:this.backClickFun(),t.label=3;case 3:return[2]}})})},e.prototype.backClickFun=function(){l.default.inst.curLayer=l.Layer.MAIN,this.scrollView.node.opacity=255},e.prototype.exitScene=function(){cc.Tween.stopAll(),this.unscheduleAllCallbacks()},e.prototype.onDisable=function(){return a(this,void 0,void 0,function(){return s(this,function(){return t.prototype.onDisable.call(this),this.exitScene(),[2]})})},e.prototype.btnJumpToBeastComingGame=function(){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return cc.audioEngine.stopMusic(),[4,l.default.inst.leaveGame()];case 1:return t.sent(),l.default.inst.jumpToGame(l.gameType.beastComing),[2]}})})},e.prototype.menuClicked=function(){var t=this;this.isShow=!this.isShow;var e=this.isShow?-95:-500;cc.tween(this.menulist).to(.2,{y:e}).call(function(){t.menu.children[1].active=!t.isShow,t.menu.children[2].active=t.isShow}).start()},e.prototype.scrollToRuleInfo=function(){this.scrollView.scrollToOffset(cc.v2(0,cc.winSize.height),.5)},r([_(cc.Label)],e.prototype,"dagger",void 0),r([_(cc.Label)],e.prototype,"dagger2",void 0),r([_(cc.Label)],e.prototype,"prizePoolLab",void 0),r([_(cc.Label)],e.prototype,"curRoundGetLab",void 0),r([_(cc.Label)],e.prototype,"curRoundCostLab",void 0),r([_(cc.Node)],e.prototype,"aniArea",void 0),r([_(cc.Node)],e.prototype,"road",void 0),r([_(cc.Prefab)],e.prototype,"atkRolePre",void 0),r([_(cc.Node)],e.prototype,"monster",void 0),r([_(sp.Skeleton)],e.prototype,"monsterSke",void 0),r([_(cc.Prefab)],e.prototype,"spearPre",void 0),r([_(cc.Node)],e.prototype,"atkSet",void 0),r([_(cc.Node)],e.prototype,"atkMain",void 0),r([_(cc.EditBox)],e.prototype,"atkSpearInput",void 0),r([_(cc.Node)],e.prototype,"content",void 0),r([_(cc.Node)],e.prototype,"countDown",void 0),r([_(cc.Label)],e.prototype,"timeLab",void 0),r([_(cc.ProgressBar)],e.prototype,"monsterHP",void 0),r([_(cc.Node)],e.prototype,"avgTipNode",void 0),r([_(cc.Label)],e.prototype,"avgLab",void 0),r([_(cc.Node)],e.prototype,"goldSpear",void 0),r([_(cc.Node)],e.prototype,"menulist",void 0),r([_(cc.Node)],e.prototype,"menu",void 0),r([_(cc.Node)],e.prototype,"btnAuto",void 0),r([_(cc.ScrollView)],e.prototype,"scrollView",void 0),r([_(cc.Node)],e.prototype,"viewContent",void 0),r([_(cc.Node)],e.prototype,"ruleNode",void 0),r([v],e)}(c.default);o.default=k,cc._RF.pop()},{"../../core/components/gameBase":void 0,"../../game/beastMgr":void 0,"../../game/beast_config":void 0,"../../proto/mystibeast_pb":void 0,"./atkRole":"atkRole","./atkSpear":"atkSpear","./autoPlay":"autoPlay","./prizePool":"prizePool","./record":"record","./result":"result"}]},{},["atkRole","atkSpear","autoPlay","prizePool","record","result","strikeBeast"]);