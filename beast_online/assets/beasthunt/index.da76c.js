window.__require=function t(e,n,o){function r(a,s){if(!n[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){return r(e[a][1][t]||t)},u,u.exports,t,e,n,o)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)r(o[a]);return r}({beastSetItem:[function(t,e,n){"use strict";cc._RF.push(e,"910c5FbQ8VIWpu5JMZs8gJK","beastSetItem");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},a=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(e){i(e)}}function s(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(t){return function(e){return c([t,e])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../../game/beast_config"),l=t("../../game/beastMgr"),u=cc._decorator,p=u.ccclass,h=u.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.isHunting=null,e.selected=null,e.curBeastId=-1,e}return r(e,t),e.prototype.start=function(){},e.prototype.setData=function(t){return a(this,void 0,void 0,function(){var e,n;return s(this,function(o){switch(o.label){case 0:return e=MyFun.findItemFromArr(l.default.inst.BeastConfigList,"cateId",t.cateId),n=this.icon.getComponent(cc.Sprite),[4,MyFun.loadPicFromBundle(c.Bundles.Game_BeastHunt,"beastIcon",e.icon)];case 1:return n.spriteFrame=o.sent(),t.huntId>0&&(this.isHunting.active=!0,this.icon.node.color=MyFun.hexToRGBA("#CCCCCC")),this.curBeastId=t.beastId,[2]}})})},e.prototype.getBeastId=function(){return this.curBeastId},i([h(cc.Sprite)],e.prototype,"icon",void 0),i([h(cc.Node)],e.prototype,"isHunting",void 0),i([h(cc.Node)],e.prototype,"selected",void 0),i([p],e)}(cc.Component);n.default=d,cc._RF.pop()},{"../../game/beastMgr":void 0,"../../game/beast_config":void 0}],hunt_result:[function(t,e,n){"use strict";cc._RF.push(e,"dd5fajy47pAOKYRSCcplfL7","hunt_result");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../game/beast_config"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.time=null,e.cost=null,e.getGems=null,e.getExp=null,e}return r(e,t),e.prototype.start=function(){},e.prototype.setData=function(t,e,n){var o=this;app.AudioMgr.play(a.Bundles.Common,"Settlement"),this.time.node.getComponent(app.i18nLabel).init("game_static_result1",[MyFun.formatSecondToDay(t).toString()]),this.cost.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(e.consumeGems),0),this.getGems.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(e.gainGems)),this.getExp.string=e.gainExp.toString(),this.scheduleOnce(function(){n&&n(),o.node.destroy()},3)},i([l(cc.Label)],e.prototype,"time",void 0),i([l(cc.Label)],e.prototype,"cost",void 0),i([l(cc.Label)],e.prototype,"getGems",void 0),i([l(cc.Label)],e.prototype,"getExp",void 0),i([c],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../game/beast_config":void 0}],mapCtrl:[function(t,e,n){"use strict";cc._RF.push(e,"d795aWzA9dHiKsnl4y34e2+","mapCtrl");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scrollBgList=[],e}return r(e,t),e.prototype.start=function(){},e.prototype.setScroll=function(t){t?this.scrollBgList.forEach(function(t){t.getComponent(app.bgCtrl).enabled=!0}):this.scrollBgList.forEach(function(t){t.getComponent(app.bgCtrl).enabled=!1})},i([c(cc.Node)],e.prototype,"scrollBgList",void 0),i([s],e)}(cc.Component);n.default=l,cc._RF.pop()},{}],treasureAreaSet:[function(t,e,n){"use strict";cc._RF.push(e,"d93aak4d7VCGra5QVsD8Ufo","treasureAreaSet");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../core/components/LayerBase"),s=t("../../game/beastMgr"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.list=null,e.item=null,e.unlockMapList=[],e.lockMapList=[],e.labelBg=[],e.backCall=null,e.enterCall=null,e}return r(e,t),e.prototype.setCall=function(e,n,o){this.backCall=n,t.prototype.setBackCall.call(this,this.backCall),this.enterCall=o,this.loadMapInfo(e.getRegionTimesMap())},e.prototype.loadMapInfo=function(t){for(var e=this,n=function(n){var r=s.default.inst.treasureHuntRegion[n],i=cc.instantiate(o.item);i.active=!0,i.parent=o.list,i.children[2].children[0].getComponent(app.i18nLabel).init(r.name,[]),i.children[2].children[1].getComponent(app.i18nLabel).init("game_static_set4",[r.huntMinrate/1e4*100+"%~"+r.huntMaxrate/1e4*100+"%"]),i.children[4].getChildByName("timeV").getComponent(app.i18nLabel).init("game_static_set13",[MyFun.formatSecondToDay(r.huntTime).toString()]),i.children[5].getChildByName("costV").getComponent(cc.Label).string=r.cost;var a=t.get(n),c=r.exploreNumber.split("|"),l=0;if(2==c.length&&(l=parseInt(c[1])),cc.log(r.id,a,l),s.default.inst.level>=r.huntlvRequire&&(a>=l||0==l))i.children[0].getComponent(cc.Sprite).spriteFrame=o.unlockMapList[n],i.getChildByName("btnGo").active=!0,i.getChildByName("btnGo").on("click",function(){s.default.inst.curMapId=r.id,e.enterCall&&e.enterCall()});else{i.getChildByName("lock").active=!0;var u=i.getChildByName("lock"),p=MyFun.findItemFromArr(s.default.inst.treasureHuntRegion,"id",c[0]),h=app.i18nMgr._getLabel(p.name,[]);s.default.inst.level<r.huntlvRequire&&(u.children[0].active=!0,u.children[0].getComponentInChildren(cc.Label).string="lv "+s.default.inst.level+"/"+r.huntlvRequire),(null==a||a<l)&&(u.children[1].active=!0,null==a&&(a=0),u.children[1].getComponentInChildren(cc.Label).string=h+" "+a+"/"+l),i.getChildByName("btnGo").active=!1,i.children[2].children[1].color=MyFun.hexToRGBA("#CCCCCC"),i.children[0].getComponent(cc.Sprite).spriteFrame=o.lockMapList[n],i.children[2].getComponent(cc.Sprite).spriteFrame=o.labelBg[1]}},o=this,r=0;r<s.default.inst.treasureHuntRegion.length;r++)n(r)},e.prototype.backClicked=function(){t.prototype.onClose.call(this)},i([u(cc.Node)],e.prototype,"list",void 0),i([u(cc.Node)],e.prototype,"item",void 0),i([u(cc.SpriteFrame)],e.prototype,"unlockMapList",void 0),i([u(cc.SpriteFrame)],e.prototype,"lockMapList",void 0),i([u(cc.SpriteFrame)],e.prototype,"labelBg",void 0),i([l],e)}(a.default);n.default=p,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0}],treasureBeastSet:[function(t,e,n){"use strict";cc._RF.push(e,"e9f26ixQ6BJl5YYk2hWkAEI","treasureBeastSet");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},a=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(e){i(e)}}function s(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(t){return function(e){return c([t,e])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o};Object.defineProperty(n,"__esModule",{value:!0});var l=t("../../core/components/LayerBase"),u=t("../../game/beastMgr"),p=t("../../proto/mystibeast_pb"),h=t("./beastSetItem"),d=cc._decorator,f=d.ccclass,y=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mapBg=null,e.mapName=null,e.huntGet=null,e.huntTime=null,e.huntCost=null,e.unlockMapList=[],e.scrollView=null,e.content=null,e.beastItem=null,e.costLab=null,e.beastPos=[],e.spineData=null,e.cost=0,e.beastPosLimit=1,e.startHuntCb=null,e.beastSetArr=[],e.beastPosArr=[-1,-1],e.curPos=0,e}return r(e,t),e.prototype.start=function(){this._loadMapInfo()},e.prototype._loadMapInfo=function(){this.mapBg.spriteFrame=this.unlockMapList[u.default.inst.curMapId-1];var t=MyFun.findItemFromArr(u.default.inst.treasureHuntRegion,"id",u.default.inst.curMapId);this.mapName.node.getComponent(app.i18nLabel).string=t.name,this.huntGet.node.getComponent(app.i18nLabel).init("game_static_set4",[t.huntMinrate/1e4*100+"%~"+t.huntMaxrate/1e4*100+"%"]),this.huntTime.node.getComponent(app.i18nLabel).init("game_static_set13",[MyFun.formatSecondToDay(t.huntTime).toString()]),this.huntCost.string=t.cost,this.cost=Number(t.cost),u.default.inst.magicModule&&(this.beastPosLimit=2,this.beastPos[1].getChildByName("lock").active=!1)},e.prototype.setCall=function(t,e){void 0===e&&(e=null),this.startHuntCb=e;var n=this.sortBeastListByQuality(t);cc.log(n),this.loadMyBeastList(n)},e.prototype.sortBeastListByQuality=function(t){var e=function(t){var e=MyFun.findItemFromArr(u.default.inst.BeastConfigList,"cateId",t.cateId);return e?e.quality:0},n=t.filter(function(t){return t.huntId<=0}).sort(function(t,n){return e(n)-e(t)}),o=t.filter(function(t){return t.huntId>0}).sort(function(t,n){return e(n)-e(t)});return c(n,o)},e.prototype.loadMyBeastList=function(t){this.content.removeAllChildren(),this.loadByFrames(t)},e.prototype.loadByFrames=function(t){var e=this,n=t.length,o=0,r=function(){for(var i=Math.min(n-o,30),a=0;a<i;a++)e.addItem(o,t),o++;o<n?e.scheduleOnce(function(){return r()}):e.scheduleOnce(function(){e.improveDC()})};r()},e.prototype.addItem=function(t,e){return a(this,void 0,void 0,function(){var n,o,r=this;return s(this,function(){return t>=e.length?[2]:(n=e[t],(o=cc.instantiate(this.beastItem)).active=!0,o.parent=this.content,o.getComponent(h.default).setData(n),n.huntId<=0&&o.on("click",function(){r.beastSelectHandle(n.beastId,n.cateId,o,t)}),[2])})})},e.prototype.posBeastSetClick=function(t,e){if(-1!==this.beastPosArr[e]){this.curPos=e,this.beastPos[e].getChildByName("ani").getComponent(sp.Skeleton).skeletonData=null;var n=this.beastPosArr[e];this.content.children[n].getChildByName("select").active=!1,this.beastPosArr[e]=-1;var o=this.content.children[n].getComponent(h.default).getBeastId(),r=this.beastSetArr.indexOf(o);this.beastSetArr.splice(r,1)}this.costLab.node.getComponent(app.i18nLabel).init("game_static_set7",[(this.cost*this.beastSetArr.length).toString()]),this.beastPosArr[0]==this.beastPosArr[1]&&-1==this.beastPosArr[0]&&(this.curPos=0)},e.prototype.beastSelectHandle=function(t,e,n,o){return a(this,void 0,void 0,function(){var r;return s(this,function(){if(r=this.beastSetArr.indexOf(t),MyFun.findItemFromArr(u.default.inst.BeastConfigList,"cateId",e),-1==r){if(this.beastSetArr.length>=this.beastPosLimit)return u.default.inst.showWarning("game_static_set10"),[2];this.beastSetArr.push(t),this.beastPosArr[this.curPos]=o,n.getChildByName("select").active=!0,cc.log("curPos",this.curPos),this.beastPos[this.curPos].getChildByName("ani").getComponent(sp.Skeleton).skeletonData=this.spineData,this.beastPos[this.curPos].getChildByName("ani").getComponent(sp.Skeleton).setSkin("skin_beast_101"),this.beastPos[this.curPos].getChildByName("ani").getComponent(sp.Skeleton).setAnimation(0,"daiji",!0),this.curPos++}return this.costLab.node.getComponent(app.i18nLabel).init("game_static_set7",[(this.cost*this.beastSetArr.length).toString()]),[2]})})},e.prototype.btnStartHuntClicked=function(){var t=this;if(0!=this.beastSetArr.length)if(this.cost*this.beastSetArr.length>u.default.inst.myGems)u.default.inst.showWarning("beast_netmsg04");else{var e=new p.TreasureHuntStartReq;e.setHuntNo(u.default.inst.curHuntNo),e.setRegionId(u.default.inst.curMapId),e.setBeastIdsList(this.beastSetArr),u.default.inst.treasureHuntClient.treasureHuntStart(e,u.default.inst.metadata).then(function(e){0==e.getResult()?(cc.log("\u5bfb\u5b9d\u8bbe\u7f6e\u6210\u529f"),u.default.inst.myGems=MyFun.getRealNum(e.getTreasurehuntstartresp().getMyGemsNum()),t.startHuntCb&&t.startHuntCb()):(cc.log("errCode",e.getCode(),"errMsg",e.getMsg()),u.default.inst.handleCode(e.getCode()))}).catch(function(t){u.default.inst.handleCode(t.code)})}else u.default.inst.showWarning("game_static_set11")},e.prototype.btnUnlockPosClicked=function(){u.default.inst.showConfirm("game_static_set12",function(){u.default.inst.sendMsgToUniApp("product_magical")})},e.prototype.backClicked=function(){t.prototype.onClose.call(this)},e.prototype.improveDC=function(){if(0!=this.content.childrenCount){var t=this.scrollView.parent.convertToWorldSpaceAR(cc.v2(this.scrollView.x-this.scrollView.anchorX*this.scrollView.width,this.scrollView.y-this.scrollView.anchorY*this.scrollView.height)),e=cc.rect(t.x,t.y,this.scrollView.width,this.scrollView.height);this.content.children.forEach(function(t){t.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})})}},i([y(cc.Sprite)],e.prototype,"mapBg",void 0),i([y(cc.Label)],e.prototype,"mapName",void 0),i([y(cc.Label)],e.prototype,"huntGet",void 0),i([y(cc.Label)],e.prototype,"huntTime",void 0),i([y(cc.Label)],e.prototype,"huntCost",void 0),i([y(cc.SpriteFrame)],e.prototype,"unlockMapList",void 0),i([y(cc.Node)],e.prototype,"scrollView",void 0),i([y(cc.Node)],e.prototype,"content",void 0),i([y(cc.Node)],e.prototype,"beastItem",void 0),i([y(cc.Label)],e.prototype,"costLab",void 0),i([y(cc.Node)],e.prototype,"beastPos",void 0),i([y(sp.SkeletonData)],e.prototype,"spineData",void 0),i([f],e)}(l.default);n.default=g,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0,"./beastSetItem":"beastSetItem"}],treasureHunt:[function(t,e,n){"use strict";cc._RF.push(e,"a87c5iW0aRPB645xdGopmAi","treasureHunt");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a},a=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,i){function a(t){try{c(o.next(t))}catch(e){i(e)}}function s(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(t){return function(e){return c([t,e])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=t("../../core/components/gameBase"),l=t("../../game/beast_config"),u=t("../../game/beastMgr"),p=t("../../proto/mystibeast_pb"),h=t("./hunt_result"),d=t("./mapCtrl"),f=t("./treasureAreaSet"),y=t("./treasureBeastSet"),g=t("./treasureLevelUp"),m=t("./treasureLog"),v=cc._decorator,b=v.ccclass,_=v.property,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levelLab=null,e.mainLayer=null,e.content=null,e.scrollView=null,e.teamListN=null,e.item=null,e.mapList=[],e.upgrade=null,e.levelInfo=null,e.levelProgress=null,e.levelNum=null,e.spineData=null,e.topNode=null,e.refreshThreshold=200,e.isRefreshing=!1,e.isOverThreshold=!1,e.refreshDuration=20,e.myInfo=null,e.teamList=[],e.beastList=[],e.nowTime=0,e.curLevel=0,e.curExp=0,e.curUnlockTeam=0,e}return r(e,t),e.prototype.onLoad=function(){this.scrollView.on("bounce-top",this.onBounceTop,this),this.scrollView.on("scrolling",this.onScrolling,this)},e.prototype.onEnable=function(){app.AudioMgr.playMusic(l.Bundles.Game_BeastHunt,"TreasureHuntBgm")},e.prototype.onBounceTop=function(){this.isOverThreshold&&!this.isRefreshing&&this.startRefresh()},e.prototype.onScrolling=function(){this.isRefreshing||(this.scrollView.getComponent(cc.ScrollView).getScrollOffset().y<=-this.refreshThreshold?this.isOverThreshold=!0:this.isOverThreshold=!1)},e.prototype.start=function(){return a(this,void 0,void 0,function(){var e=this;return s(this,function(){return t.prototype.start.call(this),MyFun.loadRemoteJsonByFetch(l.configJsonUrl.treasureHuntBeast).then(function(t){u.default.inst.BeastConfigList=t,e._getTreasureHuntInfo()}),[2]})})},e.prototype.startRefresh=function(){var t=this;cc.log("refreshing..."),this.isRefreshing=!0,this._getTreasureHuntInfo(),this.scheduleOnce(function(){t.endRefresh()},this.refreshDuration)},e.prototype.endRefresh=function(){this.isRefreshing=!1},e.prototype._getTreasureHuntInfo=function(){var t=this;this.unscheduleAllCallbacks();var e=new p.TreasureHuntInfoReq;u.default.inst.treasureHuntClient.treasureHuntInfo(e,u.default.inst.metadata).then(function(e){if(0==e.getResult()){var n=e.getTreasurehuntinforesp().toObject();cc.log(n),t.myInfo=e.getTreasurehuntinforesp().getMyInfo(),t.teamList=n.teamListList,t.beastList=n.beastListList,u.default.inst.myGems=MyFun.getRealNum(n.myGemsNum),u.default.inst.userId=n.myInfo.userId,u.default.inst.magicModule=n.myInfo.beastModuleValid,t.nowTime=n.nowTime,t._handleMyInfo(n.myInfo),t._handleTeamList()}else cc.log("errCode",e.getCode(),"errMsg",e.getMsg()),u.default.inst.handleCode(e.getCode())}).catch(function(t){cc.log("errCode",t,"errMsg",t.messsage),u.default.inst.handleCode(t.code)})},e.prototype._handleMyInfo=function(t){this.levelLab.node.getComponent(app.i18nLabel).init("game_static_main2",[t.huntLevel.toString()]),this.curLevel=t.huntLevel,this.curExp=t.huntExp,u.default.inst.level=t.huntLevel;var e=MyFun.findItemFromArr(u.default.inst.treasureHuntLevel,"huntLevel",t.huntLevel+1),n=MyFun.findItemFromArr(u.default.inst.treasureHuntLevel,"huntLevel",t.huntLevel);null==e?(this.upgrade.active=!1,this.levelInfo.active=!0,this.levelNum.string=n.huntExp+"/"+n.huntExp,this.levelProgress.progress=1):(this.levelNum.string=t.huntExp-n.huntExp+"/"+e.huntExp,this.levelProgress.progress=(t.huntExp-n.huntExp)/e.huntExp,t.huntExp-n.huntExp>=e.huntExp?(this.upgrade.active=!0,this.levelInfo.active=!1):(this.upgrade.active=!1,this.levelInfo.active=!0))},e.prototype.mapTeamToHuntLevels=function(t){var e=new Map;return null==t?e:(t.forEach(function(t){e.get(t.teamNumber)||e.set(t.teamNumber,t.huntLevel)}),e)},e.prototype._handleTeamList=function(){var t=this.mapTeamToHuntLevels(u.default.inst.treasureHuntLevel);this.curUnlockTeam=0,this.loadByFrames(t)},e.prototype.loadByFrames=function(t){var e=this,n=t.size,o=0,r=function(){for(var i=Math.min(n-o,15),a=0;a<i;a++)e.addItemData(o,t),o++;o<n?e.scheduleOnce(function(){return r()}):e.scheduleOnce(function(){})};r()},e.prototype.addItemData=function(t,e){var n=this;if(!(t>=e.size)){var o=t+1,r=e.get(o),i=this.teamListN.children[t];if(cc.isValid(i)||(i=cc.instantiate(this.item)),i.active=!0,i.parent=this.teamListN,i.children[0].removeAllChildren(),i.getChildByName("huntInfo").active=!1,i.getChildByName("title").getComponent(app.i18nLabel).init("game_static_main5",[o.toString()]),u.default.inst.level>=r){this.curUnlockTeam++,i.getChildByName("log").active=!0,i.getChildByName("log").off("click"),i.getChildByName("btn").off("click"),i.getChildByName("endHunt").getChildByName("btn").off("click"),i.getChildByName("lock").active=!1,i.getChildByName("btn").active=!1,i.getChildByName("endHunt").active=!1;var a=MyFun.findItemFromArr(this.teamList,"huntNo",o);if(null==a)i.getChildByName("log").on("click",function(){n.btnHuntLogClicked(o)}),i.getChildByName("btn").active=!0,i.getChildByName("btn").on("click",function(){u.default.inst.curHuntNo=o,n.enterSelectHuntArea()});else{i.getChildByName("log").on("click",function(){n.btnHuntLogClicked(a.huntNo)});var s=cc.instantiate(this.mapList[a.regionId-1]);s.parent=i.children[0],s.zIndex=-1;var c=i.getChildByName("huntInfo");c.active=!0,this.setMapBeastShowing(a.beastListList,c,this.nowTime>=a.endTime),this.nowTime,a.startTime,this.nowTime>=a.endTime&&(s.getComponent(d.default).setScroll(!1),a.huntTime,i.getChildByName("endHunt").active=!0,i.getChildByName("endHunt").getChildByName("btn").on("click",function(){n._huntEnd(a.huntTime,a.huntId)}));var l=a.endTime-this.nowTime;this.showTime(l,c.getChildByName("timeV")),c.getChildByName("todayGemsV").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(a.todayGems)),c.getChildByName("totalV").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(MyFun.getRealNum(a.mockGems))}}else i.getChildByName("lock").getChildByName("info").getComponent(app.i18nLabel).init("game_static_main9",[r.toString()])}},e.prototype.showTime=function(t,e){var n=MyFun.formatTimeToHMS(t);t<=0?e.getComponent(app.i18nLabel).init("game_static_main15",[]):(e.getComponent(app.i18nLabel).init(n,[]),t--,this.schedule(function(){t>=0?(n=MyFun.formatTimeToHMS(t),e.getComponent(app.i18nLabel).init(n,[]),t--):e.getComponent(app.i18nLabel).init("game_static_main15",[])},1))},e.prototype.setMapBeastShowing=function(t,e,n){return a(this,void 0,void 0,function(){var o,r,i;return s(this,function(){return MyFun.findItemFromArr(u.default.inst.BeastConfigList,"cateId",t[0].cateId),(o=e.getChildByName("pos1").getComponent(sp.Skeleton)).skeletonData=this.spineData,o.setSkin("skin_beast_101"),r=n?"xiuxi":"xunbao1",o.setAnimation(0,r,!0),t.length>1?(MyFun.findItemFromArr(u.default.inst.BeastConfigList,"cateId",t[1].cateId),(i=e.getChildByName("pos2").getComponent(sp.Skeleton)).skeletonData=this.spineData,i.setSkin("skin_beast_101"),i.setAnimation(0,r,!0)):(i=e.getChildByName("pos2").getComponent(sp.Skeleton)).skeletonData=null,[2]})})},e.prototype._huntEnd=function(t,e){var n=this,o=new p.TreasureHuntEndReq;o.setHuntId(e),u.default.inst.treasureHuntClient.treasureHuntEnd(o,u.default.inst.metadata).then(function(e){if(0==e.getResult()){var o=e.getTreasurehuntendresp().toObject();cc.log(o),n.showHuntResult(t,o)}else cc.log("errCode",e.getCode(),"errMsg",e.getMsg()),u.default.inst.handleCode(e.getCode())}).catch(function(t){u.default.inst.handleCode(t.code)})},e.prototype.showHuntResult=function(t,e){return a(this,void 0,void 0,function(){var n,o,r=this;return s(this,function(i){switch(i.label){case 0:return[4,MyFun.loadPrefab(l.getPrefabInfo(l.Bundles.Game_BeastHunt,l.BeastHunt_Pop.Result))];case 1:return n=i.sent(),(o=cc.instantiate(n)).parent=this.content,o.getComponent(h.default).setData(t,e,function(){r.content.removeAllChildren(),r._getTreasureHuntInfo()}),[2]}})})},e.prototype.enterSelectHuntArea=function(){return a(this,void 0,void 0,function(){var t,e,n=this;return s(this,function(o){switch(o.label){case 0:return 0==this.beastList.length?(u.default.inst.showConfirm("game_static_main14",function(){u.default.inst.jumpToGame(u.gameType.beastEggIncubator)}),[2]):[4,MyFun.loadPrefab(l.getPrefabInfo(l.Bundles.Game_BeastHunt,l.BeastHunt_Pop.AreaSet))];case 1:return t=o.sent(),(e=cc.instantiate(t)).parent=this.content,this.mainLayer.opacity=0,e.getComponent(f.default).setCall(this.myInfo,function(){n._getTreasureHuntInfo(),u.default.inst.curLayer=u.Layer.MAIN,n.mainLayer.opacity=255},function(){e.active=!1,n.enterSelectBeast()}),[2]}})})},e.prototype.enterSelectBeast=function(){return a(this,void 0,void 0,function(){var t,e,n=this;return s(this,function(o){switch(o.label){case 0:return[4,MyFun.loadPrefab(l.getPrefabInfo(l.Bundles.Game_BeastHunt,l.BeastHunt_Pop.BeastSet))];case 1:return t=o.sent(),(e=cc.instantiate(t)).parent=this.content,this.mainLayer.opacity=0,e.getComponent(y.default).setCall(this.beastList,function(){n.mainLayer.opacity=255,u.default.inst.curLayer=u.Layer.MAIN,n._getTreasureHuntInfo(),e.destroy();var t=cc.find("treasureAreaSet",n.content);cc.isValid(t)&&t.destroy()}),e.getComponent(y.default).setBackCall(function(){var t=cc.find("treasureAreaSet",n.content);cc.isValid(t)&&(t.active=!0)}),[2]}})})},e.prototype.btnHuntLogClicked=function(t){return a(this,void 0,void 0,function(){var e,n,o=this;return s(this,function(r){switch(r.label){case 0:return[4,MyFun.loadPrefab(l.getPrefabInfo(l.Bundles.Game_BeastHunt,l.BeastHunt_Pop.Log))];case 1:return e=r.sent(),(n=cc.instantiate(e)).parent=this.content,this.mainLayer.opacity=0,n.getComponent(m.default).setCall(this.teamList,t,this.curUnlockTeam,function(){u.default.inst.curLayer=u.Layer.MAIN,o.mainLayer.opacity=255,o._getTreasureHuntInfo()}),[2]}})})},e.prototype.btnLevelUpClicked=function(){return a(this,void 0,void 0,function(){var t,e,n=this;return s(this,function(o){switch(o.label){case 0:return[4,MyFun.loadPrefab(l.getPrefabInfo(l.Bundles.Game_BeastHunt,l.BeastHunt_Pop.Levelup))];case 1:return t=o.sent(),(e=cc.instantiate(t)).parent=this.content,this.mainLayer.opacity=0,e.getComponent(g.default).setData(this.curLevel,this.curExp,function(){n._getTreasureHuntInfo(),u.default.inst.curLayer=u.Layer.MAIN,n.mainLayer.opacity=255},function(){u.default.inst.curLayer=u.Layer.MAIN,n.mainLayer.opacity=255}),[2]}})})},e.prototype.btnCloseGameClicked=function(){u.default.inst.backToApp()},e.prototype.scrollToRuleInfo=function(){this.scrollView.getComponent(cc.ScrollView).scrollToOffset(cc.v2(0,this.topNode.height+this.teamListN.height),.5)},e.prototype.improveDC=function(){if(0!=this.teamListN.childrenCount){var t=this.scrollView.parent.convertToWorldSpaceAR(cc.v2(this.scrollView.x-this.scrollView.anchorX*this.scrollView.width,this.scrollView.y-this.scrollView.anchorY*this.scrollView.height)),e=cc.rect(t.x,t.y,this.scrollView.width,this.scrollView.height);this.teamListN.children.forEach(function(t){t.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})})}},i([_({type:cc.Label,displayName:"\u5bfb\u5b9d\u7b49\u7ea7"})],e.prototype,"levelLab",void 0),i([_(cc.Node)],e.prototype,"mainLayer",void 0),i([_(cc.Node)],e.prototype,"content",void 0),i([_(cc.Node)],e.prototype,"scrollView",void 0),i([_(cc.Node)],e.prototype,"teamListN",void 0),i([_(cc.Node)],e.prototype,"item",void 0),i([_(cc.Prefab)],e.prototype,"mapList",void 0),i([_(cc.Node)],e.prototype,"upgrade",void 0),i([_(cc.Node)],e.prototype,"levelInfo",void 0),i([_(cc.ProgressBar)],e.prototype,"levelProgress",void 0),i([_(cc.Label)],e.prototype,"levelNum",void 0),i([_(sp.SkeletonData)],e.prototype,"spineData",void 0),i([_(cc.Node)],e.prototype,"topNode",void 0),i([b],e)}(c.default);n.default=C,cc._RF.pop()},{"../../core/components/gameBase":void 0,"../../game/beastMgr":void 0,"../../game/beast_config":void 0,"../../proto/mystibeast_pb":void 0,"./hunt_result":"hunt_result","./mapCtrl":"mapCtrl","./treasureAreaSet":"treasureAreaSet","./treasureBeastSet":"treasureBeastSet","./treasureLevelUp":"treasureLevelUp","./treasureLog":"treasureLog"}],treasureLevelUp:[function(t,e,n){"use strict";cc._RF.push(e,"8c3d1F14WFLebmNMYF2zD8M","treasureLevelUp");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../core/components/LayerBase"),s=t("../../game/beastMgr"),c=t("../../proto/mystibeast_pb"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curLevel=null,e.nextLevel=null,e.levelProgress=null,e.info=null,e.levelInfo=null,e.costLab=null,e.upBtn=null,e.backBtn=null,e.desc=null,e.levelUpgrading=null,e.levelMax=null,e.levelInfoList=null,e.item=null,e.upgradeCb=null,e.backCb=null,e}return r(e,t),e.prototype.setData=function(e,n,o,r){if(this.upgradeCb=o,this.backCb=r,t.prototype.setBackCall.call(this,this.backCb),0!=e){this.curLevel.string=e.toString(),this.nextLevel.string=(e+1).toString();var i=MyFun.findItemFromArr(s.default.inst.treasureHuntLevel,"huntLevel",e+1),a=MyFun.findItemFromArr(s.default.inst.treasureHuntLevel,"huntLevel",e);this._loadLevelInfoList(),null==i?(this.upBtn.node.active=!1,this.backBtn.active=!0,this.desc.node.getComponent(app.i18nLabel).init("game_static_upgrade6",[]),this.info.string=a.huntExp+"/"+a.huntExp,this.levelUpgrading.active=!1,this.levelMax.active=!0,this.levelProgress.progress=1):(this.levelInfo.getComponent(app.i18nLabel).init(i.levelUnlock,[]),this.info.string=n-a.huntExp+"/"+i.huntExp,this.levelProgress.progress=(n-a.huntExp)/i.huntExp,this.costLab.string=i.gem,n-a.huntExp>=i.huntExp?this.upBtn.interactable=!0:this.upBtn.interactable=!1)}},e.prototype._loadLevelInfoList=function(){for(var t=0;t<s.default.inst.treasureHuntLevel.length;t++){var e=s.default.inst.treasureHuntLevel[t],n=cc.instantiate(this.item);n.active=!0,n.parent=this.levelInfoList,n.getChildByName("lv").getComponent(cc.Label).string="lv."+e.huntLevel,n.getChildByName("desc").getComponent(app.i18nLabel).init(e.levelUnlock,[])}},e.prototype.btnUpgradeClicked=function(){var t=this,e=new c.TreasureHuntUpgradeReq;s.default.inst.treasureHuntClient.treasureHuntUpgrade(e,s.default.inst.metadata).then(function(e){0==e.getCode()?(s.default.inst.myGems=MyFun.getRealNum(e.getTreasurehuntupgraderesp().getMyGemsNum()),t.upgradeCb&&t.upgradeCb(),t.node.destroy()):(cc.log("errCode",e.getCode(),"errMsg",e.getMsg()),s.default.inst.handleCode(e.getCode()))}).catch(function(t){s.default.inst.handleCode(t.code)})},e.prototype.onCloseClicked=function(){t.prototype.onClose.call(this)},i([p(cc.Label)],e.prototype,"curLevel",void 0),i([p(cc.Label)],e.prototype,"nextLevel",void 0),i([p(cc.ProgressBar)],e.prototype,"levelProgress",void 0),i([p(cc.Label)],e.prototype,"info",void 0),i([p(cc.Node)],e.prototype,"levelInfo",void 0),i([p(cc.Label)],e.prototype,"costLab",void 0),i([p(cc.Button)],e.prototype,"upBtn",void 0),i([p(cc.Node)],e.prototype,"backBtn",void 0),i([p(cc.Label)],e.prototype,"desc",void 0),i([p(cc.Node)],e.prototype,"levelUpgrading",void 0),i([p(cc.Node)],e.prototype,"levelMax",void 0),i([p(cc.Node)],e.prototype,"levelInfoList",void 0),i([p(cc.Node)],e.prototype,"item",void 0),i([u],e)}(a.default);n.default=h,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0}],treasureLog:[function(t,e,n){"use strict";cc._RF.push(e,"b4d9bhw0TJGvJKAYmNuaV1F","treasureLog");var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,n,a):r(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../core/components/LayerBase"),s=t("../../game/beastMgr"),c=t("../../proto/mystibeast_pb"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logTitle=null,e.todayGem=null,e.totalGem=null,e.todayExp=null,e.totalExp=null,e.scrollView=null,e.content=null,e.item=null,e.tip=null,e.backCall=null,e.curHuntNo=0,e.curHuntId=0,e.unlockTeam=0,e.teamList=[],e.curStartTime=0,e}return r(e,t),e.prototype.setCall=function(e,n,o,r){this.teamList=e,this.curHuntNo=n,this.unlockTeam=o,this.backCall=r,t.prototype.setBackCall.call(this,r),this._loadCurTeamHuntInfo()},e.prototype._loadCurTeamHuntInfo=function(){this.logTitle.node.getComponent(app.i18nLabel).init("game_static_log2",[this.curHuntNo.toString()]);var t=MyFun.findItemFromArr(this.teamList,"huntNo",this.curHuntNo);null==t?(this.todayGem.string="0",this.totalGem.string="0",this.todayExp.string="0",this.totalExp.string="0",this.curHuntId=0):(this.curStartTime=t.startTime,this.todayGem.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.todayGems)),this.totalGem.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.mockGems)),this.todayExp.string=t.todayExp.toString(),this.totalExp.string=t.totalExp.toString(),this.curHuntId=t.huntId),this._loadTreasureLog()},e.prototype.onLeftClicked=function(){var t=this.curHuntNo;this.curHuntNo--,this.curHuntNo<=0&&(this.curHuntNo=this.unlockTeam,this.curHuntNo<=0&&(this.curHuntNo=1)),t!=this.curHuntNo&&this._loadCurTeamHuntInfo()},e.prototype.onRightClicked=function(){var t=this.curHuntNo;this.curHuntNo++,this.curHuntNo>this.unlockTeam&&(this.curHuntNo=1),t!=this.curHuntNo&&this._loadCurTeamHuntInfo()},e.prototype.onBackClick=function(){t.prototype.onClose.call(this)},e.prototype._loadTreasureLog=function(){var t=this;this.content.removeAllChildren(),this.scrollView.getComponent(cc.ScrollView).scrollToTop(.1);var e=new c.TreasureHuntRecordListReq;e.setHuntId(this.curHuntId),s.default.inst.treasureHuntClient.treasureHuntRecordList(e,s.default.inst.metadata).then(function(e){if(0==e.getCode()){var n=e.getTreasurehuntrecordlistresp().toObject();cc.log(n),t.loadRecordLog(n.recordListList)}else cc.log("errCode",e.getCode(),"errMsg",e.getMsg()),s.default.inst.handleCode(e.getCode())}).catch(function(t){cc.log(t),s.default.inst.handleCode(t.code)})},e.prototype.loadRecordLog=function(t){cc.isValid(this.tip)&&(0!=t.length?(this.tip.active=!1,this.loadByFrames(t)):this.tip.active=!0)},e.prototype.loadByFrames=function(t){var e=this,n=t.length,o=0,r=function(){for(var i=Math.min(n-o,30),a=0;a<i;a++)e.addItem(o,t),o++;o<n?e.scheduleOnce(function(){return r()}):e.scheduleOnce(function(){e.improveDC()})};r()},e.prototype.addItem=function(t,e){if(!(t>=e.length)){var n=cc.instantiate(this.item);n.active=!0;var o=e[t];n.parent=this.content,n.getChildByName("day").getComponent(app.i18nLabel).init("game_static_log7",[MyFun.formatSecondToDay(o.createTime-this.curStartTime).toString()]);var r=MyFun.findItemFromArr(s.default.inst.treasureHuntEvent,"eventId",o.eventId);n.getChildByName("info").getComponent(app.i18nLabel).init(r.eventDes,[]),n.getChildByName("layout").getChildByName("gems").getComponent(cc.Label).string=MyFun.getRealNum(o.mockGems).toFixed(9)}},e.prototype.improveDC=function(){if(0!=this.content.childrenCount){var t=this.scrollView.parent.convertToWorldSpaceAR(cc.v2(this.scrollView.x-this.scrollView.anchorX*this.scrollView.width,this.scrollView.y-this.scrollView.anchorY*this.scrollView.height)),e=cc.rect(t.x,t.y,this.scrollView.width,this.scrollView.height);this.content.children.forEach(function(t){t.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})})}},i([p(cc.Label)],e.prototype,"logTitle",void 0),i([p(cc.Label)],e.prototype,"todayGem",void 0),i([p(cc.Label)],e.prototype,"totalGem",void 0),i([p(cc.Label)],e.prototype,"todayExp",void 0),i([p(cc.Label)],e.prototype,"totalExp",void 0),i([p(cc.Node)],e.prototype,"scrollView",void 0),i([p(cc.Node)],e.prototype,"content",void 0),i([p(cc.Node)],e.prototype,"item",void 0),i([p(cc.Node)],e.prototype,"tip",void 0),i([u],e)}(a.default);n.default=h,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0}]},{},["beastSetItem","hunt_result","mapCtrl","treasureAreaSet","treasureBeastSet","treasureHunt","treasureLevelUp","treasureLog"]);