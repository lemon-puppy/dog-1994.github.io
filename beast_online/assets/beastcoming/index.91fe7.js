window.__require=function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return i(e[s][1][t]||t)},u,u.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({AStar:[function(t,e,o){"use strict";cc._RF.push(e,"becf359V8dBl7DkIcQtdawO","AStar");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},s=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.Point=void 0;var a=cc._decorator,c=a.ccclass,l=(a.property,function(t,e){this.G=0,this.H=0,this.F=0,this.father=null,this.is_close=!1,this.targetName="",this.x=t,this.y=e});o.Point=l;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.getRoute=function(t,e,o,n){var i=this;this.is_find=!1,this.arr_open=[],this.pppp=null,this.start=r({},t),this.end=r({},e),this.map=new Map,o.forEach(function(t,e){i.map.set(e,r({},t))}),this.size=n,o.get(this.start.x+this.start.y*this.size.width).G=0;var s=new Array;try{this.search(this.start)}catch(a){return cc.error("\u4f4d\u7f6e\u4e0d\u5bf9"),s}return this.pppp&&this.getFather(this.pppp,s),s},e.search=function(t){var e=this;if(t.x==this.end.x&&t.y==this.end.y)return this.is_find=!0,void(this.pppp=t);this.getAround(t).forEach(function(o){e.setFather(o,t)}),this.arr_open.sort(this.compare),this.arr_open.forEach(function(t,o,n){t.is_close&&n.splice(o,1),e.is_find||e.search(t)})},e.getAround=function(t){t.is_close=!0;var e,o,n=new Array;return 0!=t.y&&(e=t.x+(t.y-1)*this.size.width,(o=this.map.get(e))&&!o.is_close&&(n.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),t.y+1!=this.size.height&&(e=t.x+(t.y+1)*this.size.width,(o=this.map.get(e))&&!o.is_close&&(n.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),0!=t.x&&(e=t.x-1+t.y*this.size.width,(o=this.map.get(e))&&!o.is_close&&(n.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),t.x+1!=this.size.width&&(e=t.x+1+t.y*this.size.width,(o=this.map.get(e))&&!o.is_close&&(n.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),n},e.isValidPoint=function(t,e){return t>=0&&e>=0&&t<this.size.width&&e<this.size.height},e.setFather=function(t,e){(!t.father||t.father.G>e.G)&&(t.father=e,t.G=t.father.G+1,t.H=Math.abs(t.x-this.end.x)+Math.abs(t.y-this.end.y),t.F=t.G+t.H)},e.compare=function(t,e){return t.F>e.F?1:-1},e.getFather=function(t,e){var o=t.father;o&&this.getFather(o,e),e.push(t)},e.start=null,e.end=null,e.map=null,e.size=null,e.arr_open=[],e.pppp=null,e.is_find=!1,s([c],e)}(cc.Component);o.default=u,cc._RF.pop()},{}],beastComing_autoPlay:[function(t,e,o){"use strict";cc._RF.push(e,"9302exaRxZPIqaaQSrAwKtv","beastComing_autoPlay");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../core/components/LayerBase"),a=t("../../game/beastMgr"),c=t("../../proto/mystibeast_pb"),l=cc._decorator,u=l.ccclass,d=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.killer_100_record=null,e.betRoomList=null,e.roundList=null,e.betNumList=null,e.roundDIY=null,e.gems=null,e.betNumDIY=null,e.DIYNode=null,e.DIYTip=null,e.keyBoard=null,e.inputNumStr=null,e.btn_sureTip=null,e.btnSureSpr=null,e.btnSureSprArr=[],e.inputStr="",e.select_betRoom=0,e.select_round=0,e.roundIndex=0,e.roundNumSelectList=[12,24,48],e.select_betNum=0,e.betIndex=0,e.betNumSelectList=[1,10,100],e.curType=0,e.roundLimit=100,e.sureCb=null,e.isAutoPlay=!1,e}return i(e,t),e.prototype.start=function(){this.addKeyBoardListener()},e.prototype.addBtnClickListener=function(){for(var t=0;t<this.betRoomList.childrenCount;t++)this.betRoomList.children[t].on("click",this.onBetRoomBtnClick.bind(this));for(t=0;t<this.roundList.childrenCount;t++)this.roundList.children[t].on("click",this.onRoundBtnClick.bind(this));for(t=0;t<this.betNumList.childrenCount;t++)this.betNumList.children[t].on("click",this.onBetNumBtnClick.bind(this))},e.prototype.addKeyBoardListener=function(){for(var t=0;t<this.keyBoard.children[0].childrenCount;t++)this.keyBoard.children[0].children[t].on("click",this.keyBoardClicked.bind(this))},e.prototype.keyBoardClicked=function(t){var e=t.target.name;if("."!=e){if("del"==e&&this.inputStr.length>0){var o=this.inputStr.length-1;this.inputStr=this.inputStr.slice(0,o),this.checkInput()}if("del"!==e){if(this.inputStr=this.inputStr+e,"."==e)return void(this.inputNumStr.string=this.inputStr);this.checkInput()}}},e.prototype.checkInput=function(){var t=Number(this.inputStr);0==this.curType?t>100&&(t=100,a.default.inst.showWarning("beastcoming_tips07","100")):t>1e6?(t=1e6,a.default.inst.showWarning("beastcoming_tips15","1000000")):t>a.default.inst.myGems&&(t=a.default.inst.myGems),this.inputStr=t.toString(),this.inputNumStr.string=t.toString()},e.prototype.loadKillerRecord=function(){var t=this,e=new c.BeastComingHidingLogReq;a.default.inst.BeastComingClient.beastComingHidingLog(e,a.default.inst.metadata).then(function(e){if(0==e.getResult()){var o=e.getBeastcominghidinglogresp().toObject();cc.log(o),t.loadKiller_100_records(o.oneHundredListList)}else cc.log("errorCode",e.getCode(),"errorMsg",e.getMsg()),a.default.inst.handleCode(e.getCode())})},e.prototype.loadKiller_100_records=function(t){for(var e=this.killer_100_record.children[1],o=0,n=t.length;o<n;o++){var i=t[o],r=e.getChildByName(i.rideSn+"");r&&(r.children[2].getComponent(cc.Label).string=i.attackNum+"")}},e.prototype._clearSelect=function(t){t.forEach(function(t){cc.isValid(t.children[1])&&(t.children[1].active=!1)})},e.prototype.onBetRoomBtnClick=function(t){var e=t.target.name;this.select_betRoom==e?(t.target.children[1].active=!1,this.select_betRoom=0):(this.select_betRoom=e,this._clearSelect(this.betRoomList.children),t.target.children[1].active=!0),cc.log(this.select_betRoom)},e.prototype.onRoundBtnClick=function(t){var e=t.target.name;this.roundIndex==e&&4!=e?(t.target.children[1].active=!1,this.roundIndex=0,this.select_round=0):(this.roundIndex=e,this._clearSelect(this.roundList.children),t.target.children[1].active=!0,4==e?this.showDIYNode(0):this.select_round=this.roundNumSelectList[this.roundIndex-1])},e.prototype.onBetNumBtnClick=function(t){var e=t.target.name;this.betIndex==e&&4!=e?(t.target.children[1].active=!1,this.betIndex=0,this.select_betNum=0):(this.betIndex=e,this._clearSelect(this.betNumList.children),t.target.children[1].active=!0,4==e?this.showDIYNode(1):this.select_betNum=this.betNumSelectList[this.betIndex-1])},e.prototype.showDIYNode=function(t){void 0===t&&(t=0),this.DIYNode.active=!0,this.curType=t,0==t?this.DIYTip.node.getComponent(app.i18nLabel).init("beastcoming_tips08",[]):this.DIYTip.node.getComponent(app.i18nLabel).init("beastcoming_tips09",[])},e.prototype.closeDiyNode=function(){this.inputStr="",this.inputNumStr.string="",this.DIYNode.active=!1},e.prototype.btnSureInputClick=function(){if(""==this.inputStr||0==Number(this.inputStr))return a.default.inst.showWarning("beastcoming_tips10"),0==this.curType?this.select_round=0:this.select_betNum=0,void this.closeDiyNode();var t=Number(this.inputNumStr.string);0==this.curType?(t>100&&(t=100,a.default.inst.showWarning("beastcoming_tips07","100")),this.roundDIY.string=t.toString(),this.select_round=t):(t>1e6?(t=1e6,a.default.inst.showWarning("beastcoming_tips15","1000000")):t>a.default.inst.myGems&&(t=a.default.inst.myGems),this.betNumDIY.string=MyFun.formatDecimalPlaces(t,0),this.gems.active=!0,this.select_betNum=parseInt(MyFun.formatDecimalPlaces(t,0))),this.closeDiyNode()},e.prototype.setData=function(t,e){this.sureCb=e,this.isAutoPlay=t;var o=t?"beastcoming_btn05":"beastcoming_btn04";this.btn_sureTip.node.getComponent(app.i18nLabel).init(o,[]),this.btnSureSpr.spriteFrame=t?this.btnSureSprArr[1]:this.btnSureSprArr[0],t?this.loadCurAutoSetData():(this.addBtnClickListener(),this.loadKillerRecord())},e.prototype.loadCurAutoSetData=function(){var t=this,e=new c.BeastComingAutoHideInfoReq;a.default.inst.BeastComingClient.beastComingAutoHideInfo(e,a.default.inst.metadata).then(function(e){if(0==e.getCode()){var o=e.getBeastcomingautohideinforesp().toObject();if(t.loadKiller_100_records(o.oneHundredListList),t.betRoomList.children[o.autoHideInfo.rideSn-1].children[1].active=!0,t.select_betRoom=o.autoHideInfo.rideSn,t.select_round=o.autoHideInfo.targetNum,[12,24,48].includes(o.autoHideInfo.targetNum)){var n=[12,24,48].indexOf(o.autoHideInfo.targetNum);t.roundList.children[n].children[1].active=!0}else t.roundList.children[3].children[1].active=!0,t.roundDIY.string=o.autoHideInfo.targetNum.toString();t.select_betNum=MyFun.getRealNum(o.autoHideInfo.gemsNum),[1,10,100].includes(t.select_betNum)?(n=[1,10,100].indexOf(t.select_betNum),t.betNumList.children[n].children[1].active=!0):(t.betNumList.children[3].children[1].active=!0,t.betNumDIY.string=t.select_betNum.toString(),t.gems.active=!0)}else a.default.inst.handleCode(e.getCode())}).catch(function(t){a.default.inst.handleCode(t.code)})},e.prototype.btnSureAutoSetClick=function(){var e=this;if(cc.log(this.select_betRoom,this.select_round,this.select_betNum),!this.isAutoPlay){if(0==this.select_betRoom)return void a.default.inst.showWarning("beastcoming_tips11");if(0==this.select_round)return void a.default.inst.showWarning("beastcoming_tips12");if(0==this.select_betNum)return void a.default.inst.showWarning("beastcoming_tips13");if(this.select_betNum>a.default.inst.myGems)return void a.default.inst.showWarning("beast_netmsg04")}var o=this.isAutoPlay?"beastcoming_tips05":"beastcoming_tips04";cc.log(this.select_betRoom,this.select_round,this.select_betNum),a.default.inst.showConfirm(o,function(){var o;(cc.log("\u786e\u5b9a"),e.isAutoPlay)?(o=new c.BeastComingAutoHideEndReq,a.default.inst.BeastComingClient.beastComingAutoHideEnd(o,a.default.inst.metadata).then(function(o){0==o.getCode()?(e.isAutoPlay=!1,e.sureCb&&e.sureCb(e.isAutoPlay),t.prototype.onClose.call(e)):(a.default.inst.handleCode(o.getCode()),2019==o.getCode()&&(e.isAutoPlay=!1,e.sureCb&&e.sureCb(e.isAutoPlay),t.prototype.onClose.call(e)))}).catch(function(t){a.default.inst.handleCode(t.code),cc.log(t)})):((o=new c.BeastComingAutoHideStartReq).setRideSn(e.select_betRoom),o.setTargetNum(e.select_round),o.setGemsNum(e.select_betNum),a.default.inst.BeastComingClient.beastComingAutoHideStart(o,a.default.inst.metadata).then(function(o){cc.log(o.getCode()),0==o.getCode()?(e.isAutoPlay=!0,o.getBeastcomingautohidestartresp().toObject(),e.sureCb&&e.sureCb(e.isAutoPlay),t.prototype.onClose.call(e)):(cc.log(o.getCode(),o.getMsg()),a.default.inst.handleCode(o.getCode()))}).catch(function(t){a.default.inst.handleCode(t.code),cc.log(t)}))})},e.prototype.btnCloseClicked=function(){this.sureCb&&this.sureCb(this.isAutoPlay),t.prototype.onClose.call(this)},r([d(cc.Node)],e.prototype,"killer_100_record",void 0),r([d(cc.Node)],e.prototype,"betRoomList",void 0),r([d(cc.Node)],e.prototype,"roundList",void 0),r([d(cc.Node)],e.prototype,"betNumList",void 0),r([d(cc.Label)],e.prototype,"roundDIY",void 0),r([d(cc.Node)],e.prototype,"gems",void 0),r([d(cc.Label)],e.prototype,"betNumDIY",void 0),r([d(cc.Node)],e.prototype,"DIYNode",void 0),r([d(cc.Label)],e.prototype,"DIYTip",void 0),r([d(cc.Node)],e.prototype,"keyBoard",void 0),r([d(cc.Label)],e.prototype,"inputNumStr",void 0),r([d(cc.Label)],e.prototype,"btn_sureTip",void 0),r([d(cc.Sprite)],e.prototype,"btnSureSpr",void 0),r([d(cc.SpriteFrame)],e.prototype,"btnSureSprArr",void 0),r([u],e)}(s.default);o.default=p,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0}],beastComing_rankItem:[function(t,e,o){"use strict";cc._RF.push(e,"3830575xBBCY6L1QGxH+Tv3","beastComing_rankItem");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,l=c.ccclass,u=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rank=null,e.icon=null,e.userName=null,e.reward_rate=null,e.gemsNum=null,e.iconSF=null,e}return i(e,t),e.prototype.start=function(){},e.prototype.setData=function(t){return s(this,void 0,void 0,function(){var e;return a(this,function(o){switch(o.label){case 0:return this.rank.string=t.weekRank+"",this.userName.string=MyFun.maskName(t.userNickname),this.reward_rate.node.getComponent(app.i18nLabel).init("beastcoming_title13",[t.rewardRate/1e4*100+"%"]),this.gemsNum.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.winNum)),""==t.userAvatar?(this.icon.spriteFrame=this.iconSF,[2]):[4,MyFun.loadPicFromRemote(t.userAvatar)];case 1:return e=o.sent(),cc.isValid(this.icon,!0)?(this.icon.spriteFrame=e,[2]):[2]}})})},r([u(cc.Label)],e.prototype,"rank",void 0),r([u(cc.Sprite)],e.prototype,"icon",void 0),r([u(cc.Label)],e.prototype,"userName",void 0),r([u(cc.Label)],e.prototype,"reward_rate",void 0),r([u(cc.Label)],e.prototype,"gemsNum",void 0),r([u(cc.SpriteFrame)],e.prototype,"iconSF",void 0),r([l],e)}(cc.Component);o.default=d,cc._RF.pop()},{}],beastComing_rank:[function(t,e,o){"use strict";cc._RF.push(e,"522f06Lx8VK7I2r46is31ce","beastComing_rank");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../core/components/LayerBase"),l=t("../../game/beastMgr"),u=t("../../proto/mystibeast_pb"),d=t("./beastComing_rankItem"),p=cc._decorator,h=p.ccclass,f=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scrollView=null,e.rankList=null,e.item=null,e.playerIcon=null,e.playerPos=null,e.getV=null,e.prizePool=null,e.iconSF=null,e.curWeekList=[],e.lastWeekList=[],e.curUser=null,e.lastUser=null,e}return i(e,t),e.prototype.start=function(){this.loadRankData()},e.prototype.loadRankData=function(){var t=this,e=new u.BeastComingWeekRankReq;l.default.inst.BeastComingClient.beastComingWeekRank(e,l.default.inst.metadata).then(function(e){if(0==e.getResult()){var o=e.getBeastcomingweekrankresp().toObject();cc.log(o),t.curWeekList=o.currentWeekListList,t.lastWeekList=o.lastWeekListList,t.curUser=o.currentWeekUser,t.lastUser=o.lastWeekUser,t.prizePool.string=MyFun.getRealNum(o.jackpotInfo.gemsNum).toFixed(2),t.loadUserInfo(t.curUser),t.loadWeekRankList(t.curWeekList)}else cc.log("errorCode",e.getCode(),"errorMsg",e.getMsg()),l.default.inst.handleCode(e.getCode())})},e.prototype.loadUserInfo=function(t){return s(this,void 0,void 0,function(){var e;return a(this,function(o){switch(o.label){case 0:return null==t?(this.playerPos.node.getComponent(app.i18nLabel).init("beastcoming_title15",[]),this.getV.string="0",this.playerIcon.spriteFrame=this.iconSF,[2]):(this.playerPos.string=t.weekRank<=10?t.weekRank+"":"\u672a\u4e0a\u699c",this.getV.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.winNum)),""==t.userAvatar?(this.playerIcon.spriteFrame=this.iconSF,[2]):[4,MyFun.loadPicFromRemote(t.userAvatar)]);case 1:return e=o.sent(),cc.isValid(this.playerIcon,!0)?(this.playerIcon.spriteFrame=e,[2]):[2]}})})},e.prototype.onToggleContainerCheck=function(t){t.isChecked&&("toggle1"==t.node.name?(this.loadUserInfo(this.curUser),this.loadWeekRankList(this.curWeekList)):(this.loadUserInfo(this.lastUser),this.loadWeekRankList(this.lastWeekList)))},e.prototype.loadWeekRankList=function(t){this.rankList.removeAllChildren(),null!=t&&void 0!==t&&this.loadByFrames(t)},e.prototype.loadByFrames=function(t){var e=this,o=t.length,n=0,i=function(){for(var r=Math.min(o-n,30),s=0;s<r;s++)e.addItem(n,t),n++;n<o?e.scheduleOnce(function(){return i()}):e.scheduleOnce(function(){e.improveDC()})};i()},e.prototype.addItem=function(t,e){if(!(t>=e.length)){var o=e[t],n=cc.instantiate(this.item);n.parent=this.rankList,n.active=!0,n.getComponent(d.default).setData(o)}},e.prototype.improveDC=function(){if(0!=this.rankList.childrenCount){var t=this.scrollView.parent.convertToWorldSpaceAR(cc.v2(this.scrollView.x-this.scrollView.anchorX*this.scrollView.width,this.scrollView.y-this.scrollView.anchorY*this.scrollView.height)),e=cc.rect(t.x,t.y,this.scrollView.width,this.scrollView.height);this.rankList.children.forEach(function(t){t.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})})}},e.prototype.btnCloseClicked=function(){t.prototype.onClose.call(this)},r([f(cc.Node)],e.prototype,"scrollView",void 0),r([f(cc.Node)],e.prototype,"rankList",void 0),r([f(cc.Node)],e.prototype,"item",void 0),r([f(cc.Sprite)],e.prototype,"playerIcon",void 0),r([f(cc.Label)],e.prototype,"playerPos",void 0),r([f(cc.Label)],e.prototype,"getV",void 0),r([f(cc.Label)],e.prototype,"prizePool",void 0),r([f(cc.SpriteFrame)],e.prototype,"iconSF",void 0),r([h],e)}(c.default);o.default=m,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0,"./beastComing_rankItem":"beastComing_rankItem"}],beastComing_record:[function(t,e,o){"use strict";cc._RF.push(e,"47f5cn6tbRB9qzFsS1/pgGP","beastComing_record");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../core/components/LayerBase"),l=t("../../game/beastMgr"),u=t("../../proto/mystibeast_pb"),d=t("./beastComing"),p=t("./item_record"),h=cc._decorator,f=h.ccclass,m=h.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scrollView=null,e.content=null,e.killer_100_record=null,e.killer_10_record=null,e.itemKiller=null,e.playerAccCost=null,e.playerAccGet=null,e.list=null,e.item=null,e}return i(e,t),e.prototype.start=function(){this.loadEscapeRecord()},e.prototype.loadEscapeRecord=function(){return s(this,void 0,void 0,function(){var t,e=this;return a(this,function(){return t=new u.BeastComingHidingLogReq,l.default.inst.BeastComingClient.beastComingHidingLog(t,l.default.inst.metadata).then(function(t){if(0==t.getResult()){var o=t.getBeastcominghidinglogresp().toObject();cc.log(o),e.loadKiller_100_records(o.oneHundredListList),e.loadKiller_10_records(o.tenRoundListList),e.playerAccCost.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(o.myCarryNum)),e.playerAccGet.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(o.myWinNum)),e.loadPlayerRecord(o.myHideListList)}else cc.log("errorCode",t.getCode(),"errorMsg",t.getMsg()),l.default.inst.handleCode(t.getCode())}),[2]})})},e.prototype.loadKiller_100_records=function(t){for(var e=this.killer_100_record.children[1],o=0,n=t.length;o<n;o++){var i=t[o],r=e.getChildByName(i.rideSn+"");r&&(r.children[2].getComponent(cc.Label).string=i.attackNum+"")}},e.prototype.loadKiller_10_records=function(t){for(var e=this.killer_10_record.children[1],o=0,n=(t=MyFun.sortByObjectValue(t,"roundId")).length;o<n;o++){var i=t[o],r=cc.instantiate(this.itemKiller);r.active=!0,r.parent=e,r.getChildByName("name").getComponent(app.i18nLabel).init(d.roomIdLinkName.get(i.attackRide).i18n_key,[]),r.getChildByName("period").getComponent(app.i18nLabel).init("beastcoming_title02",[i.id.toString()])}},e.prototype.loadPlayerRecord=function(t){this.loadByFrames(t)},e.prototype.loadByFrames=function(t){var e=this,o=t.length,n=0,i=function(){for(var r=Math.min(o-n,30),s=0;s<r;s++)e.addItem(n,t),n++;n<o?e.scheduleOnce(function(){return i()}):e.scheduleOnce(function(){e.improveDC()})};i()},e.prototype.addItem=function(t,e){if(!(t>=e.length)){var o=cc.instantiate(this.item);o.active=!0;var n=e[t];o.getComponent(p.default).setData(n),o.parent=this.list}},e.prototype.improveDC=function(){if(0!=this.content.childrenCount){var t=this.scrollView.parent.convertToWorldSpaceAR(cc.v2(this.scrollView.x-this.scrollView.anchorX*this.scrollView.width,this.scrollView.y-this.scrollView.anchorY*this.scrollView.height)),e=cc.rect(t.x,t.y,this.scrollView.width,this.scrollView.height);this.content.children.forEach(function(t){t.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})})}},e.prototype.btnCloseClicked=function(){t.prototype.onClose.call(this)},r([m(cc.Node)],e.prototype,"scrollView",void 0),r([m(cc.Node)],e.prototype,"content",void 0),r([m(cc.Node)],e.prototype,"killer_100_record",void 0),r([m(cc.Node)],e.prototype,"killer_10_record",void 0),r([m(cc.Node)],e.prototype,"itemKiller",void 0),r([m(cc.Label)],e.prototype,"playerAccCost",void 0),r([m(cc.Label)],e.prototype,"playerAccGet",void 0),r([m(cc.Node)],e.prototype,"list",void 0),r([m(cc.Prefab)],e.prototype,"item",void 0),r([f],e)}(c.default);o.default=g,cc._RF.pop()},{"../../core/components/LayerBase":void 0,"../../game/beastMgr":void 0,"../../proto/mystibeast_pb":void 0,"./beastComing":"beastComing","./item_record":"item_record"}],beastComing_result:[function(t,e,o){"use strict";cc._RF.push(e,"8affcyccChG3KchLklZN+Y3","beastComing_result");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../game/beast_config"),a=t("../../game/beastMgr"),c=cc._decorator,l=c.ccclass,u=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maskN=null,e.gameStart=null,e.killerTip=null,e.suc2=null,e.fail1=null,e.fail1Tip=null,e.fail2=null,e.goldSpear=[],e.jumpCB=null,e}return i(e,t),e.prototype.start=function(){a.default.inst.beastModule&&this.goldSpear.forEach(function(t){t.active=!0})},e.prototype.showStartTip=function(t){void 0===t&&(t=1),this.maskN.opacity=153,this.waitToDestroy(t),this.gameStart.active=!0,cc.tween(this.gameStart).blink(1,4).repeatForever().start()},e.prototype.showKillerTip=function(t){app.AudioMgr.pauseMusic(),app.AudioMgr.play(s.Bundles.Game_BeastComing,"BeastWarning"),this.maskN.opacity=153,this.waitToDestroy(t),this.killerTip.active=!0,cc.tween(this.killerTip).blink(t/5,1).repeatForever().start()},e.prototype.waitToDestroy=function(t){var e=this;this.scheduleOnce(function(){app.AudioMgr.resumeMusic(),e.node.destroy()},t)},e.prototype.showSuc2=function(t,e){app.AudioMgr.play(s.Bundles.Common,"Settlement"),this.waitToDestroy(3),this.suc2.active=!0,this.suc2.getChildByName("cost").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(t),this.suc2.getChildByName("get").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(e)},e.prototype.showFail1=function(t,e,o){app.AudioMgr.play(s.Bundles.Common,"Settlement"),this.waitToDestroy(3),this.fail1.active=!0,this.fail1Tip.getComponent(app.i18nLabel).init("beastcoming_tips06",[t]),this.fail1.getChildByName("gems").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(e),this.fail1.getChildByName("dagger").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(o)},e.prototype.showFail2=function(t,e,o,n,i,r){app.AudioMgr.play(s.Bundles.Common,"Settlement"),this.waitToDestroy(3),this.fail2.active=!0,this.fail2.getChildByName("tip").getComponent(app.i18nLabel).init("beastcoming_tips06",[t]),this.fail2.getChildByName("invest").getComponent(app.i18nLabel).init("beastcoming_title22",[MyFun.formatDecimalPlaces(e)]),this.fail2.getChildByName("dagger").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(o),this.jumpCB=r,i?(this.fail2.getChildByName("backUnlock").active=!0,this.fail2.getChildByName("backUnlock").getChildByName("back").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(n)):(this.fail2.getChildByName("backLock").active=!0,this.fail2.getChildByName("backLock").getChildByName("back").getComponent(cc.Label).string=MyFun.formatDecimalPlaces(n))},e.prototype.btnUnlockInjuryFreeClicked=function(){this.jumpCB&&this.jumpCB(),a.default.inst.sendMsgToUniApp("product_beast")},r([u(cc.Node)],e.prototype,"maskN",void 0),r([u(cc.Node)],e.prototype,"gameStart",void 0),r([u(cc.Node)],e.prototype,"killerTip",void 0),r([u(cc.Node)],e.prototype,"suc2",void 0),r([u(cc.Node)],e.prototype,"fail1",void 0),r([u(cc.Node)],e.prototype,"fail1Tip",void 0),r([u(cc.Node)],e.prototype,"fail2",void 0),r([u(cc.Node)],e.prototype,"goldSpear",void 0),r([l],e)}(cc.Component);o.default=d,cc._RF.pop()},{"../../game/beastMgr":void 0,"../../game/beast_config":void 0}],beastComing_role:[function(t,e,o){"use strict";cc._RF.push(e,"8cda48gz1hFXo6K5hmKPgv9","beastComing_role");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ske=null,e.userSkinList=[],e.nameN=null,e}return i(e,t),e.prototype.playAni=function(t,e){void 0===e&&(e=!1),this.ske.setAnimation(0,t,e)},e.prototype.leave=function(){cc.isValid(this.nameN)&&this.nameN.destroy()},e.prototype.init=function(){this.nameN=null,this.ske.skeletonData=this.userSkinList[0],this.ske.setSkin("default"),this.ske.setAnimation(0,"daiji",!0)},e.prototype.setData=function(t,e){e&&(this.nameN=e),0==t.userSkin?this.setRoleSke(0):this.setRoleSke(2,t.userSkin)},e.prototype.setRoleSke=function(t,e){void 0===t&&(t=0),this.ske.skeletonData=this.userSkinList[t],2==t&&this.ske.setSkin(""+e),this.ske.setAnimation(0,"daiji",!0)},e.prototype.setMySkin=function(t){void 0===t&&(t=0),this.ske.skeletonData=this.userSkinList[1],t>=1&&(this.ske.skeletonData=this.userSkinList[2],this.ske.setSkin(""+t)),this.ske.setAnimation(0,"daiji",!0)},r([c(sp.Skeleton)],e.prototype,"ske",void 0),r([c(sp.SkeletonData)],e.prototype,"userSkinList",void 0),r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],beastComing:[function(t,e,o){"use strict";cc._RF.push(e,"364bfcoF/5Pp56POgp6gEoT","beastComing");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(e){return c([t,e])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(a){r=[6,a],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.roomIdLinkName=void 0;var c,l=t("./AStar"),u=t("./follow"),d=t("../../proto/mystibeast_pb"),p=t("./beastComing_role"),h=t("./beastComing_result"),f=t("./beastComing_autoPlay"),m=t("../../game/beastMgr"),g=t("../../game/beast_config"),y=t("./beastComing_rank"),b=t("./beastComing_record"),v=t("../../core/components/gameBase"),_=cc._decorator,C=_.ccclass,k=_.property;(function(t){t[t.otherRole=0]="otherRole",t[t.selfRole=1]="selfRole",t[t.killer=2]="killer"})(c||(c={}));var R=new Map([["end1",{index:1,pos:cc.v2(-205,270)}],["end2",{index:2,pos:cc.v2(67,300)}],["end3",{index:3,pos:cc.v2(310,290)}],["end4",{index:4,pos:cc.v2(-161,5)}],["end5",{index:5,pos:cc.v2(292,5)}],["end6",{index:6,pos:cc.v2(-204,-265)}],["end7",{index:7,pos:cc.v2(71,-270)}]]);o.roomIdLinkName=new Map([[1,{name:"\u6469\u5929\u8f6e",i18n_key:"beastcoming_build01"}],[2,{name:"\u9a6c\u620f\u56e2",i18n_key:"beastcoming_build02"}],[3,{name:"\u65cb\u8f6c\u6728\u9a6c",i18n_key:"beastcoming_build03"}],[4,{name:"\u6d77\u76d7\u8239",i18n_key:"beastcoming_build04"}],[5,{name:"\u9b3c\u5c4b",i18n_key:"beastcoming_build05"}],[6,{name:"\u73a9\u5177\u5e97",i18n_key:"beastcoming_build06"}],[7,{name:"\u751c\u54c1\u8f66",i18n_key:"beastcoming_build07"}]]);var w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mainLayer=null,e.content=null,e.gemLab=null,e.daggerLab=null,e.Map=null,e.mapLayer=null,e.roomLayer=null,e.betRoomLayer=null,e.myBet=null,e.rolePre=null,e.killerN=null,e.roleName=null,e.time=null,e.periodsLab=null,e.gameCoin=null,e.content2=null,e.selectLab=null,e.selectList=null,e.selectItem=null,e.aniArea=null,e.doorSke=null,e.prizeGems=null,e.lastRoundTip=null,e.maintainServerMask=null,e.autoPlayBtn=null,e.menulist=null,e.menu=null,e.scrollView=null,e.topBg=null,e.goldSpear=null,e.layer_road=null,e.object_initPos=null,e.start_point_player=null,e.start_point_killer=null,e.map_point=new Map,e.size=null,e.isMoving=!1,e.isInRoom=!1,e.isKillerShow=!1,e.killerEnterRoom=0,e.roleMap=new Map,e.endTarget=["end1","end2","end3","end4","end5","end6","end7"],e.poolSize=60,e.curGameStatus=0,e.timeCountFun=null,e.rideResultList=[],e.prizeGem=0,e.reductNum=0,e.curRoundId=0,e.lastAtkId=0,e.userSkin=0,e.isModuleValid=!1,e.targetNum=0,e.round_RoomInvest=0,e.round_RoomDagger=0,e.round_invest=0,e.round_get=0,e.round_daggers=0,e.initKillerPos=null,e.moveSpeed=.1,e.lastSelectRoom="",e.killerShowDelayTime=4,e.betNumList=[10,1,.1],e.accBet=0,e.movingCount=0,e.isAutoPlay=!1,e.curRateIndex=2,e.isShow=!1,e}return i(e,t),e.prototype.onLoad=function(){return s(this,void 0,void 0,function(){return a(this,function(){return this.setSafeAreaUI(),this.initPlayerPool(),this.readMap(),this.joinGame(),[2]})})},e.prototype.onEnable=function(){app.AudioMgr.playMusic(g.Bundles.Game_BeastComing,"BeastGameplayBgm")},e.prototype.setSafeAreaUI=function(){var t=this;"H5"!=m.default.inst.platform&&(this.scrollView.content.getComponent(cc.Layout).paddingTop=m.default.inst.sysHeight,this.scheduleOnce(function(){t.scrollView.content.getComponent(cc.Layout).updateLayout()},0),this.topBg.getComponent(cc.Widget).top=-m.default.inst.sysHeight,this.scheduleOnce(function(){t.topBg.getComponent(cc.Widget).updateAlignment()},0))},e.prototype.joinGame=function(){var t=this,e=new d.JoinGameReq;e.setDeviceId(m.default.inst.deviceId),e.setIp(m.default.inst.ip);var o=m.default.inst.BeastComingClient.joinGame(e,m.default.inst.metadata);o.on("data",function(e){switch(e.getAnyCase()){case d.MessagePush.AnyCase.KICKUSERPUSH:var o=e.getKickuserpush();t._handleKickUserPush(o);break;case d.MessagePush.AnyCase.BEASTCOMINGJOINGAMEPUSH:var n=e.getBeastcomingjoingamepush();t._handleJoinGamePush(n);break;case d.MessagePush.AnyCase.BEASTCOMINGHIDEPUSH:var i=e.getBeastcominghidepush();t._handleBeastComingHidePush(i);break;case d.MessagePush.AnyCase.BEASTCOMINGSTATECHANGEPUSH:var r=e.getBeastcomingstatechangepush();t._handleBeastComingStateChangePush(r);break;default:cc.log("Unknown message type")}}),o.on("end",function(){cc.log("Server ended the call")}),o.on("error",function(t){cc.error("Error:",t)}),o.on("status",function(e){return s(t,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return cc.log("Status:",e),14!=e.code?[3,1]:(this.maintainServerMask.active=!0,m.default.inst.curLayer=m.Layer.MAIN,[3,3]);case 1:return 16!=e.code?[3,3]:(m.default.inst.handleCode(e.code),m.default.inst.isKickOut=!0,[4,this.wait(1.2)]);case 2:t.sent(),m.default.inst.sendMsgToUniApp("logout"),t.label=3;case 3:return[2]}})})}),this.initRound(),this._getBeastRoomInfo()},e.prototype._handleKickUserPush=function(t){return s(this,void 0,void 0,function(){var e;return a(this,function(o){switch(o.label){case 0:return e=t.toObject(),cc.log("\u8e22\u4eba\u63a8\u9001",e,m.default.inst.userId),e.userId!=m.default.inst.userId?[3,2]:(m.default.inst.showWarning("beast_netmsg01"),m.default.inst.isKickOut=!0,[4,this.wait(1.2)]);case 1:o.sent(),m.default.inst.sendMsgToUniApp("logout"),o.label=2;case 2:return[2]}})})},e.prototype._handleJoinGamePush=function(t){var e=t.toObject();cc.log("\u52a0\u5165\u6e38\u620f\u63a8\u9001",e);var o=e.user;this.roleMap.has(o.userId)||this.generateRole(o)},e.prototype._handleBeastComingHidePush=function(t){var e=this,o=t.toObject();if(cc.log("hidePush",o),o.carryNum>0){var n={userId:o.userId,userAvatar:o.userAvatar,userNickname:o.userNickname,userSkin:o.userSkin};if(this.scheduleOnce(function(){return e.moveRole(n,o.hideRide)}),o.userId==m.default.inst.userId){this.accBet=MyFun.addFloat(this.accBet,MyFun.getRealNum(o.carryNum));var i=this.endTarget[o.hideRide-1];this.showMyBet(i,this.accBet)}}for(var r=0;r<o.carryMapsMap.length;r++){var s=o.carryMapsMap[r];this.getRoomBetInfo(s[0],MyFun.getRealNum(s[1]))}1==this.curGameStatus&&(this.time.getComponent(cc.Label).fontSize=48,this.time.getComponent(cc.Label).enableBold=!1,this.time.getComponent(app.i18nLabel).init("beastcoming_tips14",[o.attendNum+"/"+this.targetNum]))},e.prototype._handleBeastComingStateChangePush=function(t){var e=t.toObject();cc.log("\u8eb2\u85cf\u72b6\u6001\u6539\u53d8\u63a8\u9001",e),this.curGameStatus=e.state,0!=e.state?1==e.state?(this._showLastRoundTip(),this.curRoundId=e.roundId,this.time.getComponent(cc.Label).fontSize=48,this.time.getComponent(cc.Label).enableBold=!1,this.time.getComponent(app.i18nLabel).init("beastcoming_tips14",[e.attendNum+"/"+this.targetNum])):2==e.state?(this.showStart_tip(),this.showTime(e.countDown)):3==e.state||4==e.state&&(this.time.parent.active=!1,this._hideLastRoundTip(),this.isKillerShow=!0,this._getRoundResult(e.roundId)):this.maintainServerMask.active=!0},e.prototype.showTime=function(t){var e=this;this.time.parent.active=!0,this.time.getComponent(cc.Label).fontSize=80,this.time.getComponent(cc.Label).enableBold=!0,this.time.getComponent(cc.Label).string=""+t,t--,this.schedule(this.timeCountFun=function(){cc.log(t),t>=0?(e.time.getComponent(cc.Label).string=""+t,t--):e.unschedule(e.timeCountFun)},1)},e.prototype._getRoundResult=function(t){var e=this,o=new d.BeastComingRoundResultReq;o.setRoundId(t),m.default.inst.BeastComingClient.beastComingRoundResult(o,m.default.inst.metadata).then(function(t){if(0==t.getResult()){var o=t.getBeastcomingroundresultresp().toObject();cc.log(o),e.prizeGem=MyFun.getRealNum(o.jackpotInfo.gemsNum),m.default.inst.myGems=MyFun.getRealNum(o.myGemsNum),m.default.inst.mydaggers=MyFun.getRealNum(o.myDaggersNum),e.loadAccountInfo(),e.round_RoomInvest=MyFun.getRealNum(o.roundInfo.gemsToSurvival),e.round_RoomDagger=MyFun.getRealNum(o.roundInfo.giveDaggers),e.round_get=MyFun.getRealNum(o.roundWinNum),e.round_invest=MyFun.getRealNum(o.roundCarryNum),e.round_daggers=MyFun.getRealNum(o.roundDaggersNum),e.killerEnterRoom=o.roundInfo.attackRide,e.rideResultList=o.rideResultList,e.reductNum=MyFun.getRealNum(o.roundReductNum),e.showKiller(),cc.director.emit("refresh_spearRecord")}else cc.log("errorCode",t.getCode(),"errorMsg",t.getMsg()),m.default.inst.handleCode(t.getCode())})},e.prototype._showPrizeGems=function(t){var e=Number(this.prizeGems.string);e!=t&&MyFun.jumpNumberAsync(e,Number(t.toFixed(2)),.2,this.prizeGems)},e.prototype._getBeastRoomInfo=function(){var t=this,e=new d.BeastComingRoundInfoReq;m.default.inst.BeastComingClient.beastComingRoundInfo(e,m.default.inst.metadata).then(function(e){if(0==e.getResult()){var o=e.getBeastcomingroundinforesp().toObject();cc.log(o),m.default.inst.userId=o.userId,t.userSkin=o.mySkin,t._loadRoundInfo(o),t._handleJackpotInfo(o.jackpotInfo),t._handleLastRoundInfo(o.lastRoundInfo),m.default.inst.myGems=MyFun.getRealNum(o.myGemsNum),m.default.inst.mydaggers=MyFun.getRealNum(o.myDaggersNum),t.loadAccountInfo(),t._handleMyHide(o.myHideInfo),t._handleHidingList(o.rideHidingListList),t._handleRoundInfo(o.roundInfo,o.nowTime),t._handleWaitingList(o.waitListList),t._handleModuleValid(o.bcomingModuleValid,o.autoId)}else cc.log("errorCode",e.getCode(),"errorMsg",e.getMsg()),m.default.inst.handleCode(e.getCode())})},e.prototype._handleModuleValid=function(t,e){this.isModuleValid=t,m.default.inst.beastModule=t,this.goldSpear.active=t,this.isAutoPlay=e>0},e.prototype._loadRoundInfo=function(t){this.curRoundId=t.roundInfo.id,this.periodsLab.node.getComponent(app.i18nLabel).init("beastcoming_title02",[this.curRoundId.toString()])},e.prototype._handleRoundInfo=function(t,e){var o=this;if(this.targetNum=t.targetNum,this.curGameStatus=t.status,0!=t.status)if(1==t.status)this.scheduleOnce(function(){o._showLastRoundTip()},1.2),this.time.parent.active=!0,this.time.getComponent(cc.Label).fontSize=48,this.time.getComponent(cc.Label).enableBold=!1,this.time.getComponent(app.i18nLabel).init("beastcoming_tips14",[t.attendNum+"/"+t.targetNum]);else if(2==t.status){var n=t.attackTime-e;this.showTime(n-1)}else 3==t.status?this.time.parent.active=!1:4==t.status&&(this.isKillerShow=!0,this._hideLastRoundTip());else this.maintainServerMask.active=!0},e.prototype._handleMyHide=function(t){if(t.isHide){this.isInRoom=!0;var e=this.endTarget[t.hideRide-1],o=MyFun.getRealNum(t.carryNum);if(this.accBet=o,this.lastSelectRoom=e,t.hideRide>=8)return;this.roomLayer.getChildByName(e).children[0].getComponent(sp.Skeleton).setAnimation(0,"xz",!0),this.showMyBet(e,o)}},e.prototype._handleJackpotInfo=function(t){this._showPrizeGems(MyFun.getRealNum(t.gemsNum))},e.prototype._handleLastRoundInfo=function(t){null!=t&&null!=t&&(this.lastAtkId=t.attackRide)},e.prototype._showLastRoundTip=function(){if(0!==this.lastAtkId){this.lastRoundTip.node.parent.active=!0;var t=o.roomIdLinkName.get(this.lastAtkId).i18n_key,e=app.i18nMgr._getLabel(t,[]);this.lastRoundTip.node.getComponent(app.i18nLabel).init("beastcoming_tips02",[e])}},e.prototype._hideLastRoundTip=function(){this.lastRoundTip.node.parent.active=!1},e.prototype._handleHidingList=function(t){for(var e=0;e<t.length;e++){var o=t[e];this.getRoomBetInfo(o.rideSn,MyFun.getRealNum(o.gemsNum))}},e.prototype._handleWaitingList=function(t){for(var e=0;e<t.length;e++){var o=t[e];this.roleMap.has(o.userId)||this.generateRole(o)}},e.prototype._beastHiding=function(t,e,o){var n=this;void 0===e&&(e=0);var i=new d.BeastComingHidingReq;i.setRoundId(this.curRoundId),i.setRideSn(R.get(t).index),i.setGemsChoice(e),m.default.inst.BeastComingClient.beastComingHidingOp(i,m.default.inst.metadata).then(function(t){if(0==t.getResult()){cc.log("\u4e0b\u6ce8\u6210\u529f");var e=t.getBeastcominghidingresp().toObject();m.default.inst.myGems=MyFun.getRealNum(e.myGemsNum),o&&o(),n.loadAccountInfo()}else m.default.inst.handleCode(t.getCode())})},e.prototype._onEventHide=function(){return s(this,void 0,void 0,function(){return a(this,function(){return cc.log("hide.............."),t.prototype._onEventHide.call(this),this.unscheduleAllCallbacks(),m.default.inst.leaveGame(),[2]})})},e.prototype._onEventShow=function(){cc.log("show.............."),t.prototype._onEventShow.call(this),this.unscheduleAllCallbacks(),this.joinGame()},e.prototype.changeScene=function(){return s(this,void 0,void 0,function(){return a(this,function(){return cc.Tween.stopAll(),this.unscheduleAllCallbacks(),[2]})})},e.prototype.onDisable=function(){return s(this,void 0,void 0,function(){return a(this,function(){return t.prototype.onDisable.call(this),this.changeScene(),[2]})})},e.prototype.initPlayerPool=function(){for(var t=0;t<this.poolSize;++t){var e=cc.instantiate(this.rolePre);app.nodePoolMgr.putNode(e)}},e.prototype.loadAccountInfo=function(){var t=MyFun.transferNumToK(m.default.inst.myGems);"k"==t.charAt(t.length-1)?this.gameCoin.string=t:this.gameCoin.string=MyFun.formatDecimalPlaces(m.default.inst.myGems);var e=MyFun.transferNumToK(m.default.inst.mydaggers);"k"==e.charAt(e.length-1)?this.daggerLab.string=e:this.daggerLab.string=MyFun.formatDecimalPlaces(m.default.inst.mydaggers)},e.prototype.readMap=function(){this.layer_road=this.Map.getLayer("floor").getComponent(cc.TiledLayer);var t=this.Map.getLayer("wall").getComponent(cc.TiledLayer);this.object_initPos=this.Map.getObjectGroup("initPos"),this.size=this.Map.getMapSize(),this.start_point_player=this.getPoint(this.object_initPos,"start_player"),this.start_point_killer=this.getPoint(this.object_initPos,"start_killer"),this.initKillerPos=this.killerN.getPosition();for(var e=0;e<this.size.width;e++)for(var o=0;o<this.size.height;o++){var n=this.layer_road.getTiledTileAt(e,o,!0),i=t.getTiledTileAt(e,o,!0);if(0!==n.gid&&0===i.gid){var r=new l.Point(e,o);this.map_point.set(e+o*this.size.width,r)}}},e.prototype.getTilePos=function(t,e){var o=t/this.Map.getTileSize().width,n=(this.Map.node.getContentSize().height-e)/this.Map.getTileSize().height;return cc.v2(o,n)},e.prototype.hideRole=function(t,e){this.collectRole(t),this.roleMap.delete(e)},e.prototype.findWay=function(t,e,o,n,i){var r;return s(this,void 0,void 0,function(){var u,d,h,f,m,g=this;return a(this,function(){return u=l.default.getRoute(t,e,this.map_point,this.size),d=0,n===c.killer?o.getComponentInChildren(sp.Skeleton).setAnimation(0,"zou3",!0):o.getComponent(p.default).playAni("zoulu",!0),h=function(){return s(g,void 0,void 0,function(){var t,r,s,l;return a(this,function(){return d==u.length&&d>0?(n!==c.killer?(n==c.selfRole&&(this.isInRoom=!0,this.isMoving=!1,this.movingCount--,this.showMyBet(e.targetName,this.accBet)),this.hideRole(o,i)):this.handleKillerEnterRoom(e),[2]):(d>0&&(t=u[d-1],r=u[d],this.setRoleDir(t,r,o,n==c.killer)),s=u[d++],cc.tween(o).to(this.moveSpeed,{position:null===(l=this.layer_road.getTiledTileAt(s.x,s.y,!1))||void 0===l?void 0:l.node.position}).call(function(){n==c.otherRole&&(o.zIndex=-o.y),h()}).start(),[2])})})},f=null===(r=this.layer_road.getTiledTileAt(t.x,t.y,!1))||void 0===r?void 0:r.node.position,n==c.killer?(m=MyFun.calculateDis(o.position,f),cc.tween(o).to(this.moveSpeed*m/30,{position:f}).call(function(){return s(g,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,h()];case 1:return t.sent(),[2]}})})}).start()):cc.tween(o).to(this.moveSpeed*(f.y-o.position.y)/30,{position:cc.v3(o.position.x,f.y,0)}).to(this.moveSpeed*(f.x-o.position.x)/30,{position:cc.v3(f.x,f.y,0)}).call(function(){return s(g,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,h()];case 1:return t.sent(),[2]}})})}).start(),n==c.selfRole&&this.movingCount++,[2]})})},e.prototype.setRoleDir=function(t,e,o,n){void 0===n&&(n=!1),e.x<t.x?o.children[0].scaleX=n?-.5:1:e.x>t.x&&(o.children[0].scaleX=n?.5:-1)},e.prototype.showMyBet=function(t,e){this.myBet.active=!0,this.myBet.setPosition(R.get(t).pos),this.myBet.children[1].getComponent(cc.Label).string=MyFun.transferNumToK(e)},e.prototype.handleKillerEnterRoom=function(t){return s(this,void 0,void 0,function(){var e;return a(this,function(o){switch(o.label){case 0:return e=this.getPoint(this.object_initPos,t.targetName,!0),t.x!=e.x||t.y!=e.y?[3,4]:(this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"daiji",!0),[4,this.playKillerAni()]);case 1:return o.sent(),[4,this.showGemsAni()];case 2:return o.sent(),[4,this.checkRoundResult()];case 3:o.sent(),this.initRound(),this._getBeastRoomInfo(),o.label=4;case 4:return[2]}})})},e.prototype.setDoorState=function(t){void 0===t&&(t=0),0==t?this.doorSke.setAnimation(0,"close",!0):this.doorSke.setAnimation(0,"open",!0)},e.prototype.playDoorAni=function(t){return void 0===t&&(t=0),s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return 1!=t?[3,2]:(this.doorSke.setAnimation(0,"open door",!1),[4,this.wait(1)]);case 1:return e.sent(),this.doorSke.setAnimation(0,"open",!0),[3,4];case 2:return this.doorSke.setAnimation(0,"close door",!1),[4,this.wait(1)];case 3:e.sent(),this.doorSke.setAnimation(0,"close",!0),e.label=4;case 4:return[2]}})})},e.prototype.showGemsAni=function(){return s(this,void 0,void 0,function(){var t,e,o,n,i=this;return a(this,function(r){switch(r.label){case 0:return t=this.killerEnterRoom,e=this.roomLayer.getChildByName("end"+t),o=this.aniArea.getChildByName("gems"),n=this.rideResultList.filter(function(t){return t.winNum>0}),[4,this.onPlayCoinAni(e,this.aniArea,o,n,function(){for(var t=0;t<i.rideResultList.length;t++){var e=i.rideResultList[t];i.getRoomBetInfo(e.rideSn,MyFun.getRealNum(e.winNum))}i._showPrizeGems(i.prizeGem)})];case 1:return r.sent(),[2]}})})},e.prototype.onPlayCoinAni=function(t,e,o,n,i){var r=this,s=10*(n.length+1);return new Promise(function(a){for(var c=MyFun.getNodePos(t,e),l=MyFun.getCirclePoints(80,c,s,50),u=function(t){var u=cc.instantiate(o);u.active=!0,u.parent=e,u.setPosition(c);var d=l[t].x,p=l[t].y;cc.tween(u).to(.15,{position:cc.v3(d,p)}).start(),r.scheduleOnce(function(){cc.Tween.stopAllByTarget(u);var o,c=u.getPosition(),l=t%(n.length+1);o=l==n.length?r.prizeGems.node:r.betRoomLayer.getChildByName("bet"+n[l].rideSn).children[1];var d=MyFun.getNodePos(o,e),p=c.sub(d).mag()/500;cc.tween(u).to(p,{position:cc.v3(d.x,d.y)},{easing:"sineInOut"}).call(function(){u.destroy(),t==s-1&&(i&&i(),a())}).start()},.15+.2*.1)},d=0;d<s;d++)u(d)})},e.prototype.playKillerAni=function(){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return app.AudioMgr.play(g.Bundles.Game_BeastComing,"BeastAttack"),this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"kan",!1),[4,this.wait(.5)];case 1:return t.sent(),this.roomLayer.getChildByName("end"+this.killerEnterRoom).children[0].getComponent(sp.Skeleton).setAnimation(0,"GJ",!0),[2]}})})},e.prototype.initKiller=function(){this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"daiji",!0),this.killerN.setPosition(this.initKillerPos)},e.prototype.checkRoundResult=function(){return s(this,void 0,void 0,function(){var t;return a(this,function(e){switch(e.label){case 0:return this.isInRoom?this.round_get<=0?(t=this.reductNum,this.isModuleValid||(t=.2*this.round_invest),this.showPop_fail2(this.round_invest,this.round_daggers,t)):this.showPop_suc2(this.round_invest,this.round_get):this.showPop_fail1(this.round_RoomInvest,this.round_RoomDagger),[4,this.wait(3)];case 1:return e.sent(),[2]}})})},e.prototype.clearRoomBetNum=function(){this.myBet.active=!1,this.myBet.children[1].getComponent(cc.Label).string="0";for(var t=1;t<8;t++){var e="bet"+t;this.betRoomLayer.getChildByName(e).getChildByName("betNum").getComponent(cc.Label).string="0"}},e.prototype.clearRoleMapList=function(){var t=this;this.roleMap.forEach(function(e){t.collectRole(e)}),this.roleMap.clear()},e.prototype.hideResult=function(){var t=cc.find("beastComing_result",this.content);cc.isValid(t)&&t.destroy()},e.prototype.initRound=function(){this.clearRoomBetNum(),this.clearRoleMapList(),this.clearSelectedRoom(),this.hideResult(),this.initKiller(),this.lastAtkId=0,this.round_RoomInvest=0,this.round_RoomDagger=0,this.round_get=0,this.round_invest=0,this.round_daggers=0,this.reductNum=0,this.isInRoom=!1,this.isMoving=!1,this.myBet.active=!1,this.movingCount=0,this.lastSelectRoom="",this.setDoorState(1),this.isKillerShow=!1,this.accBet=0,this.rideResultList=[]},e.prototype.clearSelectedRoom=function(t){""==t||null==t?this.roomLayer.children.forEach(function(t){t.children[0].getComponent(sp.Skeleton).setAnimation(0,"normal",!0)}):this.roomLayer.getChildByName(t).children[0].getComponent(sp.Skeleton).setAnimation(0,"normal",!0)},e.prototype.setEndPos=function(t){var e=this;if(this.isAutoPlay)m.default.inst.showConfirm("beastcoming_tips05",function(){var t=new d.BeastComingAutoHideEndReq;m.default.inst.BeastComingClient.beastComingAutoHideEnd(t,m.default.inst.metadata).then(function(t){0==t.getCode()?e.isAutoPlay=!1:(2019==t.getCode()&&(e.isAutoPlay=!1),m.default.inst.handleCode(t.getCode()))}).catch(function(){})});else if(!(this.isKillerShow||this.isMoving||this.movingCount>0)){var o=t.target.name;o!=this.lastSelectRoom&&(this.isInRoom?this.handleInRoomEndPos(o,function(){e.clearSelectedRoom(e.lastSelectRoom),e.roomLayer.getChildByName(o).children[0].getComponent(sp.Skeleton).setAnimation(0,"xz",!0),e.showMyBet(o,e.accBet),e.lastSelectRoom=o}):(this.clearSelectedRoom(this.lastSelectRoom),this.roomLayer.getChildByName(o).children[0].getComponent(sp.Skeleton).setAnimation(0,"xz",!0),this.lastSelectRoom=o))}},e.prototype.handleInRoomEndPos=function(t,e){this._beastHiding(t,0,e)},e.prototype.getPoint=function(t,e,o){var n=t.getObject(e);if(n){var i=this.getTilePos(n.x,n.y),r=new l.Point(i.x,i.y);return o&&(r.targetName=e),r}},e.prototype.generateRole=function(t){var e=app.nodePoolMgr.getNode(this.rolePre,this.mapLayer);this.roleMap.set(t.userId,e);var o=Math.random()>.5?"waiting1":"waiting2";e.setPosition(this._getRandomPos(e,this.Map.node,o)),e.getComponent(p.default).init(),e.zIndex=-e.y;var n=cc.instantiate(this.roleName);return e.getComponent(p.default).setData(t,n),n.parent=this.roleName.parent,n.active=!0,n.getComponent(u.default).targetNode=e,t.userId==m.default.inst.userId?(n.getComponent(cc.Label).string="You",e.getComponent(p.default).setMySkin(this.userSkin)):n.getComponent(cc.Label).string=MyFun.maskName(t.userNickname),e},e.prototype._getRandomPos=function(t,e,o,n){var i;void 0===n&&(n=c.otherRole);var r,s,a=e.getChildByName(o).getBoundingBoxToWorld();r=Math.random()*(a.width-t.width)+a.x,s=Math.random()*(a.height-t.height)/2+a.y,n==c.selfRole&&(r=Math.random()*(a.width-t.width)/2+a.x,s=Math.random()*(a.height-t.height)/4+a.y);var l=null===(i=null==t?void 0:t.parent)||void 0===i?void 0:i.convertToNodeSpaceAR(cc.v2(r,s));return cc.v3(l,0)},e.prototype.collectRole=function(t){t&&t.getComponent(p.default).leave(),cc.Tween.stopAllByTarget(t),app.nodePoolMgr.putNode(t)},e.prototype.getRoomBetInfo=function(t,e){var o,n="bet"+t,i=null===(o=this.betRoomLayer.getChildByName(n))||void 0===o?void 0:o.getChildByName("betNum").getComponent(cc.Label);if(i){var r=Number(i.string);if(r==e)return;MyFun.jumpNumberAsync(r,Number(e.toFixed(2)),.3,i)}},e.prototype.moveRole=function(t,e){var o=this.roleMap.get(t.userId);o||(o=this.generateRole(t));var n=this.getPoint(this.object_initPos,this.endTarget[e-1],!0),i=t.userId==m.default.inst.userId?c.selfRole:c.otherRole;this.findWay(this.start_point_player,n,o,i,t.userId),this.roleMap.delete(t.userId)},e.prototype.showKiller=function(){return s(this,void 0,void 0,function(){var t,e,o=this;return a(this,function(n){switch(n.label){case 0:return this.isKillerShow=!0,[4,this.showPop_killer(this.killerShowDelayTime)];case 1:return n.sent(),this.killerEnterRoom>0&&this.killerEnterRoom<=7?t=this.endTarget[this.killerEnterRoom-1]:(t=MyFun.getRandomItemFromArr(this.endTarget),this.killerEnterRoom=R.get(t).index),e=this.getPoint(this.object_initPos,t,!0),this.findWay(this.start_point_killer,e,this.killerN,c.killer),this.scheduleOnce(function(){o.playDoorAni(0)},1.2),[2]}})})},e.prototype.showStart_tip=function(t){return void 0===t&&(t=1),s(this,void 0,void 0,function(){var e,o;return a(this,function(n){switch(n.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Result))];case 1:return e=n.sent(),(o=cc.instantiate(e)).parent=this.content2,o.getComponent(h.default).showStartTip(t),[2]}})})},e.prototype.showPop_killer=function(t){return s(this,void 0,void 0,function(){var e,o;return a(this,function(n){switch(n.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Result))];case 1:return e=n.sent(),(o=cc.instantiate(e)).parent=this.content2,o.getComponent(h.default).showKillerTip(t),[4,this.wait(t)];case 2:return n.sent(),[2]}})})},e.prototype.showPop_suc2=function(t,e){return s(this,void 0,void 0,function(){var o,n;return a(this,function(i){switch(i.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Result))];case 1:return o=i.sent(),(n=cc.instantiate(o)).parent=this.content2,n.getComponent(h.default).showSuc2(t,e),[2]}})})},e.prototype.showPop_fail1=function(t,e){return s(this,void 0,void 0,function(){var n,i,r;return a(this,function(s){switch(s.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Result))];case 1:return n=s.sent(),(i=cc.instantiate(n)).parent=this.content2,r=app.i18nMgr._getLabel(o.roomIdLinkName.get(this.killerEnterRoom).i18n_key,[]),i.getComponent(h.default).showFail1(r,t,e),[2]}})})},e.prototype.showPop_fail2=function(t,e,n){return s(this,void 0,void 0,function(){var i,r,c,l=this;return a(this,function(u){switch(u.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Result))];case 1:return i=u.sent(),(r=cc.instantiate(i)).parent=this.content2,c=app.i18nMgr._getLabel(o.roomIdLinkName.get(this.killerEnterRoom).i18n_key,[]),r.getComponent(h.default).showFail2(c,t,e,n,this.isModuleValid,function(){return s(l,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,m.default.inst.leaveGame()];case 1:return t.sent(),[2]}})})}),[2]}})})},e.prototype.wait=function(t){var e=this;return new Promise(function(o){e.scheduleOnce(function(){o()},t)})},e.prototype.btnBetSureClicked=function(){var t=this;this.isAutoPlay?m.default.inst.showConfirm("beastcoming_tips05",function(){var e=new d.BeastComingAutoHideEndReq;m.default.inst.BeastComingClient.beastComingAutoHideEnd(e,m.default.inst.metadata).then(function(e){0==e.getCode()?t.isAutoPlay=!1:(2019==e.getCode()&&(t.isAutoPlay=!1),m.default.inst.handleCode(e.getCode()))}).catch(function(){})}):this.isKillerShow||(""!=this.lastSelectRoom?this.betNumList[this.curRateIndex]>m.default.inst.myGems?m.default.inst.showWarning("beastcoming_tips01"):this._beastHiding(this.lastSelectRoom,this.curRateIndex+1):m.default.inst.showWarning("beastcoming_tips03"))},e.prototype.btnBetRateClicked=function(){var t=this;if(this.selectList.active)this.selectList.active=!1;else{this.selectList.active=!0,this.selectList.removeAllChildren();for(var e=function(e){var n=cc.instantiate(o.selectItem);n.active=!0,o.curRateIndex==e&&(n.children[0].active=!0),n.getChildByName("num").getComponent(cc.Label).string=o.betNumList[e]+"",n.parent=o.selectList,n.on("click",function(){n.children[0].active=!0,t.selectList.active=!1,t.curRateIndex=e,t.selectLab.string=t.betNumList[e].toString()})},o=this,n=0;n<this.betNumList.length;n++)e(n)}},e.prototype.btnRecordClicked=function(){return s(this,void 0,void 0,function(){var t,e,o=this;return a(this,function(n){switch(n.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Record))];case 1:return t=n.sent(),(e=cc.instantiate(t)).parent=this.content2,e.getComponent(b.default).setBackCall(function(){o.backClickFun()}),this.enterOtherLayer(),[2]}})})},e.prototype.btnRankCLicked=function(){return s(this,void 0,void 0,function(){var t,e,o=this;return a(this,function(n){switch(n.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Rank))];case 1:return t=n.sent(),(e=cc.instantiate(t)).parent=this.content2,e.getComponent(y.default).setBackCall(function(){o.backClickFun()}),this.enterOtherLayer(),[2]}})})},e.prototype.btnAutoClicked=function(){return s(this,void 0,void 0,function(){var t,e,o=this;return a(this,function(n){switch(n.label){case 0:return this.isModuleValid?[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Game_BeastComing,g.BeastComing_Pop.Autoplay))]:(m.default.inst.showConfirm("confirm_tip1",function(){return s(o,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return[4,m.default.inst.leaveGame()];case 1:return t.sent(),m.default.inst.sendMsgToUniApp("product_beast"),[2]}})})}),[2]);case 1:return t=n.sent(),(e=cc.instantiate(t)).parent=this.content2,e.getComponent(f.default).setData(this.isAutoPlay,function(t){o.isAutoPlay=t,o.backClickFun()}),e.getComponent(f.default).setBackCall(function(){o.backClickFun()}),this.enterOtherLayer(),[2]}})})},e.prototype.btnSpearClicked=function(){return s(this,void 0,void 0,function(){var t,e,o=this;return a(this,function(n){switch(n.label){case 0:return[4,MyFun.loadPrefab(g.getPrefabInfo(g.Bundles.Common,g.Common_Pop.MySpear))];case 1:return t=n.sent(),(e=cc.instantiate(t)).parent=this.content2,e.getComponent("mySpear").setData(m.default.inst.mydaggers,this.backClickFun.bind(this),function(){return s(o,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return cc.audioEngine.stopMusic(),[4,m.default.inst.leaveGame()];case 1:return t.sent(),[2]}})})}),this.enterOtherLayer(),[2]}})})},e.prototype.enterOtherLayer=function(){this.mainLayer.opacity=0},e.prototype.btnGemsClicked=function(){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return cc.audioEngine.stopMusic(),[4,m.default.inst.leaveGame()];case 1:return t.sent(),m.default.inst.sendMsgToUniApp("gems"),[2]}})})},e.prototype.btnCloseClicked=function(){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return m.default.inst.curLayer!=m.Layer.MAIN?[3,2]:[4,m.default.inst.leaveGame()];case 1:return t.sent(),m.default.inst.backToApp(),[3,3];case 2:this.backClickFun(),t.label=3;case 3:return[2]}})})},e.prototype.backClickFun=function(){m.default.inst.curLayer=m.Layer.MAIN,this.mainLayer.opacity=255},e.prototype.btnJumpToStrikeGame=function(){return s(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return cc.audioEngine.stopMusic(),[4,m.default.inst.leaveGame()];case 1:return t.sent(),m.default.inst.jumpToGame(m.gameType.beastStrike),[2]}})})},e.prototype.menuClicked=function(){var t=this;this.isShow=!this.isShow;var e=this.isShow?0:-480;cc.tween(this.menulist).to(.2,{y:e}).call(function(){t.menu.children[1].active=!t.isShow,t.menu.children[2].active=t.isShow}).start()},e.prototype.scrollToRuleInfo=function(){this.scrollView.scrollToOffset(cc.v2(0,this.mainLayer.height+m.default.inst.sysHeight),.5)},r([k(cc.Node)],e.prototype,"mainLayer",void 0),r([k(cc.Node)],e.prototype,"content",void 0),r([k(cc.Label)],e.prototype,"gemLab",void 0),r([k(cc.Label)],e.prototype,"daggerLab",void 0),r([k(cc.TiledMap)],e.prototype,"Map",void 0),r([k(cc.Node)],e.prototype,"mapLayer",void 0),r([k(cc.Node)],e.prototype,"roomLayer",void 0),r([k(cc.Node)],e.prototype,"betRoomLayer",void 0),r([k(cc.Node)],e.prototype,"myBet",void 0),r([k(cc.Prefab)],e.prototype,"rolePre",void 0),r([k(cc.Node)],e.prototype,"killerN",void 0),r([k(cc.Node)],e.prototype,"roleName",void 0),r([k(cc.Node)],e.prototype,"time",void 0),r([k(cc.Label)],e.prototype,"periodsLab",void 0),r([k(cc.Label)],e.prototype,"gameCoin",void 0),r([k(cc.Node)],e.prototype,"content2",void 0),r([k(cc.Label)],e.prototype,"selectLab",void 0),r([k(cc.Node)],e.prototype,"selectList",void 0),r([k(cc.Node)],e.prototype,"selectItem",void 0),r([k(cc.Node)],e.prototype,"aniArea",void 0),r([k(sp.Skeleton)],e.prototype,"doorSke",void 0),r([k(cc.Label)],e.prototype,"prizeGems",void 0),r([k(cc.Label)],e.prototype,"lastRoundTip",void 0),r([k(cc.Node)],e.prototype,"maintainServerMask",void 0),r([k(cc.Node)],e.prototype,"autoPlayBtn",void 0),r([k(cc.Node)],e.prototype,"menulist",void 0),r([k(cc.Node)],e.prototype,"menu",void 0),r([k(cc.ScrollView)],e.prototype,"scrollView",void 0),r([k(cc.Node)],e.prototype,"topBg",void 0),r([k(cc.Node)],e.prototype,"goldSpear",void 0),r([C],e)}(v.default);o.default=w,cc._RF.pop()},{"../../core/components/gameBase":void 0,"../../game/beastMgr":void 0,"../../game/beast_config":void 0,"../../proto/mystibeast_pb":void 0,"./AStar":"AStar","./beastComing_autoPlay":"beastComing_autoPlay","./beastComing_rank":"beastComing_rank","./beastComing_record":"beastComing_record","./beastComing_result":"beastComing_result","./beastComing_role":"beastComing_role","./follow":"follow"}],follow:[function(t,e,o){"use strict";cc._RF.push(e,"7f861vruK9E9Lw4RlUBxitS","follow");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,a=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetNode=null,e}return i(e,t),e.prototype.start=function(){},e.prototype.update=function(){var t,e,o;this.node.active&&(null===(t=this.targetNode)||void 0===t?void 0:t.active)&&(this.node.x=(null===(e=this.targetNode)||void 0===e?void 0:e.x)+this.targetNode.width/2,this.node.y=(null===(o=this.targetNode)||void 0===o?void 0:o.y)+this.targetNode.height+30)},r([a],e)}(cc.Component));o.default=c,cc._RF.pop()},{}],item_record:[function(t,e,o){"use strict";cc._RF.push(e,"66b8e1nCGJL8rvO2kD7mdHL","item_record");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./beastComing"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.issueLab=null,e.timeLab=null,e.resultLab=null,e.betRoom=null,e.killRoom=null,e.investLab=null,e.getInfo=null,e.getLab=null,e}return i(e,t),e.prototype.start=function(){},e.prototype.setData=function(t){this.issueLab.node.getComponent(app.i18nLabel).init("beastcoming_text5",[t.roundId.toString()]),this.timeLab.string=MyFun.formattedDateTime(1e3*t.updateTime),0!==t.attackRide&&(t.hideRide!==t.attackRide?(this.resultLab.color=MyFun.hexToRGBA("#edb284"),this.resultLab.getComponent(app.i18nLabel).init("beastcoming_text1",[]),this.getInfo.node.getComponent(app.i18nLabel).init("beastcoming_text9",[]),this.getLab.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.settleNum))):(this.resultLab.color=MyFun.hexToRGBA("#d30000"),this.resultLab.getComponent(app.i18nLabel).init("beastcoming_text2",[]),this.getInfo.node.getComponent(app.i18nLabel).init("beastcoming_text12",[]),this.getLab.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.giveDaggers))));var e="["+app.i18nMgr._getLabel(s.roomIdLinkName.get(t.hideRide).i18n_key,[])+"]";this.betRoom.node.getComponent(app.i18nLabel).init(e,[]);var o="["+app.i18nMgr._getLabel(s.roomIdLinkName.get(t.attackRide).i18n_key,[])+"]";this.killRoom.node.getComponent(app.i18nLabel).init(o,[]),this.investLab.string=MyFun.formatDecimalPlaces(MyFun.getRealNum(t.carryNum))},r([l(cc.Label)],e.prototype,"issueLab",void 0),r([l(cc.Label)],e.prototype,"timeLab",void 0),r([l(cc.Node)],e.prototype,"resultLab",void 0),r([l(cc.Label)],e.prototype,"betRoom",void 0),r([l(cc.Label)],e.prototype,"killRoom",void 0),r([l(cc.Label)],e.prototype,"investLab",void 0),r([l(cc.Label)],e.prototype,"getInfo",void 0),r([l(cc.Label)],e.prototype,"getLab",void 0),r([c],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./beastComing":"beastComing"}]},{},["AStar","beastComing","beastComing_autoPlay","beastComing_rank","beastComing_rankItem","beastComing_record","beastComing_result","beastComing_role","follow","item_record"]);