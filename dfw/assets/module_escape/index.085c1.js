window.__require=function t(e,o,i){function n(s,c){if(!o[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var p=o[s]={exports:{}};e[s][0].call(p.exports,function(t){return n(e[s][1][t]||t)},p,p.exports,t,e,o,i)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)n(i[s]);return n}({AStar:[function(t,e,o){"use strict";cc._RF.push(e,"becf359V8dBl7DkIcQtdawO","AStar");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var n in e=arguments[o])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},s=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.Point=void 0;var c=cc._decorator,a=c.ccclass,l=(c.property,function(t,e){this.G=0,this.H=0,this.F=0,this.father=null,this.is_close=!1,this.targetName="",this.x=t,this.y=e});o.Point=l;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.getRoute=function(t,e,o,i){var n=this;this.is_find=!1,this.arr_open=[],this.pppp=null,this.start=r({},t),this.end=r({},e),this.map=new Map,o.forEach(function(t,e){n.map.set(e,r({},t))}),this.size=i,o.get(this.start.x+this.start.y*this.size.width).G=0;var s=new Array;try{this.search(this.start)}catch(c){return cc.error("\u4f4d\u7f6e\u4e0d\u5bf9"),s}return this.pppp&&this.getFather(this.pppp,s),s},e.search=function(t){var e=this;if(t.x==this.end.x&&t.y==this.end.y)return this.is_find=!0,void(this.pppp=t);this.getAround(t).forEach(function(o){e.setFather(o,t)}),this.arr_open.sort(this.compare),this.arr_open.forEach(function(t,o,i){t.is_close&&i.splice(o,1),e.is_find||e.search(t)})},e.getAround=function(t){t.is_close=!0;var e,o,i=new Array;return 0!=t.y&&(e=t.x+(t.y-1)*this.size.width,(o=this.map.get(e))&&!o.is_close&&(i.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),t.y+1!=this.size.height&&(e=t.x+(t.y+1)*this.size.width,(o=this.map.get(e))&&!o.is_close&&(i.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),0!=t.x&&(e=t.x-1+t.y*this.size.width,(o=this.map.get(e))&&!o.is_close&&(i.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),t.x+1!=this.size.width&&(e=t.x+1+t.y*this.size.width,(o=this.map.get(e))&&!o.is_close&&(i.push(this.map.get(e)),this.arr_open.push(this.map.get(e)))),i},e.isValidPoint=function(t,e){return t>=0&&e>=0&&t<this.size.width&&e<this.size.height},e.setFather=function(t,e){(!t.father||t.father.G>e.G)&&(t.father=e,t.G=t.father.G+1,t.H=Math.abs(t.x-this.end.x)+Math.abs(t.y-this.end.y),t.F=t.G+t.H)},e.compare=function(t,e){return t.F>e.F?1:-1},e.getFather=function(t,e){var o=t.father;o&&this.getFather(o,e),e.push(t)},e.start=null,e.end=null,e.map=null,e.size=null,e.arr_open=[],e.pppp=null,e.is_find=!1,s([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],escape_pop:[function(t,e,o){"use strict";cc._RF.push(e,"8affcyccChG3KchLklZN+Y3","escape_pop");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../core_lmn/core"),c=cc._decorator,a=c.ccclass,l=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maskN=null,e.killerTip=null,e.suc1=null,e.suc2=null,e.fail1=null,e.fail2=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.showKillerTip=function(){var t=this;this.maskN.color=Myfun.hexToRGBA("#d30001"),this.maskN.opacity=153,this.scheduleOnce(function(){t.node.destroy()},2),this.killerTip.active=!0,cc.tween(this.killerTip).blink(2,8).start()},e.prototype.showSuc1=function(t){this.suc1.active=!0,this.suc1.getChildByName("diamond").getComponent(cc.Label).string=t+""},e.prototype.showSuc2=function(t,e){this.suc2.active=!0,this.suc2.getChildByName("cost").getComponent(cc.Label).string=t+"",this.suc2.getChildByName("get").getComponent(cc.Label).string=e+""},e.prototype.showFail1=function(t){this.fail1.active=!0,this.fail1.getChildByName("name").getComponent(s.i18nLabel).init(t,[])},e.prototype.showFail2=function(t,e){this.fail2.active=!0,this.fail2.getChildByName("name").getComponent(s.i18nLabel).init(t,[]),this.fail2.getChildByName("diamond").getComponent(cc.Label).string=e+""},r([l(cc.Node)],e.prototype,"maskN",void 0),r([l(cc.Node)],e.prototype,"killerTip",void 0),r([l(cc.Node)],e.prototype,"suc1",void 0),r([l(cc.Node)],e.prototype,"suc2",void 0),r([l(cc.Node)],e.prototype,"fail1",void 0),r([l(cc.Node)],e.prototype,"fail2",void 0),r([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../core_lmn/core":void 0}],escape_rank:[function(t,e,o){"use strict";cc._RF.push(e,"522f06Lx8VK7I2r46is31ce","escape_rank");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rankList=null,e.item=null,e.playerIcon=null,e.playerPos=null,e.getV=null,e}return n(e,t),e.prototype.start=function(){this.loadRankData()},e.prototype.loadRankData=function(){this.loadCurWeekRankList()},e.prototype.loadPlayerInfo=function(){},e.prototype.toggleContainer=function(t){if(t.isChecked){var e=t.node.name;cc.log(e),"toggle1"==e?this.loadCurWeekRankList():this.loadLastWeekRankList()}},e.prototype.clearList=function(){for(;this.rankList.childrenCount>2;)this.rankList.children[2].destroy()},e.prototype.loadLastWeekRankList=function(){this.clearList();var t=[];this.loadPlayerInfo();for(var e=0;e<t.length;e++)cc.instantiate(this.item).parent=this.rankList},e.prototype.loadCurWeekRankList=function(){this.clearList();var t=[];this.loadPlayerInfo();for(var e=0;e<t.length;e++)cc.instantiate(this.item).parent=this.rankList},r([a(cc.Node)],e.prototype,"rankList",void 0),r([a(cc.Node)],e.prototype,"item",void 0),r([a(cc.Sprite)],e.prototype,"playerIcon",void 0),r([a(cc.Label)],e.prototype,"playerPos",void 0),r([a(cc.Label)],e.prototype,"getV",void 0),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],escape_record:[function(t,e,o){"use strict";cc._RF.push(e,"47f5cn6tbRB9qzFsS1/pgGP","escape_record");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function s(t){try{a(i.next(t))}catch(e){r(e)}}function c(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}a((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../../scripts/G"),l=cc._decorator,p=l.ccclass,h=l.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.killer_100_record=null,e.killer_10_record=null,e.itemKiller=null,e.playerAccCost=null,e.playerAccGet=null,e.content=null,e.item=null,e}return n(e,t),e.prototype.start=function(){this.loadEscapeRecord()},e.prototype.loadEscapeRecord=function(){var t;return s(this,void 0,void 0,function(){var e;return c(this,function(o){switch(o.label){case 0:return[4,null===(t=a.G.clientWs)||void 0===t?void 0:t.callApi("GetKillerRecords",{playerId:a.G.uid})];case 1:return(e=o.sent()).isSucc?(1==e.res.result&&(cc.log(e.res),this.loadKiller_100_records(e.res.hundredlist),this.loadKiller_10_records(e.res.killerTenlist)),this.loadPlayerRecord(),[2]):(cc.log(e.err),[2])}})})},e.prototype.loadKiller_100_records=function(t){for(var e=this.killer_100_record.children[1],o=0,i=t.length;o<i;o++){var n=t[o],r=e.getChildByName(n.roomid+"");r&&(r.children[2].getComponent(cc.Label).string=n.times+"")}},e.prototype.loadKiller_10_records=function(t){for(var e=this.killer_10_record.children[1],o=0,i=(t=Myfun.sortByObjectValue(t,"periods")).length;o<i;o++){var n=t[o],r=cc.instantiate(this.itemKiller);r.active=!0,r.parent=e,r.getChildByName("room").getComponent(cc.Label).string=n.roomid+"",r.getChildByName("period").getComponent(cc.Label).string="Issue"+n.periods}},e.prototype.loadPlayerRecord=function(){for(var t=0,e=[0].length;t<e;t++){var o=cc.instantiate(this.item);o.active=!0,o.parent=this.content}},r([h(cc.Node)],e.prototype,"killer_100_record",void 0),r([h(cc.Node)],e.prototype,"killer_10_record",void 0),r([h(cc.Node)],e.prototype,"itemKiller",void 0),r([h(cc.Label)],e.prototype,"playerAccCost",void 0),r([h(cc.Label)],e.prototype,"playerAccGet",void 0),r([h(cc.Node)],e.prototype,"content",void 0),r([h(cc.Prefab)],e.prototype,"item",void 0),r([p],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../../scripts/G":void 0}],escape_role:[function(t,e,o){"use strict";cc._RF.push(e,"8cda48gz1hFXo6K5hmKPgv9","escape_role");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ske=null,e.roleSkin=["cheng","huang","lan","lv","shenlv","zi"],e._role=null,e.nameN=null,e}return n(e,t),e.prototype.onEnable=function(){this.node.scale=0,cc.tween(this.node).to(.2,{scale:1}).start()},e.prototype.playTransferAni=function(){var t=this;this.node.children[0].active=!0,this.node.children[1].active=!1,this.node.children[0].getComponent(sp.Skeleton).setAnimation(0,"animation",!1),this.scheduleOnce(function(){t.node.children[0].active=!1,t.node.children[1].active=!0},.3)},e.prototype.playAni=function(t,e){void 0===e&&(e=!1),this.ske.setAnimation(0,t,e)},e.prototype.beKilledAni=function(){this.playAni("daoxia2")},e.prototype.leave=function(){this.nameN.destroy()},e.prototype.setData=function(t,e){this._role=t,e&&(this.nameN=e),this.setSkin(Myfun.getRandomItemFromArr(this.roleSkin))},e.prototype.setSkin=function(t){this.ske.setSkin(t)},e.prototype.getTarget=function(){return this._role.roomid},e.prototype.setTarget=function(t){this._role.roomid=t},e.prototype.getRoleId=function(){return this._role._id},e.prototype.getRole=function(){return this._role},r([a(sp.Skeleton)],e.prototype,"ske",void 0),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],escape_tip:[function(t,e,o){"use strict";cc._RF.push(e,"398aawnuHNCmLnhwDL5M1en","escape_tip");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../core_lmn/core"),c=cc._decorator,a=c.ccclass,l=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tipLab=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.showTip=function(t){var e=this;this.tipLab.node.getComponent(s.i18nLabel).init(t,[]),this.scheduleOnce(function(){e.node.destroy()},1.2)},r([l(cc.Label)],e.prototype,"tipLab",void 0),r([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../core_lmn/core":void 0}],escape:[function(t,e,o){"use strict";cc._RF.push(e,"364bfcoF/5Pp56POgp6gEoT","escape");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function s(t){try{a(i.next(t))}catch(e){r(e)}}function c(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}a((i=i.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var a,l,p=t("../../scripts/G"),h=t("../../scripts/Sound_Mgr"),u=t("./AStar"),d=t("./escape_pop"),f=t("./escape_role"),y=t("./escape_tip"),m=t("./follow"),g=cc._decorator,v=g.ccclass,_=g.property;(function(t){t[t.otherRole=0]="otherRole",t[t.selfRole=1]="selfRole",t[t.killer=2]="killer"})(a||(a={})),function(t){t[t.MAIN=0]="MAIN",t[t.RECORD=1]="RECORD",t[t.RANK=2]="RANK",t[t.RULE=3]="RULE"}(l||(l={}));var b=new Map([["end1",{ani:"door1",index:1,i18n:"escape_room1"}],["end2",{ani:"door2",index:2,i18n:"escape_room2"}],["end3",{ani:"door3",index:3,i18n:"escape_room3"}],["end4",{ani:"door4",index:4,i18n:"escape_room4"}],["end5",{ani:"door5",index:5,i18n:"escape_room5"}],["end6",{ani:"door6",index:6,i18n:"escape_room6"}],["end7",{ani:"door7",index:7,i18n:"escape_room7"}],["end8",{ani:"door8",index:8,i18n:"escape_room8"}]]),R=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mainLayer=null,e.content=null,e.gemLab=null,e.Map=null,e.mapLayer=null,e.roomLayer=null,e.rolePre=null,e.killerN=null,e.roleName=null,e.doorLayer=null,e.time=null,e.btn_back=null,e.warnTip=null,e.periodsLab=null,e.gameCoin=null,e.recordPre=null,e.rankPre=null,e.popPre=null,e.rulePre=null,e.content2=null,e.layer_road=null,e.object_initPos=null,e.object_doorFront=null,e.start_point_player=null,e.start_point_killer=null,e.end_point=null,e.map_point=new Map,e.size=null,e.player_node=null,e.player_point=new u.Point(0,0),e.isMoving=!1,e.isInRoom=!1,e.isKillerShow=!1,e.killerEnterRoom=0,e.waitingList=[],e.roomList=[],e.endTarget=["end1","end2","end3","end4","end5","end6","end7","end8"],e.rolePool=null,e.poolSize=60,e.curPeriod=0,e.round_RoomInvest=0,e.round_invest=0,e.round_get=0,e.initKillerPos=null,e.moveSpeed=.1,e.timeCountFun=null,e.reselectCount=1,e.lastSelectRoom="",e.isBacking=!1,e.isEnding=!1,e.betNumList=[100,1e3,1e4],e.accBet=0,e.curLayer=l.MAIN,e}return n(e,t),e.prototype.onLoad=function(){return s(this,void 0,void 0,function(){var t=this;return c(this,function(e){switch(e.label){case 0:return this.rolePool=new cc.NodePool,this.initPlayerPool(),this.readMap(),h.default.Inst.playMusic("escape_bgm"),[4,this.MSG_PlayerEnter()];case 1:return e.sent(),this.listenMsg(),cc.game.on(cc.game.EVENT_HIDE,function(){return s(t,void 0,void 0,function(){return c(this,function(){return cc.Tween.stopAll(),this.initKillState(),this.cancelListenMsg(),this.unscheduleAllCallbacks(),this.MSG_playerLeave(),this.collectRole(this.player_node),[2]})})}),cc.game.on(cc.game.EVENT_SHOW,function(){t.MSG_PlayerEnter(),t.listenMsg()}),[2]}})})},e.prototype.cancelListenMsg=function(){p.G.clientWs.unlistenMsgAll("Escape"),p.G.clientWs.unlistenMsgAll("Escapetime"),p.G.clientWs.unlistenMsgAll("Roominvest")},e.prototype.listenMsg=function(){var t,e,o;return s(this,void 0,void 0,function(){var i=this;return c(this,function(){return window.addEventListener("beforeunload",function(){i.MSG_playerLeave()}),null===(t=p.G.clientWs)||void 0===t||t.listenMsg("Escape",function(t){return s(i,void 0,void 0,function(){var e,o,i;return c(this,function(n){switch(n.label){case 0:e=0,o=t.waitlist.length,n.label=1;case 1:return e<o?(i=t.waitlist[e]._id,this.moveRole(i),[4,this.wait(.2*(e+1))]):[3,4];case 2:n.sent(),n.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}),null===(e=p.G.clientWs)||void 0===e||e.listenMsg("Escapetime",function(t){return s(i,void 0,void 0,function(){return c(this,function(){return this.showTimeCount(t.countdown),null==t.periods&&void 0!==t.killroomid&&(this.killerEnterRoom=t.killroomid,this.showKiller()),void 0!==t.periods&&(this.curPeriod=t.periods,this.periodsLab.string="Issue "+(t.periods+1),this.MSG_RoundResult()),[2]})})}),null===(o=p.G.clientWs)||void 0===o||o.listenMsg("Roominvest",function(t){return s(i,void 0,void 0,function(){return c(this,function(){return this.getRoomBetInfo(t.roomid,t.invest),[2]})})}),[2]})})},e.prototype.clearAllRoom=function(){var t=this;this.roomList.forEach(function(e){e.setPosition(t.getRandomPos(e,t.Map.node,"waiting")),t.waitingList.push(e)}),this.roomList=[]},e.prototype.showTimeCount=function(t){60==t&&(this.clearAllRoom(),this.MSG_RoundEnd(),this.clearRoomBetNum(),this.clearSelectedRoom(this.lastSelectRoom),this.player_node.setPosition(this.getRandomPos(this.player_node,this.Map.node,"waiting")),this.setDoorState(1),this.initRound()),t>0&&this.hideRoundResult(),this.isKillerShow||(this.time.parent.active=!0,this.time.getComponent(cc.Label).string=""+t,t<=10&&t>0&&h.default.Inst.play("time"),0==t&&(this.time.parent.active=!1))},e.prototype.initKillState=function(){this.isKillerShow&&(cc.Tween.stopAllByTarget(this.killerN),this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"daiji",!0),this.killerN.setPosition(this.initKillerPos),this.isKillerShow=!1)},e.prototype.setDoorState=function(t){var e=t>0?"Open the door 2":"Close the door 2";this.doorLayer.children.forEach(function(t){t.getComponent(sp.Skeleton).setAnimation(0,e,!0)})},e.prototype.MSG_playerLeave=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return[4,p.G.clientWs.callApi("ExitEscape",{playerId:p.G.uid})];case 1:return(t=e.sent()).isSucc?(1==t.res.result&&cc.log("leave success"),[2]):(cc.log(t.err),[2])}})})},e.prototype.MSG_PlayerEnter=function(){return s(this,void 0,void 0,function(){var t,e;return c(this,function(o){switch(o.label){case 0:return[4,p.G.clientWs.callApi("JoinEscape",{playerId:p.G.uid})];case 1:return(t=o.sent()).isSucc?(1==t.res.result&&(this.loadAccountInfo(t.res.gems),0==t.res.globalCountdown&&(this.time.parent.active=!1,this.isEnding=!0),this.initRoomBetInfo(t.res),this.setDoorState(t.res.globalCountdown),this.initGameState(),this.periodsLab.string="Issue "+t.res.period,this.initEscapeRoomState(t.res.robotlist),e=this.generateRole(a.selfRole),void 0!==t.res.roomid&&(this.isInRoom=!0,this.accBet=t.res.invest,this.showMyBet(this.endTarget[t.res.roomid-1],t.res.invest),this.lastSelectRoom=this.endTarget[t.res.roomid-1],e.getComponent(f.default).playAni("daiji",!0),e.setPosition(this.getRandomPos(e,this.roomLayer,this.endTarget[t.res.roomid-1])))),[2]):(cc.log(t.err),[2])}})})},e.prototype.initRoomBetInfo=function(t){for(var e=1;e<=8;e++){var o=t["roomid"+e];void 0!==o&&this.getRoomBetInfo(e,o)}},e.prototype.initGameState=function(){var t=this;this.waitingList.forEach(function(e){e.getComponent(f.default).leave(),t.collectRole(e)}),this.roomList.forEach(function(e){e.getComponent(f.default).leave(),t.collectRole(e)}),this.waitingList=[],this.roomList=[],this.clearSelectedRoom(),this.lastSelectRoom="",this.accBet=0,this.isInRoom=!1,this.isMoving=!1,this.isBacking=!1},e.prototype.MSG_PlayerSelectOrBet=function(t,e,o,i){return void 0===e&&(e="1"),void 0===o&&(o=0),void 0===i&&(i=""),s(this,void 0,void 0,function(){var n,r;return c(this,function(s){switch(s.label){case 0:return n={playerId:p.G.uid,type:e,roomid:b.get(t).index,invest:o},""!==i&&(n={playerId:p.G.uid,type:e,oldroomid:b.get(i).index,roomid:b.get(t).index,invest:o}),[4,p.G.clientWs.callApi("SelectInvest",n)];case 1:return(r=s.sent()).isSucc?(1==r.res.result&&cc.log("bet success"),[2]):(cc.log(r.err),[2])}})})},e.prototype.MSG_RoundResult=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return[4,p.G.clientWs.callApi("GetEscapeResult",{playerId:p.G.uid,periods:this.curPeriod})];case 1:return(t=e.sent()).isSucc?(1==t.res.result&&(this.loadAccountInfo(t.res.gems),this.round_RoomInvest=t.res.killroominvest,this.round_get=t.res.returns,this.round_invest=t.res.invest),[2]):(cc.log(t.err),[2])}})})},e.prototype.MSG_RoundEnd=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return[4,p.G.clientWs.callApi("PerEndEscape",{playerId:p.G.uid})];case 1:return(t=e.sent()).isSucc?(1==t.res.result&&this.refreshEscapeRoomState(t.res.robotlist),[2]):(cc.log(t.err),[2])}})})},e.prototype.refreshEscapeRoomState=function(t){return s(this,void 0,void 0,function(){var e,o,i,n,r;return c(this,function(){for(e=0,o=t.length;e<o;e++)1==(i=t[e]).online?-1==(n=this.getRole(i._id))?(r=this.generateRole(a.otherRole,i),this.setRoleRandomPos(r),this.waitingList.push(r)):(r=this.waitingList[n]).getComponent(f.default).setData(i):(n=this.getRole(i._id))>=0&&((r=this.waitingList[n]).getComponent(f.default).leave(),this.waitingList.splice(n,1),this.collectRole(r));return[2]})})},e.prototype.initEscapeRoomState=function(t){for(var e=0,o=t.length;e<o;e++){var i=t[e];if(1==i.online){var n=this.generateRole(a.otherRole,i);this.setRoleRandomPos(n,i.wait),n.getComponent(f.default).playAni("daiji",!0),1==i.wait?this.waitingList.push(n):this.roomList.push(n)}else{var r=this.getRole(i._id);r>=0&&((n=this.waitingList[r]).getComponent(f.default).leave(),this.waitingList.splice(r,1),this.collectRole(n))}}},e.prototype.initPlayerPool=function(){for(var t=0;t<this.poolSize;++t){var e=cc.instantiate(this.rolePre);this.rolePool.put(e)}},e.prototype.loadAccountInfo=function(t){this.gemLab.string=Myfun.transferNumToK(t),this.gameCoin.string=""},e.prototype.readMap=function(){this.layer_road=this.Map.getLayer("floor").getComponent(cc.TiledLayer);var t=this.Map.getLayer("wall").getComponent(cc.TiledLayer);this.object_initPos=this.Map.getObjectGroup("initPos"),this.object_doorFront=this.Map.getObjectGroup("doorFront"),this.size=this.Map.getMapSize(),this.start_point_player=this.getPoint(this.object_initPos,"start_player"),this.start_point_killer=this.getPoint(this.object_initPos,"start_killer"),this.initKillerPos=this.killerN.getPosition();for(var e=0;e<this.size.width;e++)for(var o=0;o<this.size.height;o++){var i=this.layer_road.getTiledTileAt(e,o,!0),n=t.getTiledTileAt(e,o,!0);if(0!==i.gid&&0===n.gid){var r=new u.Point(e,o);this.map_point.set(e+o*this.size.width,r)}}},e.prototype.getTilePos=function(t,e){var o=t/this.Map.getTileSize().width,i=(this.Map.node.getContentSize().height-e)/this.Map.getTileSize().height;return cc.v2(o,i)},e.prototype.getRandomPos=function(t,e,o,i){void 0===i&&(i=a.otherRole);var n,r,s=e.getChildByName(o).getBoundingBoxToWorld();n=Math.random()*(s.width-t.width)+s.x,r=Math.random()*(s.height-t.height)/2+s.y;var c=t.parent.convertToNodeSpaceAR(cc.v2(n,r));return cc.v3(c,0)},e.prototype.findWay=function(t,e,o,i,n){return void 0===n&&(n=!1),s(this,void 0,void 0,function(){var r,l,p,h=this;return c(this,function(){return r=u.default.getRoute(t,e,this.map_point,this.size),l=0,i===a.killer?o.getComponentInChildren(sp.Skeleton).setAnimation(0,"zou",!0):o.getComponent(f.default).playAni("zou",!0),(p=function(){return s(h,void 0,void 0,function(){var t,s,h,u=this;return c(this,function(c){switch(c.label){case 0:return l!=r.length?[3,4]:i===a.killer?[3,1]:(this.handlePlayerEnterRoom(n,o,e,i),[3,3]);case 1:return[4,this.handleKillerEnterRoom(e)];case 2:c.sent(),c.label=3;case 3:return[2];case 4:return l>0&&(t=r[l-1],s=r[l],this.setRoleDir(t,s,o)),h=r[l++],cc.tween(o).to(this.moveSpeed,{position:this.layer_road.getTiledTileAt(h.x,h.y,!1).node.position}).call(function(){i==a.selfRole&&(u.player_point.x=h.x,u.player_point.y=h.y),i==a.otherRole&&(o.zIndex=-o.y),p()}).start(),[2]}})})})(),i==a.selfRole&&(this.isMoving=!0,this.isBacking=n),[2]})})},e.prototype.calculateDis=function(t,e){var o=e.x-t.x,i=e.y-t.y;return Math.sqrt(o*o+i*i)},e.prototype.setRoleDir=function(t,e,o){e.x<t.x?o.children[1].scaleX=-.5:e.x>t.x&&(o.children[1].scaleX=.5)},e.prototype.handlePlayerEnterRoom=function(t,e,o,i){var n=this;if(t)r=this.getRandomPos(e,this.Map.node,"waiting"),s=this.calculateDis(e.position,r),cc.tween(e).to(this.moveSpeed*s/30,{position:this.getRandomPos(e,this.Map.node,"waiting")}).call(function(){i==a.otherRole&&(e.zIndex=-e.y),e.getComponent(f.default).playAni("daiji",!0),i==a.selfRole&&(n.isBacking=!1)}).start();else{i==a.selfRole&&(this.isMoving=!1,this.isInRoom=!0);var r=this.getRandomPos(e,this.roomLayer,o.targetName,i),s=this.calculateDis(e.position,r);cc.tween(e).to(this.moveSpeed*s/30,{position:r}).call(function(){i==a.otherRole&&(e.zIndex=-e.y),e.getComponent(f.default).playAni("daiji",!0)}).start()}},e.prototype.showMyBet=function(t,e){""!==this.lastSelectRoom&&(this.roomLayer.getChildByName(this.lastSelectRoom).children[3].active=!1),this.roomLayer.getChildByName(t).children[0].active=!0;var o=this.roomLayer.getChildByName(t).children[3];o.active=!0,o.children[1].getComponent(cc.Label).string=Myfun.transferNumToK(e)},e.prototype.handleKillerEnterRoom=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(o){switch(o.label){case 0:return e=this.getPoint(this.object_initPos,t.targetName,!0),t.x!=e.x||t.y!=e.y?[3,5]:(this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"daiji",!0),[4,this.playDoorAni(t.targetName,!1)]);case 1:return o.sent(),this.playKillerAni(),[4,this.clearRoom(t.targetName)];case 2:return o.sent(),this.checkRoundResult(),[4,this.playAllDoorAni()];case 3:return o.sent(),[4,this.allBackToWait()];case 4:return o.sent(),this.roundEnd(),[3,7];case 5:return this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"daiji",!0),[4,this.playDoorAni(t.targetName)];case 6:o.sent(),this.findWay(t,e,this.killerN,a.killer),o.label=7;case 7:return[2]}})})},e.prototype.playKillerAni=function(){return s(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return h.default.Inst.play("escape_kill1"),this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"gongji",!1),[4,this.wait(.5)];case 1:return t.sent(),this.killerN.getComponentInChildren(sp.Skeleton).setAnimation(0,"daiji",!0),this.killerN.setPosition(this.initKillerPos),[2]}})})},e.prototype.roleBeKilledAni=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return t.getComponent(f.default).beKilledAni(this.killerN.children[1].scaleX),[4,this.wait(.2)];case 1:return e.sent(),[2]}})})},e.prototype.clearRoom=function(t){return s(this,void 0,void 0,function(){var e,o,i,n=this;return c(this,function(r){switch(r.label){case 0:return[4,this.wait(.2)];case 1:return r.sent(),[4,Promise.all(this.roomList.map(function(e){return s(n,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return e.getComponent(f.default).getTarget()!=b.get(t).index?[3,2]:[4,this.roleBeKilledAni(e)];case 1:o.sent(),o.label=2;case 2:return[2]}})})}))];case 2:return r.sent(),t!==this.lastSelectRoom?[3,4]:[4,this.roleBeKilledAni(this.player_node)];case 3:r.sent(),r.label=4;case 4:return[4,this.wait(1)];case 5:for(r.sent(),this.clearRoomBetNum(),e=0,o=this.roomList.length;e<o;e++)(i=this.roomList[e]).getComponent(f.default).getTarget()==b.get(t).index&&(i.angle=0,i.getComponent(f.default).playAni("daiji",!0),i.setPosition(this.getRandomPos(i,this.Map.node,"waiting")),this.waitingList.push(i));return t===this.lastSelectRoom&&(this.player_node.getComponent(f.default).playAni("daiji",!0),this.player_node.setPosition(this.getRandomPos(this.player_node,this.Map.node,"waiting"))),this.roomList=this.roomList.filter(function(e){return e.getComponent(f.default).getTarget()!==b.get(t).index}),[4,this.wait(.1)];case 6:return r.sent(),[2]}})})},e.prototype.checkRoundResult=function(){return s(this,void 0,void 0,function(){return c(this,function(){return this.isInRoom?this.accBet>0?this.endTarget[this.killerEnterRoom-1]===this.lastSelectRoom?this.showPop_fail1(this.endTarget[this.killerEnterRoom-1]):this.showPop_suc2(this.round_invest,this.round_get):this.endTarget[this.killerEnterRoom-1]===this.lastSelectRoom?this.showPop_fail2(this.endTarget[this.killerEnterRoom-1]):this.showPop_suc1():this.showPop_fail2(this.endTarget[this.killerEnterRoom-1]),[2]})})},e.prototype.hideRoundResult=function(){var t=cc.find("escape_result",this.content);null==t||t.destroy()},e.prototype.clearRoomBetNum=function(){for(var t=1;t<9;t++){var e="end"+t,o=this.roomLayer.getChildByName(e);o.children[2].getComponentInChildren(cc.Label).string="0",o.children[3].active=!1,o.children[3].getComponentInChildren(cc.Label).string="0"}},e.prototype.roundEnd=function(){this.clearSelectedRoom(this.lastSelectRoom)},e.prototype.initRound=function(){this.round_RoomInvest=0,this.round_get=0,this.round_invest=0,this.isInRoom=!1,this.isEnding=!1,this.isMoving=!1,this.reselectCount=1,this.lastSelectRoom="",this.isBacking=!1,this.isKillerShow=!1,this.accBet=0},e.prototype.showTime=function(t){var e=this;this.unschedule(this.timeCountFun),this.time.parent.active=!0,this.time.getComponent(cc.Label).string=""+t,t--,this.schedule(this.timeCountFun=function(){t>0?(e.time.getComponent(cc.Label).string=""+t,--t<=10&&h.default.Inst.play("time")):(e.unschedule(e.timeCountFun),e.time.parent.active=!1,e.showKiller())},1)},e.prototype.allBackToWait=function(){return s(this,void 0,void 0,function(){var t,e,o=this;return c(this,function(i){switch(i.label){case 0:return t=this.lastSelectRoom,e=this.killerEnterRoom,[4,Promise.all(this.roomList.map(function(t,e){return s(o,void 0,void 0,function(){var o,i;return c(this,function(n){switch(n.label){case 0:return o=t.getComponent(f.default).getTarget(),i=this.getPoint(this.object_initPos,this.endTarget[o-1]),[4,this.wait(.1*e)];case 1:return n.sent(),this.findWay(i,this.start_point_player,t,a.otherRole,!0),this.waitingList.push(t),[2]}})})}))];case 1:return i.sent(),[4,s(o,void 0,void 0,function(){var o;return c(this,function(i){switch(i.label){case 0:return""===t||t===this.endTarget[e-1]?[3,2]:(o=this.getPoint(this.object_initPos,t),this.findWay(o,this.start_point_player,this.player_node,a.selfRole,!0),[4,this.wait(.1)]);case 1:i.sent(),i.label=2;case 2:return[2]}})})];case 2:return i.sent(),this.roomList=[],[4,this.wait(2)];case 3:return i.sent(),[2]}})})},e.prototype.clearSelectedRoom=function(t){""==t||null==t?this.roomLayer.children.forEach(function(t){t.children[0].active=!1,t.children[3].active=!1}):(this.roomLayer.getChildByName(t).children[0].active=!1,this.roomLayer.getChildByName(t).children[3].active=!1)},e.prototype.setEndPos=function(t){if(!(this.isKillerShow||this.isBacking||this.isEnding)){var e=t.target.name;if(e!=this.lastSelectRoom){this.clearSelectedRoom(this.lastSelectRoom);var o=this.getPoint(this.object_initPos,e,!0);o.targetName=e,this.end_point=o,this.showMyBet(e,this.accBet),this.isMoving?this.handleMovingEndPos(e):this.isInRoom?this.handleInRoomEndPos(e):this.handleNormalEndPos(e),this.lastSelectRoom=e}}},e.prototype.handleMovingEndPos=function(t){cc.Tween.stopAllByTarget(this.player_node),this.reselectCount--,this.MSG_PlayerSelectOrBet(t,"1",this.accBet,this.lastSelectRoom),this.findWay(this.player_point,this.end_point,this.player_node,a.selfRole)},e.prototype.handleInRoomEndPos=function(t){this.reselectCount--;var e=this.getRandomPos(this.player_node,this.roomLayer,this.end_point.targetName,a.selfRole);this.player_node.setPosition(e),this.player_node.getComponent(f.default).playTransferAni(),this.MSG_PlayerSelectOrBet(t,"1",this.accBet,this.lastSelectRoom)},e.prototype.handleNormalEndPos=function(t){null!==this.player_node&&(this.MSG_PlayerSelectOrBet(t),this.findWay(this.start_point_player,this.end_point,this.player_node,a.selfRole))},e.prototype.getPoint=function(t,e,o){var i=t.getObject(e);if(i){var n=this.getTilePos(i.x,i.y),r=new u.Point(n.x,n.y);return o&&(r.targetName=e),r}},e.prototype.generateRole=function(t,e){var o;return void 0===t&&(t=a.otherRole),(o=this.rolePool.size()>0?this.rolePool.get():cc.instantiate(this.rolePre)).parent=this.mapLayer,t===a.selfRole?this.setupSelfRole(o):this.setupOtherRole(o,e),o},e.prototype.collectRole=function(t){this.rolePool.put(t)},e.prototype.setupSelfRole=function(t){t.zIndex=1e4,this.player_node=t,this.player_node.getComponent(f.default).setSkin("huang"),t.children[2].active=!0,t.setPosition(this.getRandomPos(t,this.Map.node,"waiting"))},e.prototype.setRoleRandomPos=function(t,e){return void 0===e&&(e=1),s(this,void 0,void 0,function(){var o;return c(this,function(){return 1==e?t.setPosition(this.getRandomPos(t,this.Map.node,"waiting")):(o=t.getComponent(f.default).getTarget(),t.setPosition(this.getRandomPos(t,this.roomLayer,this.endTarget[o-1]))),t.zIndex=-t.y,[2]})})},e.prototype.setupOtherRole=function(t,e){return s(this,void 0,void 0,function(){var o;return c(this,function(i){switch(i.label){case 0:return o=cc.instantiate(this.roleName),t.getComponent(f.default).setData(e,o),[4,this.wait(.2)];case 1:return i.sent(),o.parent=this.roleName.parent,o.active=!0,o.getComponent(cc.Label).string=Myfun.maskString(e.name),o.getComponent(m.default).targetNode=t,[2]}})})},e.prototype.getRole=function(t){return this.waitingList.findIndex(function(e){return e.getComponent(f.default).getRoleId()==t})},e.prototype.getRoomBetInfo=function(t,e){var o="end"+t,i=this.roomLayer.getChildByName(o).children[2].getComponentInChildren(cc.Label),n=Number(i.string);Myfun.jumpNumberAsync(n,e,.2,i)},e.prototype.moveRole=function(t){var e=this.getRole(t);if(e<0)cc.warn("not found role");else{var o=this.waitingList[e],i=o.getComponent(f.default).getTarget(),n=this.getPoint(this.object_initPos,this.endTarget[i-1],!0);this.findWay(this.start_point_player,n,o,a.otherRole),this.roomList.push(o),this.waitingList.splice(e,1)}},e.prototype.playDoorAni=function(t,e){return void 0===e&&(e=!0),s(this,void 0,void 0,function(){var o,i;return c(this,function(n){switch(n.label){case 0:return o=e?"Open the door":"Close the door",i=b.get(t).ani,this.doorLayer.getChildByName(i).getComponent(sp.Skeleton).setAnimation(0,o,!1),[4,this.wait(.63)];case 1:return n.sent(),[2]}})})},e.prototype.playAllDoorAni=function(t){return void 0===t&&(t=!0),s(this,void 0,void 0,function(){var e,o,i;return c(this,function(n){switch(n.label){case 0:for(e=t?"Open the door":"Close the door",o=0,i=this.doorLayer.childrenCount;o<i;o++)this.doorLayer.children[o].getComponent(sp.Skeleton).setAnimation(0,e,!1);return[4,this.wait(.63)];case 1:return n.sent(),[2]}})})},e.prototype.showKiller=function(){return s(this,void 0,void 0,function(){var t,e;return c(this,function(o){switch(o.label){case 0:return this.isKillerShow?[2]:(this.isKillerShow=!0,[4,this.showPop_killer()]);case 1:return o.sent(),[4,this.playAllDoorAni(!1)];case 2:return o.sent(),this.killerEnterRoom>0&&this.killerEnterRoom<=8?t=this.endTarget[this.killerEnterRoom-1]:(t=Myfun.getRandomItemFromArr(this.endTarget),this.killerEnterRoom=b.get(t).index),e=this.getPoint(this.object_doorFront,t,!0),this.findWay(this.start_point_killer,e,this.killerN,a.killer),[2]}})})},e.prototype.showPop_killer=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return(t=cc.instantiate(this.popPre)).parent=this.content,t.getComponent(d.default).showKillerTip(),[4,this.wait(2)];case 1:return e.sent(),[2]}})})},e.prototype.showPop_suc1=function(){return s(this,void 0,void 0,function(){var t;return c(this,function(){return(t=cc.instantiate(this.popPre)).parent=this.content,t.getComponent(d.default).showSuc1(this.round_RoomInvest),[2]})})},e.prototype.showPop_suc2=function(t,e){return s(this,void 0,void 0,function(){var o;return c(this,function(){return(o=cc.instantiate(this.popPre)).parent=this.content,o.getComponent(d.default).showSuc2(t,e),[2]})})},e.prototype.showPop_fail1=function(t){return s(this,void 0,void 0,function(){var e,o;return c(this,function(){return(e=cc.instantiate(this.popPre)).parent=this.content,o=b.get(t).i18n,e.getComponent(d.default).showFail1(o),[2]})})},e.prototype.showPop_fail2=function(t){return s(this,void 0,void 0,function(){var e,o;return c(this,function(){return(e=cc.instantiate(this.popPre)).parent=this.content,o=b.get(t).i18n,e.getComponent(d.default).showFail2(o,this.round_RoomInvest),[2]})})},e.prototype.wait=function(t){var e=this;return new Promise(function(o){e.scheduleOnce(function(){o()},t)})},e.prototype.btnBetSureClicked=function(t,e){if(h.default.Inst.play("escape_btn"),!this.isKillerShow)if(this.isInRoom||this.isMoving){var o=this.betNumList[Number(e)];this.MSG_PlayerSelectOrBet(this.lastSelectRoom,"2",o),this.accBet=Myfun.sumFloat(this.accBet,o),this.showMyBet(this.lastSelectRoom,this.accBet)}else this.showWarning("escape_tip1")},e.prototype.checkGem=function(){return!0},e.prototype.showWarning=function(t){var e=cc.instantiate(this.warnTip);e.parent=this.node,e.getComponent(y.default).showTip(t)},e.prototype.btnRecordClicked=function(){h.default.Inst.play("escape_btn"),this.btn_back.active=!0,cc.instantiate(this.recordPre).parent=this.content2,this.mainLayer.opacity=0,this.curLayer=l.RECORD},e.prototype.btnRankCLicked=function(){h.default.Inst.play("escape_btn"),this.btn_back.active=!0,cc.instantiate(this.rankPre).parent=this.content2,this.mainLayer.opacity=0,this.curLayer=l.RANK},e.prototype.btnRuleClicked=function(){h.default.Inst.play("escape_btn"),this.btn_back.active=!0,cc.instantiate(this.rulePre).parent=this.content2,this.mainLayer.opacity=0,this.curLayer=l.RULE},e.prototype.btnCloseClicked=function(){return s(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:return this.curLayer!=l.MAIN?[3,2]:(this.cancelListenMsg(),[4,this.MSG_playerLeave()]);case 1:return t.sent(),cc.director.loadScene("start"),[3,3];case 2:this.btn_back.active=!1,this.curLayer=l.MAIN,this.mainLayer.opacity=255,this.content2.removeAllChildren(),t.label=3;case 3:return[2]}})})},r([_(cc.Node)],e.prototype,"mainLayer",void 0),r([_(cc.Node)],e.prototype,"content",void 0),r([_(cc.Label)],e.prototype,"gemLab",void 0),r([_(cc.TiledMap)],e.prototype,"Map",void 0),r([_(cc.Node)],e.prototype,"mapLayer",void 0),r([_(cc.Node)],e.prototype,"roomLayer",void 0),r([_(cc.Prefab)],e.prototype,"rolePre",void 0),r([_(cc.Node)],e.prototype,"killerN",void 0),r([_(cc.Node)],e.prototype,"roleName",void 0),r([_(cc.Node)],e.prototype,"doorLayer",void 0),r([_(cc.Node)],e.prototype,"time",void 0),r([_(cc.Node)],e.prototype,"btn_back",void 0),r([_(cc.Prefab)],e.prototype,"warnTip",void 0),r([_(cc.Label)],e.prototype,"periodsLab",void 0),r([_(cc.Label)],e.prototype,"gameCoin",void 0),r([_(cc.Prefab)],e.prototype,"recordPre",void 0),r([_(cc.Prefab)],e.prototype,"rankPre",void 0),r([_(cc.Prefab)],e.prototype,"popPre",void 0),r([_(cc.Prefab)],e.prototype,"rulePre",void 0),r([_(cc.Node)],e.prototype,"content2",void 0),r([v],e)}(cc.Component);o.default=R,cc._RF.pop()},{"../../scripts/G":void 0,"../../scripts/Sound_Mgr":void 0,"./AStar":"AStar","./escape_pop":"escape_pop","./escape_role":"escape_role","./escape_tip":"escape_tip","./follow":"follow"}],follow:[function(t,e,o){"use strict";cc._RF.push(e,"7f861vruK9E9Lw4RlUBxitS","follow");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetNode=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.setData=function(){},e.prototype.update=function(){this.node.active&&(this.node.x=this.targetNode.x+this.targetNode.width/2,this.node.y=this.targetNode.y+this.targetNode.height+10)},r([c],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],item_record:[function(t,e,o){"use strict";cc._RF.push(e,"66b8e1nCGJL8rvO2kD7mdHL","item_record");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../../core_lmn/core"),c=cc._decorator,a=c.ccclass,l=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.issueLab=null,e.timeLab=null,e.resultLab=null,e.betRoom=null,e.killRoom=null,e.investLab=null,e.getLab=null,e}return n(e,t),e.prototype.start=function(){},e.prototype.setData=function(t){this.issueLab.string="Issue "+t.periods,this.timeLab.string="",this.resultLab.getComponent(s.i18nLabel).init("",[]),this.betRoom.getComponent(s.i18nLabel).init("",[]),this.killRoom.getComponent(s.i18nLabel).init("",[]),this.investLab.string="0",this.getLab.string="0"},r([l(cc.Label)],e.prototype,"issueLab",void 0),r([l(cc.Label)],e.prototype,"timeLab",void 0),r([l(cc.Node)],e.prototype,"resultLab",void 0),r([l(cc.Node)],e.prototype,"betRoom",void 0),r([l(cc.Node)],e.prototype,"killRoom",void 0),r([l(cc.Label)],e.prototype,"investLab",void 0),r([l(cc.Label)],e.prototype,"getLab",void 0),r([a],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../core_lmn/core":void 0}]},{},["AStar","escape","escape_pop","escape_rank","escape_record","escape_role","escape_tip","follow","item_record"]);