window.__require=function t(o,e,n){function i(s,l){if(!e[s]){if(!o[s]){var a=s.split("/");if(a=a[a.length-1],!o[a]){var c="function"==typeof __require&&__require;if(!l&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var u=e[s]={exports:{}};o[s][0].call(u.exports,function(t){return i(o[s][1][t]||t)},u,u.exports,t,o,e,n)}return e[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({ani_slot:[function(t,o,e){"use strict";cc._RF.push(o,"33560GeaDNLZ4EcHe3x3CkN","ani_slot");var n,i=this&&this.__extends||(n=function(t,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}n(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),r=this&&this.__decorate||function(t,o,e,n){var i,r=arguments.length,s=r<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,o,e,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(s=(r<3?i(s):r>3?i(o,e,s):i(o,e))||s);return r>3&&s&&Object.defineProperty(o,e,s),s};Object.defineProperty(e,"__esModule",{value:!0});var s=t("../../scripts/G"),l=cc._decorator,a=l.ccclass,c=l.property,u=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.goldSke=null,o.diamondSke=null,o}return i(o,t),o.prototype.start=function(){},o.prototype.playAni=function(t){var o=this;void 0===t&&(t=0),this.goldSke.node.active=this.diamondSke.node.active=!1,0==t?(this.goldSke.node.active=!0,this.goldSke.setAnimation(0,"animation",!1)):(this.diamondSke.node.active=!0,this.diamondSke.setAnimation(0,"animation",!1)),this.scheduleOnce(function(){s.G.PoolManager.putNode(o.node)},2)},r([c(sp.Skeleton)],o.prototype,"goldSke",void 0),r([c(sp.Skeleton)],o.prototype,"diamondSke",void 0),r([a],o)}(cc.Component);e.default=u,cc._RF.pop()},{"../../scripts/G":void 0}],item_slot:[function(t,o,e){"use strict";cc._RF.push(o,"478bffWEspGk6MjfHScnScM","item_slot");var n,i=this&&this.__extends||(n=function(t,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}n(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),r=this&&this.__decorate||function(t,o,e,n){var i,r=arguments.length,s=r<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,o,e,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(s=(r<3?i(s):r>3?i(o,e,s):i(o,e))||s);return r>3&&s&&Object.defineProperty(o,e,s),s};Object.defineProperty(e,"__esModule",{value:!0});var s=cc._decorator,l=s.ccclass,a=s.property,c=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.itemSpr=null,o.sfList=[],o.itemRollingSp=null,o.rollingSFList=[],o.staticFlag=null,o.movingFlag=null,o.parentNamePool=["layout1","layout2","layout3"],o.curParentName="",o}return i(o,t),o.prototype.onEnable=function(){},o.prototype.setSprite=function(t,o){var e=this;this.itemSpr.spriteFrame=this.sfList[t-1],this.itemRollingSp.spriteFrame=this.rollingSFList[t-1],this.curParentName=o,cc.director.once(o+"isRolling",function(){e.rollingFlag(!0)}),cc.director.once(o+"isEnd",function(){e.rollingFlag(!1)})},o.prototype.rollingFlag=function(t){this.movingFlag.active=t,this.staticFlag.active=!t},o.prototype.onDisable=function(){cc.director.off(this.curParentName+"isRolling"),cc.director.off(this.curParentName+"isEnd")},o.prototype.onDestroy=function(){cc.director.off(this.curParentName+"isRolling"),cc.director.off(this.curParentName+"isEnd")},r([a(cc.Sprite)],o.prototype,"itemSpr",void 0),r([a(cc.SpriteFrame)],o.prototype,"sfList",void 0),r([a(cc.Sprite)],o.prototype,"itemRollingSp",void 0),r([a(cc.SpriteFrame)],o.prototype,"rollingSFList",void 0),r([a(cc.Node)],o.prototype,"staticFlag",void 0),r([a(cc.Node)],o.prototype,"movingFlag",void 0),r([l],o)}(cc.Component);e.default=c,cc._RF.pop()},{}],slotMachine:[function(t,o,e){"use strict";cc._RF.push(o,"5fd2cjiwUtK558FFVgXEMOX","slotMachine");var n,i=this&&this.__extends||(n=function(t,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}n(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),r=this&&this.__decorate||function(t,o,e,n){var i,r=arguments.length,s=r<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,o,e,n);else for(var l=t.length-1;l>=0;l--)(i=t[l])&&(s=(r<3?i(s):r>3?i(o,e,s):i(o,e))||s);return r>3&&s&&Object.defineProperty(o,e,s),s},s=this&&this.__awaiter||function(t,o,e,n){return new(e||(e=Promise))(function(i,r){function s(t){try{a(n.next(t))}catch(o){r(o)}}function l(t){try{a(n.throw(t))}catch(o){r(o)}}function a(t){var o;t.done?i(t.value):(o=t.value,o instanceof e?o:new e(function(t){t(o)})).then(s,l)}a((n=n.apply(t,o||[])).next())})},l=this&&this.__generator||function(t,o){var e,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(t){return function(o){return a([t,o])}}function a(r){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=o.call(t,s)}catch(l){r=[6,l],n=0}finally{e=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0});var a,c,u=t("../../core_lmn/core"),p=t("../../module_basic/script/popup/popBase"),d=t("../../scripts/G"),h=t("../../scripts/Sound_Mgr"),f=t("./ani_slot"),y=t("./item_slot"),m=cc._decorator,g=m.ccclass,G=m.property;(function(t){t[t.NORMAL=0]="NORMAL",t[t.BONUS=1]="BONUS",t[t.JACKPOT=2]="JACKPOT"})(a||(a={})),function(t){t[t.FREE=0]="FREE",t[t.PAYMENT=1]="PAYMENT"}(c||(c={}));var I=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.item=null,o.itemSpritePathArray=["apple","orange","banana","watermelon","rabbit","chicken","cattle","bonus","jackpot"],o.goldLayer=null,o.windowLayout1=null,o.windowLayout2=null,o.windowLayout3=null,o.startBtn=null,o.btnSF=[],o.slotGold=null,o.btnTimesLab=null,o.progressBar=null,o.ProgressLab=null,o.curTimesLab=null,o.btn_gold=null,o.btn_diamond=null,o.goldLab=null,o.diamondLab=null,o.slotcoinLab=null,o.num1=20,o.num2=40,o.num3=60,o.costGold=100,o.costCoin=1,o.diamondToCoin=100,o.initialGold=0,o.initialDiamond=0,o.playMode=c.FREE,o.pressTimeThreshold=1.5,o.isLongPress=!1,o.longPressFun=null,o.curTimes=1,o.timesArr=[1,3,5,15],o.timesIndex=0,o.nonWinList=[],o.winWeights=[],o.curCostDiamond=0,o.resultArr=[0,0,0],o.curResult=null,o.isFirstRoll=!0,o.isRolling=!1,o.rollingTime=1,o.canStop=!1,o.isAutoRun=!1,o.rollingAudioId=0,o.speedTime=1,o}return i(o,t),o.prototype.onLoad=function(){this.startBtn.node.on(cc.Node.EventType.TOUCH_START,this._onTouchStart,this),this.startBtn.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnd,this),this.startBtn.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchEnd,this)},o.prototype._onTouchStart=function(){var t=this;this.isLongPress=!1,this.startBtn.node.getComponent(cc.Sprite).spriteFrame=this.btnSF[1],this.scheduleOnce(this.longPressFun=function(){t.isLongPress=!0,t.isAutoRun||(t.isAutoRun=!0,t.isRolling||t.onHandleClicked())},this.pressTimeThreshold)},o.prototype._onTouchEnd=function(){cc.log(this.isLongPress),this.isLongPress||(this.startBtn.node.getComponent(cc.Sprite).spriteFrame=this.btnSF[0],this.isAutoRun?this.isAutoRun=!1:this.onHandleClicked()),this.unschedule(this.longPressFun),this.isLongPress=!1},o.prototype.start=function(){var t=this;this.windowLayout1.active=!1,this.windowLayout2.active=!1,this.windowLayout3.active=!1,h.default.Inst.playMusic("bgm_slot"),this._initData(),this.getInitialGold(),this.loadUI(),this.loadAccountInfo(),this._setWindowLayoutContent(),this.startBtn.node.active=!1,this.scheduleOnce(function(){t.startBtn.node.active=!0},.1)},o.prototype.onEnable=function(){var o=this;t.prototype.onEnable.call(this),cc.director.on("SlotFreeAdd",function(){o.updateCurFreeTimeShow()})},o.prototype.onDisable=function(){t.prototype.onDisable.call(this),cc.director.off("SlotFreeAdd"),this.unscheduleAllCallbacks()},o.prototype.updateCurFreeTimeShow=function(){this.playMode==c.FREE?(this.progressBar.progress=d.G.player.slotInfoFree.curPlayFreeTimes/50,this.ProgressLab.string=d.G.player.slotInfoFree.curPlayFreeTimes+"/50",this.curTimesLab.node.getComponent(u.i18nLabel).init("static_slot_freePlay",[d.G.player.slotInfoFree.curPlayFreeTimes.toString()])):(this.progressBar.progress=d.G.player.slotInfoPayment.curPlayFreeTimes/50,this.ProgressLab.string=d.G.player.slotInfoPayment.curPlayFreeTimes+"/50",this.curTimesLab.node.getComponent(u.i18nLabel).init("static_slot_freePlay",[d.G.player.slotInfoFree.curPlayFreeTimes.toString()]))},o.prototype.checkCoins=function(){return this.playMode==c.FREE?d.G.player.slotInfoFree.curPlayFreeTimes>0||d.G.player.accountCoinInfo.gold>=this.costGold*this.curTimes:d.G.player.slotInfoPayment.curPlayFreeTimes>0||d.G.player.accountCoinInfo.diamond>=this.diamondToCoin*this.costCoin*this.curTimes},o.prototype.getInitialGold=function(){this.initialGold=d.G.player.accountCoinInfo.gold,this.initialDiamond=d.G.player.accountCoinInfo.slotCoin*this.diamondToCoin+d.G.player.accountCoinInfo.diamond,0==d.G.player.slotInfoFree.curWinRate&&(d.G.player.slotInfoFree.curWinRate=d.G.gameJson.slotConfig[1].normalRate,d.G.player.slotInfoPayment.curWinRate=d.G.gameJson.slotConfig[1].normalRate)},o.prototype.loadUI=function(){this.btn_gold.active=this.playMode==c.FREE,this.btn_diamond.active=this.playMode==c.PAYMENT,this._updatePrizePool()},o.prototype.loadAccountInfo=function(){this.goldLab.string=Myfun.transferNumToK(d.G.player.accountCoinInfo.gold),this.diamondLab.string=Myfun.transferNumToK(d.G.player.accountCoinInfo.diamond),this.slotcoinLab.string=d.G.player.accountCoinInfo.slotCoin.toString(),this.updateCurFreeTimeShow()},o.prototype.btn_goldClicked=function(){this.isRolling?d.G.eventMsg.emit(MI.MSG.confirm,"static_confirm9"):(this.playMode=c.PAYMENT,this.loadAccountInfo(),this.loadUI())},o.prototype.btn_diamondClicked=function(){this.isRolling?d.G.eventMsg.emit(MI.MSG.confirm,"static_confirm9"):(this.playMode=c.FREE,this.loadAccountInfo(),this.loadUI())},o.prototype.btn_timesClicked=function(){this.timesIndex++,this.timesIndex>=this.timesArr.length&&(this.timesIndex=0),this.curTimes=this.timesArr[this.timesIndex],this.btnTimesLab.string=this.curTimes.toString()},o.prototype.test=function(){this.isFirstRoll=!1,this.playMode==c.FREE?(d.G.player.accountCoinInfo.gold=1e4,this.initialGold=1e4,d.G.player.slotInfoFree.SlotMode=MI.slotMode.NORMAL):(d.G.player.accountCoinInfo.diamond=1e4,d.G.player.accountCoinInfo.slotCoin=1e3,this.initialDiamond=d.G.player.accountCoinInfo.diamond+d.G.player.accountCoinInfo.slotCoin*this.diamondToCoin,d.G.player.slotInfoPayment.SlotMode=MI.slotMode.NORMAL);for(var t=0,o=0,e=0;e<1e3&&this.checkCoins();e++)this.curResult=this._checkISWin(),this.curResult.isWin&&t++,this._doCost(),this._getReward(),o++;this.playMode==c.FREE?cc.log("\u73a9\u7684\u6b21\u6570\uff1a",o,"\u8d62\u6b21\u6570\uff1a",t,"\n\u8d77\u59cb\u91d1\u5e01\uff1a",1e4,"\u7ed3\u4f59\u91d1\u5e01: ",d.G.player.accountCoinInfo.gold):cc.log("\u73a9\u7684\u6b21\u6570\uff1a",o,"\u8d62\u6b21\u6570\uff1a",t,"\n\u8d77\u59cb\u94bb\u77f3\uff1a",1e4,"\u8d77\u59cb\u62c9\u9738\u5e01\uff1a",1e3,"\u7ed3\u4f59\u94bb\u77f3: ",d.G.player.accountCoinInfo.diamond)},o.prototype._doCost=function(){return s(this,void 0,void 0,function(){return l(this,function(){return this.playMode==c.FREE?d.G.player.slotInfoFree.curPlayFreeTimes>0?d.G.player.slotInfoFree.curPlayFreeTimes--:(d.G.player.accountCoinInfo.gold-=this.costGold*this.curTimes,d.G.player.slotInfoFree.curAccCost+=this.costGold*this.curTimes):d.G.player.slotInfoPayment.curPlayFreeTimes>0?d.G.player.slotInfoPayment.curPlayFreeTimes--:(d.G.player.accountCoinInfo.diamond=Myfun.diffFloat(d.G.player.accountCoinInfo.diamond,this.costCoin*this.diamondToCoin*this.curTimes),d.G.player.slotInfoPayment.curAccCost+=this.costCoin*this.diamondToCoin*this.curTimes),this.loadAccountInfo(),[2]})})},o.prototype._getReward=function(){if(this.curResult.prizeType==a.NORMAL&&this.curResult.isWin){var t=d.G.PoolManager.getNode(this.slotGold,this.node);if(h.default.Inst.play("reward"),this.playMode==c.FREE){var o=Math.round(this.curTimes*this.costGold*(1+d.G.gameJson.slotConfig[1].winCombination[this.curResult.prizeIndex].reward));d.G.player.accountCoinInfo.gold+=o,cc.log("\u83b7\u5f97\u91d1\u5e01",o,"\u5f53\u524d\u91d1\u5e01",d.G.player.accountCoinInfo.gold),t.getComponent(f.default).playAni(0),d.G.player.slotInfoFree.curAccReward+=o}else o=Math.round(this.curTimes*this.costCoin*this.diamondToCoin*(1+d.G.gameJson.slotConfig[1].winCombination[this.curResult.prizeIndex].reward)),d.G.player.accountCoinInfo.diamond+=o,cc.log("\u83b7\u5f97\u94bb\u77f3",o,"\u5f53\u524d\u94bb\u77f3",d.G.player.accountCoinInfo.diamond),t.getComponent(f.default).playAni(1),d.G.player.slotInfoPayment.curAccReward+=o}else if(this.curResult.prizeType==a.JACKPOT)if(h.default.Inst.play("jackpot"),this.playMode==c.FREE){var e=parseInt(this.curResult.ratioValue*d.G.player.slotInfoFree.curPrizePoolNum+"");d.G.player.accountCoinInfo.gold+=e,d.G.player.slotInfoFree.curAccReward+=e}else e=parseInt(this.curResult.ratioValue*d.G.player.slotInfoPayment.curPrizePoolNum+""),d.G.player.accountCoinInfo.diamond+=e,d.G.player.slotInfoPayment.curAccReward+=e;else this.curResult.prizeType==a.BONUS&&(h.default.Inst.play("bonus"),this.playMode,c.FREE,d.G.player.slotInfoPayment.curPlayFreeTimes+=this.curResult.freeCount);this.loadAccountInfo()},o.prototype._initData=function(){for(var t=d.G.gameJson.slotConfig[1].winCombination,o=[],e=1;e<=7;e++)for(var n=1;n<=7;n++)for(var i=1;i<=7;i++){for(var r=[e,n,i],s=!1,l=0,a=t;l<a.length;l++){var c=a[l];if(r.sort().toString()===c.result.sort().toString()){s=!0;break}}s||o.push(r)}for(var u=0,p=t;u<p.length;u++){var h=p[u];this.winWeights.push(h.weights)}this.nonWinList=o},o.prototype._checkISWin=function(){var t=this._getJackpotPrize();return null!==t?(this.playMode==c.FREE?d.G.player.slotInfoFree.curGetJackpotTimes++:d.G.player.slotInfoPayment.curGetJackpotTimes++,t):null!==(t=this._getBonusPrize())?(this.playMode==c.FREE?d.G.player.slotInfoFree.curGetBonusTimes++:d.G.player.slotInfoPayment.curGetBonusTimes++,t):t=this._getNormalPrize()},o.prototype._getNormalPrize=function(){var t,o=!1,e=null;return Math.random()<(this.playMode==c.FREE?d.G.player.slotInfoFree.curWinRate:d.G.player.slotInfoPayment.curWinRate)?(o=!0,e=Myfun.getWeightedIndex(this.winWeights),t=d.G.gameJson.slotConfig[1].winCombination[e].result):t=Myfun.getRandomItemFromArr(this.nonWinList),this.isFirstRoll||this._checkSlotMode(),{prizeType:a.NORMAL,comb:t,prizeIndex:e,isWin:o}},o.prototype._getBonusPrize=function(){var t=a.BONUS,o=this._checkGetPrizeBonus();if(null==o)return null;var e=o.sameValue;if(0==e)return null;var n=o.PlayFree,i=this.itemSpritePathArray.length-1;return{prizeType:t,comb:this._getBonusOrJackpotCombination(e,i),freeCount:n,isWin:!0}},o.prototype._checkGetPrizeBonus=function(){var t=null;if(d.G.player.vipLevel<=1)return null;if(d.G.player.vipLevel>1){var o=Myfun.findItemFromArr(d.G.gameJson.vipList,"vipLevel",d.G.player.vipLevel);if((this.playMode==c.FREE?d.G.player.slotInfoFree.curGetBonusTimes:d.G.player.slotInfoPayment.curGetBonusTimes)>=o.slotBonusLimit)return null}for(var e=this.playMode==c.FREE?d.G.player.slotInfoFree.curAccCost:d.G.player.slotInfoPayment.curAccCost,n=0;n<d.G.gameJson.bonusConfig.length;n++){var i=d.G.gameJson.bonusConfig[n];if(e>=i.lowerLimit&&e<=i.upperLimit){var r=i.weight,s=Myfun.getWeightedIndex(r);return{sameValue:i.sameCount[s],PlayFree:i.PlayFree[s]}}}return t},o.prototype._getBonusOrJackpotCombination=function(t,o){var e=[];if(1==t)for(e.push(o);e.length<3;){var n=1+Math.floor(Math.random()*(this.itemSpritePathArray.length-2));e.push(n)}else if(2==t)for(e.push(o,o);e.length<3;)n=1+Math.floor(Math.random()*(this.itemSpritePathArray.length-2)),e.push(n);else 3==t&&e.push(o,o,o);return e},o.prototype._getJackpotPrize=function(){var t=a.JACKPOT,o=this._checkGetPrizeJackpot();if(null==o)return null;var e=o.sameValue,n=o.ratioValue;if(0==e)return null;var i=this.itemSpritePathArray.length;return{prizeType:t,comb:this._getBonusOrJackpotCombination(e,i),ratioValue:n,isWin:!0}},o.prototype._checkGetPrizeJackpot=function(){var t=null;if(d.G.player.vipLevel<=1)return null;if(d.G.player.vipLevel>1){var o=Myfun.findItemFromArr(d.G.gameJson.vipList,"vipLevel",d.G.player.vipLevel);if((this.playMode==c.FREE?d.G.player.slotInfoFree.curGetJackpotTimes:d.G.player.slotInfoPayment.curGetJackpotTimes)>=o.slotJackpotLimit)return null}for(var e=this.playMode==c.FREE?d.G.player.slotInfoFree.curAccCost:d.G.player.slotInfoPayment.curAccCost,n=this.playMode==c.FREE?d.G.player.slotInfoFree.curWinnerTimes:d.G.player.slotInfoPayment.curWinnerTimes,i=0;i<d.G.gameJson.jackpotConfig.length;i++){var r=d.G.gameJson.jackpotConfig[i];if(e>=r.lowerLimit&&e<=r.upperLimit&&n>=r.winnerCount){var s=r.weight,l=Myfun.getWeightedIndex(s);return{sameValue:r.sameCount[l],ratioValue:r.prizeRation[l]}}}return t},o.prototype._checkSlotMode=function(){var t,o;this.playMode===c.FREE?(t=d.G.player.accountCoinInfo.gold,o=this.initialGold,d.G.player.slotInfoFree.SlotMode==MI.slotMode.NORMAL?t>o&&(t-o)/o>d.G.gameJson.slotConfig[1].winInLimit?(d.G.player.slotInfoFree.SlotMode=MI.slotMode.WIN,d.G.player.slotInfoFree.curWinRate=d.G.gameJson.slotConfig[1].winRate,d.G.player.slotInfoFree.curWinnerTimes++,console.log(".............\u8fdb\u5165\u8d62\u5bb6\u6a21\u5f0f..........",d.G.player.slotInfoFree.curWinRate)):t<o&&(o-t)/o>d.G.gameJson.slotConfig[1].loseInLimit&&(d.G.player.slotInfoFree.SlotMode=MI.slotMode.LOSE,d.G.player.slotInfoFree.curWinRate=d.G.gameJson.slotConfig[1].loseRate,console.log(".............\u8fdb\u5165\u8f93\u5bb6\u6a21\u5f0f..........",d.G.player.slotInfoFree.curWinRate)):d.G.player.slotInfoFree.SlotMode==MI.slotMode.LOSE?t>=o*d.G.gameJson.slotConfig[1].loseOutLimit&&(d.G.player.slotInfoFree.SlotMode=MI.slotMode.NORMAL,d.G.player.slotInfoFree.curWinRate=d.G.gameJson.slotConfig[1].normalRate,console.log(".............\u9000\u51fa\u8f93\u5bb6\u6a21\u5f0f ..........",d.G.player.slotInfoFree.curWinRate)):d.G.player.slotInfoFree.SlotMode==MI.slotMode.WIN&&t>o&&(t-o)/o<d.G.gameJson.slotConfig[1].winOutLimit&&(d.G.player.slotInfoFree.SlotMode=MI.slotMode.NORMAL,d.G.player.slotInfoFree.curWinRate=d.G.gameJson.slotConfig[1].normalRate,console.log(".............\u9000\u51fa\u8d62\u5bb6\u6a21\u5f0f ..........",d.G.player.slotInfoFree.curWinRate))):(t=d.G.player.accountCoinInfo.diamond+d.G.player.accountCoinInfo.slotCoin*this.diamondToCoin,o=this.initialDiamond,d.G.player.slotInfoPayment.SlotMode==MI.slotMode.NORMAL?(cc.log("\u5f53\u524d\u94bb\u77f3\uff1a",t,"\u8d77\u59cb\u94bb\u77f3\uff1a",o),t>o&&(t-o)/o>d.G.gameJson.slotConfig[1].winInLimit?(d.G.player.slotInfoPayment.SlotMode=MI.slotMode.WIN,d.G.player.slotInfoPayment.curWinRate=d.G.gameJson.slotConfig[1].winRate,d.G.player.slotInfoPayment.curWinnerTimes++,console.log(".............\u8fdb\u5165\u8d62\u5bb6\u6a21\u5f0f..........",d.G.player.slotInfoPayment.curWinRate)):t<o&&(o-t)/o>d.G.gameJson.slotConfig[1].loseInLimit&&(d.G.player.slotInfoPayment.SlotMode=MI.slotMode.LOSE,d.G.player.slotInfoPayment.curWinRate=d.G.gameJson.slotConfig[1].loseRate,console.log(".............\u8fdb\u5165\u8f93\u5bb6\u6a21\u5f0f..........",d.G.player.slotInfoPayment.curWinRate))):d.G.player.slotInfoPayment.SlotMode==MI.slotMode.LOSE?t>=o*d.G.gameJson.slotConfig[1].loseOutLimit&&(d.G.player.slotInfoPayment.SlotMode=MI.slotMode.NORMAL,d.G.player.slotInfoPayment.curWinRate=d.G.gameJson.slotConfig[1].normalRate,console.log(".............\u9000\u51fa\u8f93\u5bb6\u6a21\u5f0f ..........",d.G.player.slotInfoPayment.curWinRate)):d.G.player.slotInfoPayment.SlotMode==MI.slotMode.WIN&&t>o&&(t-o)/o<d.G.gameJson.slotConfig[1].winOutLimit&&(d.G.player.slotInfoPayment.SlotMode=MI.slotMode.NORMAL,d.G.player.slotInfoPayment.curWinRate=d.G.gameJson.slotConfig[1].normalRate,console.log(".............\u9000\u51fa\u8d62\u5bb6\u6a21\u5f0f ..........",d.G.player.slotInfoPayment.curWinRate)))},o.prototype.btnCloseClicked=function(){this.isRolling&&this._rollingEndCall(),this.node.destroy()},o.prototype._initWindowContent=function(t,o,e,n){var i;for(this.isFirstRoll||((i=cc.instantiate(t)).parent=t.parent);t.childrenCount>0;)d.G.PoolManager.putNode(t.children[t.childrenCount-1]);t.setPosition(0,-210,0);var r=e<this.itemSpritePathArray.length?e+1:1;this._spawnItem(r,t),this._spawnItem(e,t);var s=e-1;if(this.isFirstRoll){for(var l=0;l<o-4;l++)s<1&&(s=this.itemSpritePathArray.length),this._spawnItem(s,t),s--;for(l=3;l>0;l--)this._spawnItem(l,t)}else{for(l=0;l<o-4;l++)s<1&&(s=this.itemSpritePathArray.length),this._spawnItem(s,t),s--;var a=n+1;for(l=0;l<3;l++)a<1?a=this.itemSpritePathArray.length:a>this.itemSpritePathArray.length&&(a=1),this._spawnItem(a,t),a--;for(;i.childrenCount>0;)d.G.PoolManager.putNode(i.children[i.childrenCount-1]);i.destroy()}},o.prototype._setWindowLayoutContent=function(){var t=this._checkISWin();this.curResult=t,this._initWindowContent(this.windowLayout1,this.num1,t.comb[0],this.resultArr[0]),this.windowLayout1.active=!0,this._initWindowContent(this.windowLayout2,this.num2,t.comb[1],this.resultArr[1]),this.windowLayout2.active=!0,this._initWindowContent(this.windowLayout3,this.num3,t.comb[2],this.resultArr[2]),this.windowLayout3.active=!0,this.resultArr=t.comb},o.prototype._updatePrizePool=function(){for(var t=(this.playMode==c.FREE?d.G.player.slotInfoFree.curPrizePoolNum:d.G.player.slotInfoPayment.curPrizePoolNum).toString().split(""),o=t.length-1,e=this.goldLayer.childrenCount-1;e>0;e--){var n=this.goldLayer.children[e],i=t[o];null==i&&(i=0),n.getComponent(d.G.ScrollNumber).scrollTo(Number(i)),o--}},o.prototype._getRake=function(){this.playMode==c.FREE?d.G.player.slotInfoFree.curPrizePoolNum+=this.costGold*this.curTimes*.03:d.G.player.slotInfoPayment.curPrizePoolNum+=this.costCoin*this.diamondToCoin*this.curTimes*.03},o.prototype._spawnItem=function(t,o){d.G.PoolManager.getNode(this.item,o).getComponent(y.default).setSprite(t,o.name)},o.prototype.onHandleClicked=function(){return s(this,void 0,void 0,function(){var t,o=this;return l(this,function(e){switch(e.label){case 0:return this.isRolling?this.canStop?(cc.Tween.stopAll(),cc.log("stopRoll...........",this.isRolling),this._stopRolling(this.windowLayout1,this.num1),this._stopRolling(this.windowLayout2,this.num2),this._stopRolling(this.windowLayout3,this.num3,function(){cc.audioEngine.stop(o.rollingAudioId),h.default.Inst.play("stop"),o._rollingEndCall()}),this.canStop=!1,[2]):[2]:[3,1];case 1:return this.checkCoins()?(this.isFirstRoll?this.isFirstRoll=!1:this._setWindowLayoutContent(),this._startRolling(),[4,this._doCost()]):[3,3];case 2:return e.sent(),this.scheduleOnce(function(){o.canStop=!0},.5),[3,4];case 3:t="static_confirm10",this.playMode==c.PAYMENT&&(t="static_confirm11"),d.G.eventMsg.emit(MI.MSG.confirm,t,function(){o.btnCloseClicked()}),e.label=4;case 4:return[2]}})})},o.prototype._startRolling=function(){return s(this,void 0,void 0,function(){var t,o=this;return l(this,function(e){switch(e.label){case 0:return this.isRolling=!0,this.playMode==c.FREE?d.G.player.slotInfoFree.curPlayTimes++:d.G.player.slotInfoPayment.curPlayTimes++,cc.log("rolling..........."),t=this,[4,h.default.Inst.play("roll")];case 1:return t.rollingAudioId=e.sent(),this._rollingAni(this.windowLayout1,this.num1),this._rollingAni(this.windowLayout2,this.num2),this._rollingAni(this.windowLayout3,this.num3,function(){return s(o,void 0,void 0,function(){var t=this;return l(this,function(o){switch(o.label){case 0:return cc.audioEngine.stop(this.rollingAudioId),h.default.Inst.play("stop"),this._rollingEndCall(),this.isAutoRun?[4,new Promise(function(o){t.scheduleOnce(function(){o()},.5)})]:[3,2];case 1:o.sent(),this.onHandleClicked(),o.label=2;case 2:return[2]}})})}),[2]}})})},o.prototype._rollingEndCall=function(){return s(this,void 0,void 0,function(){return l(this,function(){return this.isRolling=!1,this._getReward(),this._getRake(),this._updatePrizePool(),[2]})})},o.prototype._stopRolling=function(t,o,e){var n=t.children[0].height;cc.tween(t).parallel(cc.tween().to(.5,{position:cc.v3(0,-n*(o-2)-210,0)},{easing:"sineOut"}).call(function(){e&&e()}),cc.tween().delay(.3).call(function(){cc.director.emit(t.name+"isEnd")})).start()},o.prototype._rollingAni=function(t,o,e){var n=t.children[0].height;t.y=-210,cc.tween(t).parallel(cc.tween().to(this.rollingTime,{position:cc.v3(0,-n*(o-2)-210,0)},{easing:"sineInOut"}).call(function(){e&&e()}),cc.tween().delay(.2*this.rollingTime).call(function(){cc.director.emit(t.name+"isRolling")}),cc.tween().delay(.8*this.rollingTime).call(function(){cc.director.emit(t.name+"isEnd")})).start()},r([G(cc.Prefab)],o.prototype,"item",void 0),r([G(cc.Node)],o.prototype,"goldLayer",void 0),r([G(cc.Node)],o.prototype,"windowLayout1",void 0),r([G(cc.Node)],o.prototype,"windowLayout2",void 0),r([G(cc.Node)],o.prototype,"windowLayout3",void 0),r([G(cc.Button)],o.prototype,"startBtn",void 0),r([G(cc.SpriteFrame)],o.prototype,"btnSF",void 0),r([G(cc.Prefab)],o.prototype,"slotGold",void 0),r([G(cc.Label)],o.prototype,"btnTimesLab",void 0),r([G(cc.ProgressBar)],o.prototype,"progressBar",void 0),r([G(cc.Label)],o.prototype,"ProgressLab",void 0),r([G(cc.Label)],o.prototype,"curTimesLab",void 0),r([G(cc.Node)],o.prototype,"btn_gold",void 0),r([G(cc.Node)],o.prototype,"btn_diamond",void 0),r([G(cc.Label)],o.prototype,"goldLab",void 0),r([G(cc.Label)],o.prototype,"diamondLab",void 0),r([G(cc.Label)],o.prototype,"slotcoinLab",void 0),r([g],o)}(p.default);e.default=I,cc._RF.pop()},{"../../core_lmn/core":void 0,"../../module_basic/script/popup/popBase":void 0,"../../scripts/G":void 0,"../../scripts/Sound_Mgr":void 0,"./ani_slot":"ani_slot","./item_slot":"item_slot"}]},{},["ani_slot","item_slot","slotMachine"]);